/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gfx.utils"],["require","dojox.gfx"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gfx.utils"]){_4._hasResource["dojox.gfx.utils"]=true;_4.provide("dojox.gfx.utils");_4.require("dojox.gfx");(function(){var d=_4,g=_6.gfx,gu=g.utils;_4.mixin(gu,{forEach:function(_7,f,o){o=o||d.global;f.call(o,_7);if(_7 instanceof g.Surface||_7 instanceof g.Group){d.forEach(_7.children,function(_8){gu.forEach(_8,f,o);});}},serialize:function(_9){var t={},v,_a=_9 instanceof g.Surface;if(_a||_9 instanceof g.Group){t.children=d.map(_9.children,gu.serialize);if(_a){return t.children;}}else{t.shape=_9.getShape();}if(_9.getTransform){v=_9.getTransform();if(v){t.transform=v;}}if(_9.getStroke){v=_9.getStroke();if(v){t.stroke=v;}}if(_9.getFill){v=_9.getFill();if(v){t.fill=v;}}if(_9.getFont){v=_9.getFont();if(v){t.font=v;}}return t;},toJson:function(_b,_c){return d.toJson(gu.serialize(_b),_c);},deserialize:function(_d,_e){if(_e instanceof Array){return d.map(_e,d.hitch(null,gu.deserialize,_d));}var _f=("shape" in _e)?_d.createShape(_e.shape):_d.createGroup();if("transform" in _e){_f.setTransform(_e.transform);}if("stroke" in _e){_f.setStroke(_e.stroke);}if("fill" in _e){_f.setFill(_e.fill);}if("font" in _e){_f.setFont(_e.font);}if("children" in _e){d.forEach(_e.children,d.hitch(null,gu.deserialize,_f));}return _f;},fromJson:function(_10,_11){return gu.deserialize(_10,d.fromJson(_11));},toSvg:function(_12){var _13=new _4.Deferred();if(_6.gfx.renderer==="svg"){try{var svg=gu._cleanSvg(gu._innerXML(_12.rawNode));_13.callback(svg);}catch(e){_13.errback(e);}}else{if(!gu._initSvgSerializerDeferred){gu._initSvgSerializer();}var _14=_6.gfx.utils.toJson(_12);var _15=function(){try{var _16=_12.getDimensions();var _17=_16.width;var _18=_16.height;var _19=gu._gfxSvgProxy.document.createElement("div");gu._gfxSvgProxy.document.body.appendChild(_19);_4.withDoc(gu._gfxSvgProxy.document,function(){_4.style(_19,"width",_17);_4.style(_19,"height",_18);},this);var ts=gu._gfxSvgProxy[_6._scopeName].gfx.createSurface(_19,_17,_18);var _1a=function(_1b){try{gu._gfxSvgProxy[_6._scopeName].gfx.utils.fromJson(_1b,_14);var svg=gu._cleanSvg(_19.innerHTML);_1b.clear();_1b.destroy();gu._gfxSvgProxy.document.body.removeChild(_19);_13.callback(svg);}catch(e){_13.errback(e);}};ts.whenLoaded(null,_1a);}catch(ex){_13.errback(ex);}};if(gu._initSvgSerializerDeferred.fired>0){_15();}else{gu._initSvgSerializerDeferred.addCallback(_15);}}return _13;},_gfxSvgProxy:null,_initSvgSerializerDeferred:null,_svgSerializerInitialized:function(){gu._initSvgSerializerDeferred.callback(true);},_initSvgSerializer:function(){if(!gu._initSvgSerializerDeferred){gu._initSvgSerializerDeferred=new _4.Deferred();var f=_4.doc.createElement("iframe");_4.style(f,{display:"none",position:"absolute",width:"1em",height:"1em",top:"-10000px"});var _1c;if(_4.isIE){f.onreadystatechange=function(){if(f.contentWindow.document.readyState=="complete"){f.onreadystatechange=function(){};_1c=setInterval(function(){if(f.contentWindow[_4._scopeName]&&f.contentWindow[_6._scopeName].gfx&&f.contentWindow[_6._scopeName].gfx.utils){clearInterval(_1c);f.contentWindow.parent[_6._scopeName].gfx.utils._gfxSvgProxy=f.contentWindow;f.contentWindow.parent[_6._scopeName].gfx.utils._svgSerializerInitialized();}},50);}};}else{f.onload=function(){f.onload=function(){};_1c=setInterval(function(){if(f.contentWindow[_4._scopeName]&&f.contentWindow[_6._scopeName].gfx&&f.contentWindow[_6._scopeName].gfx.utils){clearInterval(_1c);f.contentWindow.parent[_6._scopeName].gfx.utils._gfxSvgProxy=f.contentWindow;f.contentWindow.parent[_6._scopeName].gfx.utils._svgSerializerInitialized();}},50);};}var uri=(_4.config["dojoxGfxSvgProxyFrameUrl"]||_4.moduleUrl("dojox","gfx/resources/gfxSvgProxyFrame.html"));f.setAttribute("src",uri);_4.body().appendChild(f);}},_innerXML:function(_1d){if(_1d.innerXML){return _1d.innerXML;}else{if(_1d.xml){return _1d.xml;}else{if(typeof XMLSerializer!="undefined"){return (new XMLSerializer()).serializeToString(_1d);}}}return null;},_cleanSvg:function(svg){if(svg){if(svg.indexOf("xmlns=\"http://www.w3.org/2000/svg\"")==-1){svg=svg.substring(4,svg.length);svg="<svg xmlns=\"http://www.w3.org/2000/svg\""+svg;}svg=svg.replace(/\bdojoGfx\w*\s*=\s*(['"])\w*\1/g,"");}return svg;}});})();}}};});