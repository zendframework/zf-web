/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.storage.WhatWGStorageProvider"],["require","dojox.storage.Provider"],["require","dojox.storage.manager"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.storage.WhatWGStorageProvider"]){_4._hasResource["dojox.storage.WhatWGStorageProvider"]=true;_4.provide("dojox.storage.WhatWGStorageProvider");_4.require("dojox.storage.Provider");_4.require("dojox.storage.manager");_4.declare("dojox.storage.WhatWGStorageProvider",[_6.storage.Provider],{initialized:false,_domain:null,_available:null,_statusHandler:null,_allNamespaces:null,_storageEventListener:null,initialize:function(){if(_4.config["disableWhatWGStorage"]==true){return;}this._domain=location.hostname;this.initialized=true;_6.storage.manager.loaded();},isAvailable:function(){try{var _7=globalStorage[location.hostname];}catch(e){this._available=false;return this._available;}this._available=true;return this._available;},put:function(_8,_9,_a,_b){if(this.isValidKey(_8)==false){throw new Error("Invalid key given: "+_8);}_b=_b||this.DEFAULT_NAMESPACE;_8=this.getFullKey(_8,_b);this._statusHandler=_a;if(_4.isString(_9)){_9="string:"+_9;}else{_9=_4.toJson(_9);}var _c=_4.hitch(this,function(_d){window.removeEventListener("storage",_c,false);if(_a){_a.call(null,this.SUCCESS,_8,null,_b);}});window.addEventListener("storage",_c,false);try{var _e=globalStorage[this._domain];_e.setItem(_8,_9);}catch(e){this._statusHandler.call(null,this.FAILED,_8,e.toString(),_b);}},get:function(_f,_10){if(this.isValidKey(_f)==false){throw new Error("Invalid key given: "+_f);}_10=_10||this.DEFAULT_NAMESPACE;_f=this.getFullKey(_f,_10);var _11=globalStorage[this._domain];var _12=_11.getItem(_f);if(_12==null||_12==""){return null;}_12=_12.value;if(_4.isString(_12)&&(/^string:/.test(_12))){_12=_12.substring("string:".length);}else{_12=_4.fromJson(_12);}return _12;},getNamespaces:function(){var _13=[this.DEFAULT_NAMESPACE];var _14={};var _15=globalStorage[this._domain];var _16=/^__([^_]*)_/;for(var i=0;i<_15.length;i++){var _17=_15.key(i);if(_16.test(_17)==true){var _18=_17.match(_16)[1];if(typeof _14[_18]=="undefined"){_14[_18]=true;_13.push(_18);}}}return _13;},getKeys:function(_19){_19=_19||this.DEFAULT_NAMESPACE;if(this.isValidKey(_19)==false){throw new Error("Invalid namespace given: "+_19);}var _1a;if(_19==this.DEFAULT_NAMESPACE){_1a=new RegExp("^([^_]{2}.*)$");}else{_1a=new RegExp("^__"+_19+"_(.*)$");}var _1b=globalStorage[this._domain];var _1c=[];for(var i=0;i<_1b.length;i++){var _1d=_1b.key(i);if(_1a.test(_1d)==true){_1d=_1d.match(_1a)[1];_1c.push(_1d);}}return _1c;},clear:function(_1e){_1e=_1e||this.DEFAULT_NAMESPACE;if(this.isValidKey(_1e)==false){throw new Error("Invalid namespace given: "+_1e);}var _1f;if(_1e==this.DEFAULT_NAMESPACE){_1f=new RegExp("^[^_]{2}");}else{_1f=new RegExp("^__"+_1e+"_");}var _20=globalStorage[this._domain];var _21=[];for(var i=0;i<_20.length;i++){if(_1f.test(_20.key(i))==true){_21[_21.length]=_20.key(i);}}_4.forEach(_21,_4.hitch(_20,"removeItem"));},remove:function(key,_22){key=this.getFullKey(key,_22);var _23=globalStorage[this._domain];_23.removeItem(key);},isPermanent:function(){return true;},getMaximumSize:function(){return this.SIZE_NO_LIMIT;},hasSettingsUI:function(){return false;},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface");},getFullKey:function(key,_24){_24=_24||this.DEFAULT_NAMESPACE;if(this.isValidKey(_24)==false){throw new Error("Invalid namespace given: "+_24);}if(_24==this.DEFAULT_NAMESPACE){return key;}else{return "__"+_24+"_"+key;}}});_6.storage.manager.register("dojox.storage.WhatWGStorageProvider",new _6.storage.WhatWGStorageProvider());}}};});