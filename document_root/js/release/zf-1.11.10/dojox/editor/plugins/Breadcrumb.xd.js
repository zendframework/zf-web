/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.Breadcrumb"],["require","dijit._editor._Plugin"],["require","dijit._editor.range"],["require","dojo.i18n"],["require","dojo.string"],["require","dijit.Toolbar"],["require","dijit.form.Button"],["require","dijit._editor.selection"],["require","dijit.Menu"],["require","dijit.MenuItem"],["require","dijit.MenuSeparator"],["requireLocalization","dojox.editor.plugins","Breadcrumb",null,"ROOT,ko","ROOT,ko"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.Breadcrumb"]){_4._hasResource["dojox.editor.plugins.Breadcrumb"]=true;_4.provide("dojox.editor.plugins.Breadcrumb");_4.require("dijit._editor._Plugin");_4.require("dijit._editor.range");_4.require("dojo.i18n");_4.require("dojo.string");_4.require("dijit.Toolbar");_4.require("dijit.form.Button");_4.require("dijit._editor.selection");_4.require("dijit.Menu");_4.require("dijit.MenuItem");_4.require("dijit.MenuSeparator");_4.experimental("dojox.editor.plugins.Breadcrumb");_4.declare("dojox.editor.plugins._BreadcrumbMenuTitle",[_5._Widget,_5._Templated,_5._Contained],{templateString:"<tr><td dojoAttachPoint=\"title\" colspan=\"4\" class=\"dijitToolbar\" style=\"font-weight: bold; padding: 3px;\"></td></tr>",menuTitle:"",postCreate:function(){_4.setSelectable(this.domNode,false);var _7=this.id+"_text";_5.setWaiState(this.domNode,"labelledby",_7);},_setMenuTitleAttr:function(_8){this.title.innerHTML=_8;},_getMenuTitleAttr:function(_9){return this.title.innerHTML;}});_4.declare("dojox.editor.plugins.Breadcrumb",_5._editor._Plugin,{_menu:null,breadcrumbBar:null,setEditor:function(_a){this.editor=_a;this._buttons=[];this.breadcrumbBar=new _5.Toolbar();var _b=_4.i18n.getLocalization("dojox.editor.plugins","Breadcrumb");this._titleTemplate=_b.nodeActions;_4.place(this.breadcrumbBar.domNode,_a.footer);this.editor.onLoadDeferred.addCallback(_4.hitch(this,function(){this._menu=new _5.Menu({});_4.addClass(this.breadcrumbBar.domNode,"dojoxEditorBreadcrumbArrow");var _c=this;var _d=new _5.form.ComboButton({showLabel:true,label:"body",_selNode:_a.editNode,dropDown:this._menu,onClick:_4.hitch(this,function(){this._menuTarget=_a.editNode;this._selectContents();})});this._menuTitle=new _6.editor.plugins._BreadcrumbMenuTitle({menuTitle:_b.nodeActions});this._selCMenu=new _5.MenuItem({label:_b.selectContents,onClick:_4.hitch(this,this._selectContents)});this._delCMenu=new _5.MenuItem({label:_b.deleteContents,onClick:_4.hitch(this,this._deleteContents)});this._selEMenu=new _5.MenuItem({label:_b.selectElement,onClick:_4.hitch(this,this._selectElement)});this._delEMenu=new _5.MenuItem({label:_b.deleteElement,onClick:_4.hitch(this,this._deleteElement)});this._moveSMenu=new _5.MenuItem({label:_b.moveStart,onClick:_4.hitch(this,this._moveCToStart)});this._moveEMenu=new _5.MenuItem({label:_b.moveEnd,onClick:_4.hitch(this,this._moveCToEnd)});this._menu.addChild(this._menuTitle);this._menu.addChild(this._selCMenu);this._menu.addChild(this._delCMenu);this._menu.addChild(new _5.MenuSeparator({}));this._menu.addChild(this._selEMenu);this._menu.addChild(this._delEMenu);this._menu.addChild(new _5.MenuSeparator({}));this._menu.addChild(this._moveSMenu);this._menu.addChild(this._moveEMenu);_d._ddConnect=_4.connect(_d,"openDropDown",_4.hitch(this,function(){this._menuTarget=_d._selNode;this._menuTitle.attr("menuTitle",_4.string.substitute(this._titleTemplate,{"nodeName":"&lt;body&gt;"}));this._selEMenu.attr("disabled",true);this._delEMenu.attr("disabled",true);this._selCMenu.attr("disabled",false);this._delCMenu.attr("disabled",false);this._moveSMenu.attr("disabled",false);this._moveEMenu.attr("disabled",false);}));this.breadcrumbBar.addChild(_d);this.connect(this.editor,"onNormalizedDisplayChanged","updateState");}));this.breadcrumbBar.startup();if(_4.isIE){setTimeout(_4.hitch(this,function(){this.breadcrumbBar.domNode.className=this.breadcrumbBar.domNode.className;}),100);}},_selectContents:function(){this.editor.focus();if(this._menuTarget){var _e=this._menuTarget.tagName.toLowerCase();switch(_e){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":break;default:try{_4.withGlobal(this.editor.window,"collapse",_5._editor.selection,[null]);_4.withGlobal(this.editor.window,"selectElementChildren",_5._editor.selection,[this._menuTarget]);this.editor.onDisplayChanged();}catch(e){}}}},_deleteContents:function(){if(this._menuTarget){this.editor.beginEditing();this._selectContents();_4.withGlobal(this.editor.window,"remove",_5._editor.selection,[this._menuTarget]);this.editor.endEditing();this._updateBreadcrumb();this.editor.onDisplayChanged();}},_selectElement:function(){this.editor.focus();if(this._menuTarget){_4.withGlobal(this.editor.window,"collapse",_5._editor.selection,[null]);_4.withGlobal(this.editor.window,"selectElement",_5._editor.selection,[this._menuTarget]);this.editor.onDisplayChanged();}},_deleteElement:function(){if(this._menuTarget){this.editor.beginEditing();this._selectElement();_4.withGlobal(this.editor.window,"remove",_5._editor.selection,[this._menuTarget]);this.editor.endEditing();this._updateBreadcrumb();this.editor.onDisplayChanged();}},_moveCToStart:function(){this.editor.focus();if(this._menuTarget){this._selectContents();_4.withGlobal(this.editor.window,"collapse",_5._editor.selection,[true]);}},_moveCToEnd:function(){this.editor.focus();if(this._menuTarget){this._selectContents();_4.withGlobal(this.editor.window,"collapse",_5._editor.selection,[false]);}},_updateBreadcrumb:function(){var ed=this.editor;if(ed.window){var _f=_5.range.getSelection(ed.window);if(_f&&_f.rangeCount>0){var _10=_f.getRangeAt(0);var _11=_4.withGlobal(ed.window,"getSelectedElement",_5._editor.selection)||_10.startContainer;var _12=[];if(_11&&_11.ownerDocument===ed.document){while(_11&&_11!==ed.editNode&&_11!=ed.document.body&&_11!=ed.document){if(_11.nodeType===1){_12.push({type:_11.tagName.toLowerCase(),node:_11});}_11=_11.parentNode;}_12=_12.reverse();while(this._buttons.length){var db=this._buttons.pop();_4.disconnect(db._ddConnect);this.breadcrumbBar.removeChild(db);}this._buttons=[];var i;var _13=this;for(i=0;i<_12.length;i++){var bc=_12[i];var b=new _5.form.ComboButton({showLabel:true,label:bc.type,_selNode:bc.node,dropDown:this._menu,onClick:function(){_13._menuTarget=this._selNode;_13._selectContents();}});b._ddConnect=_4.connect(b,"openDropDown",_4.hitch(b,function(){_13._menuTarget=this._selNode;var _14=_13._menuTarget.tagName.toLowerCase();var _15=_4.string.substitute(_13._titleTemplate,{"nodeName":"&lt;"+_14+"&gt;"});_13._menuTitle.attr("menuTitle",_15);switch(_14){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":_13._selCMenu.attr("disabled",true);_13._delCMenu.attr("disabled",true);_13._moveSMenu.attr("disabled",true);_13._moveEMenu.attr("disabled",true);_13._selEMenu.attr("disabled",false);_13._delEMenu.attr("disabled",false);break;default:_13._selCMenu.attr("disabled",false);_13._delCMenu.attr("disabled",false);_13._selEMenu.attr("disabled",false);_13._delEMenu.attr("disabled",false);_13._moveSMenu.attr("disabled",false);_13._moveEMenu.attr("disabled",false);}}));this._buttons.push(b);this.breadcrumbBar.addChild(b);}if(_4.isIE){this.breadcrumbBar.domNode.className=this.breadcrumbBar.domNode.className;}}}}},updateState:function(){if(_4.style(this.editor.iframe,"display")==="none"){_4.style(this.breadcrumbBar.domNode,"display","none");}else{if(_4.style(this.breadcrumbBar.domNode,"display")==="none"){_4.style(this.breadcrumbBar.domNode,"display","block");}this._updateBreadcrumb();var _16=_4.marginBox(this.editor.domNode);this.editor.resize({h:_16.h});}},destroy:function(){if(this.breadcrumbBar){this.breadcrumbBar.destroy();this.breadcrumbBar=null;}this._buttons=null;delete this.editor.breadcrumbBar;this.inherited(arguments);}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _17=o.args.name.toLowerCase();if(_17==="breadcrumb"){o.plugin=new _6.editor.plugins.Breadcrumb({});}});}}};});