/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.drawing.stencil._Base"],["require","dojo.fx.easing"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.drawing.stencil._Base"]){_4._hasResource["dojox.drawing.stencil._Base"]=true;_4.provide("dojox.drawing.stencil._Base");_4.require("dojo.fx.easing");_6.drawing.stencil._Base=_6.drawing.util.oo.declare(function(_7){_4.mixin(this,_7);this.style=_7.style||_6.drawing.defaults.copy();if(_7.stencil){this.stencil=_7.stencil;this.util=_7.stencil.util;this.mouse=_7.stencil.mouse;this.container=_7.stencil.container;this.style=_7.stencil.style;}var _8=/Line|Vector|Axes|Arrow/;var _9=/Text/;this.shortType=this.util.abbr(this.type);this.isText=_9.test(this.type);this.isLine=_8.test(this.type);this.renderHit=this.style.renderHitLayer;if(!this.renderHit&&this.style.renderHitLines&&this.isLine){this.renderHit=true;}if(!this.renderHit&&this.style.useSelectedStyle){this.useSelectedStyle=true;this.selCopy=_4.clone(this.style.selected);for(var nm in this.style.norm){if(this.style.selected[nm]===undefined){this.style.selected[nm]=this.style.norm[nm];}}this.textSelected=_4.clone(this.style.text);this.textSelected.color=this.style.selected.fill;}this.angleSnap=this.style.angleSnap||1;this.marginZero=_7.marginZero||this.style.anchors.marginZero;this.id=_7.id||this.util.uid(this.type);this._cons=[];if(!this.annotation&&!this.subShape){this.util.attr(this.container,"id",this.id);}this.connect(this,"onBeforeRender","preventNegativePos");this._offX=this.mouse.origin.x;this._offY=this.mouse.origin.y;if(this.isText){this.align=_7.align||this.align;this.valign=_7.valign||this.valign;if(_7.data&&_7.data.makeFit){var _a=this.makeFit(_7.data.text,_7.data.width);this.textSize=this.style.text.size=_a.size;this._lineHeight=_a.box.h;}else{this.textSize=parseInt(this.style.text.size,10);this._lineHeight=this.textSize*1.4;}this.deleteEmptyCreate=_7.deleteEmptyCreate!==undefined?_7.deleteEmptyCreate:this.style.text.deleteEmptyCreate;this.deleteEmptyModify=_7.deleteEmptyModify!==undefined?_7.deleteEmptyModify:this.style.text.deleteEmptyModify;}this.attr(_7.data);if(this.noBaseRender){return;}if(_7.points){if(_7.data&&_7.data.closePath===false){this.closePath=false;}this.setPoints(_7.points);this.connect(this,"render",this,"onRender",true);this.baseRender&&this.enabled&&this.render();_7.label&&this.setLabel(_7.label);_7.shadow&&this.addShadow(_7.shadow);}else{if(_7.data){_7.data.width=_7.data.width?_7.data.width:this.style.text.minWidth;_7.data.height=_7.data.height?_7.data.height:this._lineHeight;this.setData(_7.data);this.connect(this,"render",this,"onRender",true);this.baseRender&&this.enabled&&this.render(_7.data.text);_7.label&&this.setLabel(_7.label);_7.shadow&&this.addShadow(_7.shadow);}else{if(this.draws){this.points=[];this.data={};this.connectMouse();this._postRenderCon=_4.connect(this,"render",this,"_onPostRender");}}}if(this.showAngle){this.angleLabel=new _6.drawing.annotations.Angle({stencil:this});}if(!this.enabled){this.disable();this.moveToBack();this.render(_7.data.text);}},{type:"dojox.drawing.stencil",minimumSize:10,enabled:true,drawingType:"stencil",setData:function(_b){this.data=_b;this.points=this.dataToPoints();},setPoints:function(_c){this.points=_c;if(this.pointsToData){this.data=this.pointsToData();}},onDelete:function(_d){console.info("onDelete",this.id);},onBeforeRender:function(_e){},onModify:function(_f){},onChangeData:function(_10){},onChangeText:function(_11){},onRender:function(_12){this._postRenderCon=_4.connect(this,"render",this,"_onPostRender");this.created=true;this.disconnectMouse();if(this.shape){this.shape.superClass=this;}else{this.container.superClass=this;}this._setNodeAtts(this);},onChangeStyle:function(_13){this._isBeingModified=true;if(!this.enabled){this.style.current=this.style.disabled;this.style.currentText=this.style.textDisabled;this.style.currentHit=this.style.hitNorm;}else{this.style.current=this.style.norm;this.style.currentHit=this.style.hitNorm;this.style.currentText=this.style.text;}if(this.selected){if(this.useSelectedStyle){this.style.current=this.style.selected;this.style.currentText=this.textSelected;}this.style.currentHit=this.style.hitSelected;}else{if(this.highlighted){this.style.currentHit=this.style.hitHighlighted;}}this.render();},animate:function(_14,_15){console.warn("ANIMATE..........................");var d=_14.d||_14.duration||1000;var ms=_14.ms||20;var _16=_14.ease||_4.fx.easing.linear;var _17=_14.steps;var ts=new Date().getTime();var w=100;var cnt=0;var _18=true;var sp,ep;if(_4.isArray(_14.start)){sp=_14.start;ep=_14.end;}else{if(_4.isObject(_14.start)){sp=_14.start;ep=_14.end;_18=false;}else{console.warn("No data provided to animate");}}var v=setInterval(_4.hitch(this,function(){var t=new Date().getTime()-ts;var p=_16(1-t/d);if(t>d||cnt++>100){clearInterval(v);return;}if(_18){var _19=[];_4.forEach(sp,function(pt,i){var o={x:(ep[i].x-sp[i].x)*p+sp[i].x,y:(ep[i].y-sp[i].y)*p+sp[i].y};_19.push(o);});this.setPoints(_19);this.render();}else{var o={};for(var nm in sp){o[nm]=(ep[nm]-sp[nm])*p+sp[nm];}this.attr(o);}}),ms);},attr:function(key,_1a){var n=this.style.norm,t=this.style.text,ts=this.textSelected||{},o,nm,_1b,_1c=_4.toJson(n),_1d=_4.toJson(t);var _1e={x:true,y:true,r:true,height:true,width:true,r:true,radius:true,angle:true};var _1f=false;if(typeof (key)!="object"){o={};o[key]=_1a;}else{o=_4.clone(key);}if(o.width){_1b=o.width;delete o.width;}for(nm in o){if(nm in n){n[nm]=o[nm];}if(nm in t){t[nm]=o[nm];}if(nm in ts){ts[nm]=o[nm];}if(nm in _1e){_1e[nm]=o[nm];_1f=true;if(nm=="radius"&&o.angle===undefined){o.angle=_1e.angle=this.getAngle();}else{if(nm=="angle"&&o.radius===undefined){o.radius=_1e.radius=this.getRadius();}}}if(nm=="text"){this.setText(o.text);}if(nm=="label"){this.setLabel(o.label);}}if(o.borderWidth!==undefined){n.width=o.borderWidth;}if(this.useSelectedStyle){for(nm in this.style.norm){if(this.selCopy[nm]===undefined){this.style.selected[nm]=this.style.norm[nm];}}this.textSelected.color=this.style.selected.color;}if(!this.created){return;}if(o.x!==undefined||o.y!==undefined){var box=this.getBounds(true);var mx={dx:0,dy:0};for(nm in o){if(nm=="x"||nm=="y"||nm=="r"){mx["d"+nm]=o[nm]-box[nm];}}this.transformPoints(mx);}var p=this.points;if(o.angle!==undefined){this.dataToPoints({x:this.data.x1,y:this.data.y1,angle:o.angle,radius:o.radius});}else{if(_1b!==undefined){p[1].x=p[2].x=p[0].x+_1b;this.pointsToData(p);}}if(o.height!==undefined&&o.angle===undefined){console.log("Doing P2D-2");p[2].y=p[3].y=p[0].y+o.height;this.pointsToData(p);}if(o.r!==undefined){this.data.r=Math.max(0,o.r);}if(_1f||_1d!=_4.toJson(t)||_1c!=_4.toJson(n)){this.onChangeStyle(this);}o.width=_1b;},exporter:function(){var _20=this.type.substring(this.type.lastIndexOf(".")+1).charAt(0).toLowerCase()+this.type.substring(this.type.lastIndexOf(".")+2);var o=_4.clone(this.style.norm);o.borderWidth=o.width;delete o.width;if(_20=="path"){o.points=this.points;}else{o=_4.mixin(o,this.data);}o.type=_20;if(this.isText){o.text=this.getText();o=_4.mixin(o,this.style.text);delete o.minWidth;delete o.deleteEmptyCreate;delete o.deleteEmptyModify;}var lbl=this.getLabel();if(lbl){o.label=lbl;}return o;},disable:function(){this.enabled=false;this.renderHit=false;this.onChangeStyle(this);},enable:function(){this.enabled=true;this.renderHit=true;this.onChangeStyle(this);},select:function(){this.selected=true;this.onChangeStyle(this);},deselect:function(_21){if(_21){setTimeout(_4.hitch(this,function(){this.selected=false;this.onChangeStyle(this);}),200);}else{this.selected=false;this.onChangeStyle(this);}},_toggleSelected:function(){if(!this.selected){return;}this.deselect();setTimeout(_4.hitch(this,"select"),0);},highlight:function(){this.highlighted=true;this.onChangeStyle(this);},unhighlight:function(){this.highlighted=false;this.onChangeStyle(this);},moveToFront:function(){this.container&&this.container.moveToFront();},moveToBack:function(){this.container&&this.container.moveToBack();},onTransformBegin:function(_22){this._isBeingModified=true;},onTransformEnd:function(_23){this._isBeingModified=false;this.onModify(this);},onTransform:function(_24){if(!this._isBeingModified){this.onTransformBegin();}this.setPoints(this.points);this.render();},transformPoints:function(mx){if(!mx.dx&&!mx.dy){return;}var _25=_4.clone(this.points),_26=false;_4.forEach(this.points,function(o){o.x+=mx.dx;o.y+=mx.dy;if(o.x<this.marginZero||o.y<this.marginZero){_26=true;}});if(_26){this.points=_25;console.error("Attempt to set object '"+this.id+"' to less than zero.");return;}this.onTransform();this.onTransformEnd();},applyTransform:function(mx){this.transformPoints(mx);},setTransform:function(mx){this.attr({x:mx.dx,y:mx.dy});},getTransform:function(){return this.selected?this.container.getParent().getTransform():{dx:0,dy:0};},addShadow:function(_27){_27=_27===true?{}:_27;_27.stencil=this;this.shadow=new _6.drawing.annotations.BoxShadow(_27);},removeShadow:function(){this.shadow.destroy();},setLabel:function(_28){if(!this._label){this._label=new _6.drawing.annotations.Label({text:_28,util:this.util,mouse:this.mouse,stencil:this,annotation:true,container:this.container,labelPosition:this.labelPosition});}else{if(_28){this._label.setLabel(_28);}}},getLabel:function(){if(this._label){return this._label.getText();}return null;},getAngle:function(){var d=this.pointsToData();var obj={start:{x:d.x1,y:d.y1},x:d.x2,y:d.y2};var _29=this.util.angle(obj,this.angleSnap);_29=180-_29;_29=_29==360?0:_29;return _29;},getRadius:function(){var box=this.getBounds(true);var _2a={start:{x:box.x1,y:box.y1},x:box.x2,y:box.y2};return this.util.length(_2a);},getBounds:function(_2b){var p=this.points,x1,y1,x2,y2;if(p.length==2){if(_2b){x1=p[0].x;y1=p[0].y;x2=p[1].x;y2=p[1].y;}else{x1=p[0].x<p[1].x?p[0].x:p[1].x;y1=p[0].y<p[1].y?p[0].y:p[1].y;x2=p[0].x<p[1].x?p[1].x:p[0].x;y2=p[0].y<p[1].y?p[1].y:p[0].y;}return {x1:x1,y1:y1,x2:x2,y2:y2,x:x1,y:y1,w:x2-x1,h:y2-y1};}else{return {x1:p[0].x,y1:p[0].y,x2:p[2].x,y2:p[2].y,x:p[0].x,y:p[0].y,w:p[2].x-p[0].x,h:p[2].y-p[0].y};}},preventNegativePos:function(){if(this._isBeingModified){return;}if(!this.points||!this.points.length){return;}if(this.type=="dojox.drawing.tools.custom.Axes"){var _2c=this.marginZero,_2d=this.marginZero;_4.forEach(this.points,function(p){_2c=Math.min(p.y,_2c);});_4.forEach(this.points,function(p){_2d=Math.min(p.x,_2d);});if(_2c<this.marginZero){_4.forEach(this.points,function(p,i){p.y=p.y+(this.marginZero-_2c);},this);}if(_2d<this.marginZero){_4.forEach(this.points,function(p){p.x+=(this.marginZero-_2d);},this);}}else{_4.forEach(this.points,function(p){p.x=p.x<0?this.marginZero:p.x;p.y=p.y<0?this.marginZero:p.y;});}this.setPoints(this.points);},_onPostRender:function(_2e){if(this._isBeingModified){this.onModify(this);this._isBeingModified=false;}else{if(!this.created){}}if(!this.editMode&&!this.selected&&this._prevData&&_4.toJson(this._prevData)!=_4.toJson(this.data)){this.onChangeData(this);this._prevData=_4.clone(this.data);}else{if(!this._prevData&&(!this.isText||this.getText())){this._prevData=_4.clone(this.data);}}},_setNodeAtts:function(_2f){var att=this.enabled&&!this.annotation?this.drawingType:"";this.util.attr(_2f,"drawingType",att);},destroy:function(){if(this.destroyed){return;}if(this.data||this.points&&this.points.length){this.onDelete(this);}this.disconnectMouse();this.disconnect(this._cons);_4.disconnect(this._postRenderCon);this.remove(this.shape,this.hit);this.destroyed=true;},remove:function(){var a=arguments;if(!a.length){if(!this.shape){return;}a=[this.shape];}for(var i=0;i<a.length;i++){if(a[i]){a[i].removeShape();}}},connectMult:function(){if(arguments.length>1){this._cons.push(this.connect.apply(this,arguments));}else{if(_4.isArray(arguments[0][0])){_4.forEach(arguments[0],function(ar){this._cons.push(this.connect.apply(this,ar));},this);}else{this._cons.push(this.connect.apply(this,arguments[0]));}}},connect:function(o,e,s,m,_30){var c;if(typeof (o)!="object"){if(s){m=s;s=e;e=o;o=this;}else{m=e;e=o;o=s=this;}}else{if(!m){m=s;s=this;}else{if(_30){c=_4.connect(o,e,function(evt){_4.hitch(s,m)(evt);_4.disconnect(c);});this._cons.push(c);return c;}else{}}}c=_4.connect(o,e,s,m);this._cons.push(c);return c;},disconnect:function(_31){if(!_31){return;}if(!_4.isArray(_31)){_31=[_31];}_4.forEach(_31,_4.disconnect,_4);},connectMouse:function(){this._mouseHandle=this.mouse.register(this);},disconnectMouse:function(){this.mouse.unregister(this._mouseHandle);},render:function(){},dataToPoints:function(_32){},pointsToData:function(_33){},onDown:function(obj){this._downOnCanvas=true;_4.disconnect(this._postRenderCon);this._postRenderCon=null;},onMove:function(obj){},onDrag:function(obj){},onUp:function(obj){}});}}};});