/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.HtmlStore"],["require","dojox.xml.parser"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.HtmlStore"]){_4._hasResource["dojox.data.HtmlStore"]=true;_4.provide("dojox.data.HtmlStore");_4.require("dojox.xml.parser");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.declare("dojox.data.HtmlStore",null,{constructor:function(_7){if(_7&&"urlPreventCache" in _7){this.urlPreventCache=_7.urlPreventCache?true:false;}if(_7&&"trimWhitespace" in _7){this.trimWhitespace=_7.trimWhitespace?true:false;}if(_7.url){if(!_7.dataId){throw new Error("dojo.data.HtmlStore: Cannot instantiate using url without an id!");}this.url=_7.url;this.dataId=_7.dataId;}else{if(_7.dataId){this._rootNode=_4.byId(_7.dataId);this.dataId=this._rootNode.id;}else{this._rootNode=_4.byId(this.dataId);}this._indexItems();}},url:"",dataId:"",trimWhitespace:false,urlPreventCache:false,_indexItems:function(){this._getHeadings();if(this._rootNode.rows){if(this._rootNode.tBodies&&this._rootNode.tBodies.length>0){this._rootNode=this._rootNode.tBodies[0];}var i;for(i=0;i<this._rootNode.rows.length;i++){this._rootNode.rows[i].store=this;this._rootNode.rows[i]._ident=i+1;}}else{var c=1;for(i=0;i<this._rootNode.childNodes.length;i++){if(this._rootNode.childNodes[i].nodeType===1){this._rootNode.childNodes[i].store=this;this._rootNode.childNodes[i]._ident=c;c++;}}}},_getHeadings:function(){this._headings=[];if(this._rootNode.tHead){_4.forEach(this._rootNode.tHead.rows[0].cells,_4.hitch(this,function(th){var _8=_6.xml.parser.textContent(th);this._headings.push(this.trimWhitespace?_4.trim(_8):_8);}));}else{this._headings=["name"];}},_getAllItems:function(){var _9=[];var i;if(this._rootNode.rows){for(i=0;i<this._rootNode.rows.length;i++){_9.push(this._rootNode.rows[i]);}}else{for(i=0;i<this._rootNode.childNodes.length;i++){if(this._rootNode.childNodes[i].nodeType===1){_9.push(this._rootNode.childNodes[i]);}}}return _9;},_assertIsItem:function(_a){if(!this.isItem(_a)){throw new Error("dojo.data.HtmlStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_b){if(typeof _b!=="string"){throw new Error("dojo.data.HtmlStore: a function was passed an attribute argument that was not an attribute name string");return -1;}return _4.indexOf(this._headings,_b);},getValue:function(_c,_d,_e){var _f=this.getValues(_c,_d);return (_f.length>0)?_f[0]:_e;},getValues:function(_10,_11){this._assertIsItem(_10);var _12=this._assertIsAttribute(_11);if(_12>-1){var _13;if(_10.cells){_13=_6.xml.parser.textContent(_10.cells[_12]);}else{_13=_6.xml.parser.textContent(_10);}return [this.trimWhitespace?_4.trim(_13):_13];}return [];},getAttributes:function(_14){this._assertIsItem(_14);var _15=[];for(var i=0;i<this._headings.length;i++){if(this.hasAttribute(_14,this._headings[i])){_15.push(this._headings[i]);}}return _15;},hasAttribute:function(_16,_17){return this.getValues(_16,_17).length>0;},containsValue:function(_18,_19,_1a){var _1b=undefined;if(typeof _1a==="string"){_1b=_4.data.util.filter.patternToRegExp(_1a,false);}return this._containsValue(_18,_19,_1a,_1b);},_containsValue:function(_1c,_1d,_1e,_1f){var _20=this.getValues(_1c,_1d);for(var i=0;i<_20.length;++i){var _21=_20[i];if(typeof _21==="string"&&_1f){return (_21.match(_1f)!==null);}else{if(_1e===_21){return true;}}}return false;},isItem:function(_22){if(_22&&_22.store&&_22.store===this){return true;}return false;},isItemLoaded:function(_23){return this.isItem(_23);},loadItem:function(_24){this._assertIsItem(_24.item);},_fetchItems:function(_25,_26,_27){if(this._rootNode){this._finishFetchItems(_25,_26,_27);}else{if(!this.url){this._rootNode=_4.byId(this.dataId);}else{var _28={url:this.url,handleAs:"text",preventCache:this.urlPreventCache};var _29=this;var _2a=_4.xhrGet(_28);_2a.addCallback(function(_2b){var _2c=function(_2d,id){if(_2d.id==id){return _2d;}if(_2d.childNodes){for(var i=0;i<_2d.childNodes.length;i++){var _2e=_2c(_2d.childNodes[i],id);if(_2e){return _2e;}}}return null;};var d=document.createElement("div");d.innerHTML=_2b;_29._rootNode=_2c(d,_29.dataId);_29._indexItems();_29._finishFetchItems(_25,_26,_27);});_2a.addErrback(function(_2f){_27(_2f,_25);});}}},_finishFetchItems:function(_30,_31,_32){var _33=null;var _34=this._getAllItems();if(_30.query){var _35=_30.queryOptions?_30.queryOptions.ignoreCase:false;_33=[];var _36={};var key;var _37;for(key in _30.query){_37=_30.query[key]+"";if(typeof _37==="string"){_36[key]=_4.data.util.filter.patternToRegExp(_37,_35);}}for(var i=0;i<_34.length;++i){var _38=true;var _39=_34[i];for(key in _30.query){_37=_30.query[key]+"";if(!this._containsValue(_39,key,_37,_36[key])){_38=false;}}if(_38){_33.push(_39);}}_31(_33,_30);}else{if(_34.length>0){_33=_34.slice(0,_34.length);}_31(_33,_30);}},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true};},close:function(_3a){},getLabel:function(_3b){if(this.isItem(_3b)){if(_3b.cells){return "Item #"+this.getIdentity(_3b);}else{return this.getValue(_3b,"name");}}return undefined;},getLabelAttributes:function(_3c){if(_3c.cells){return null;}else{return ["name"];}},getIdentity:function(_3d){this._assertIsItem(_3d);if(this.hasAttribute(_3d,"name")){return this.getValue(_3d,"name");}else{return _3d._ident;}},getIdentityAttributes:function(_3e){return null;},fetchItemByIdentity:function(_3f){var _40=_3f.identity;var _41=this;var _42=null;var _43=null;if(!this._rootNode){if(!this.url){this._rootNode=_4.byId(this.dataId);this._indexItems();if(_41._rootNode.rows){_42=this._rootNode.rows[_40+1];}else{for(var i=0;i<_41._rootNode.childNodes.length;i++){if(_41._rootNode.childNodes[i].nodeType===1&&_40===_6.xml.parser.textContent(_41._rootNode.childNodes[i])){_42=_41._rootNode.childNodes[i];}}}if(_3f.onItem){_43=_3f.scope?_3f.scope:_4.global;_3f.onItem.call(_43,_42);}}else{var _44={url:this.url,handleAs:"text"};var _45=_4.xhrGet(_44);_45.addCallback(function(_46){var _47=function(_48,id){if(_48.id==id){return _48;}if(_48.childNodes){for(var i=0;i<_48.childNodes.length;i++){var _49=_47(_48.childNodes[i],id);if(_49){return _49;}}}return null;};var d=document.createElement("div");d.innerHTML=_46;_41._rootNode=_47(d,_41.dataId);_41._indexItems();if(_41._rootNode.rows&&_40<=_41._rootNode.rows.length){_42=_41._rootNode.rows[_40-1];}else{for(var i=0;i<_41._rootNode.childNodes.length;i++){if(_41._rootNode.childNodes[i].nodeType===1&&_40===_6.xml.parser.textContent(_41._rootNode.childNodes[i])){_42=_41._rootNode.childNodes[i];break;}}}if(_3f.onItem){_43=_3f.scope?_3f.scope:_4.global;_3f.onItem.call(_43,_42);}});_45.addErrback(function(_4a){if(_3f.onError){_43=_3f.scope?_3f.scope:_4.global;_3f.onError.call(_43,_4a);}});}}else{if(this._rootNode.rows[_40+1]){_42=this._rootNode.rows[_40+1];if(_3f.onItem){_43=_3f.scope?_3f.scope:_4.global;_3f.onItem.call(_43,_42);}}}}});_4.extend(_6.data.HtmlStore,_4.data.util.simpleFetch);}}};});