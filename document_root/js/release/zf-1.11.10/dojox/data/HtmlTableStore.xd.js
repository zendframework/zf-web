/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.HtmlTableStore"],["require","dojox.xml.parser"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.HtmlTableStore"]){_4._hasResource["dojox.data.HtmlTableStore"]=true;_4.provide("dojox.data.HtmlTableStore");_4.require("dojox.xml.parser");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.declare("dojox.data.HtmlTableStore",null,{constructor:function(_7){_4.deprecated("dojox.data.HtmlTableStore","Please use dojox.data.HtmlStore");if(_7.url){if(!_7.tableId){throw new Error("dojo.data.HtmlTableStore: Cannot instantiate using url without an id!");}this.url=_7.url;this.tableId=_7.tableId;}else{if(_7.tableId){this._rootNode=_4.byId(_7.tableId);this.tableId=this._rootNode.id;}else{this._rootNode=_4.byId(this.tableId);}this._getHeadings();for(var i=0;i<this._rootNode.rows.length;i++){this._rootNode.rows[i].store=this;}}},url:"",tableId:"",_getHeadings:function(){this._headings=[];_4.forEach(this._rootNode.tHead.rows[0].cells,_4.hitch(this,function(th){this._headings.push(_6.xml.parser.textContent(th));}));},_getAllItems:function(){var _8=[];for(var i=1;i<this._rootNode.rows.length;i++){_8.push(this._rootNode.rows[i]);}return _8;},_assertIsItem:function(_9){if(!this.isItem(_9)){throw new Error("dojo.data.HtmlTableStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_a){if(typeof _a!=="string"){throw new Error("dojo.data.HtmlTableStore: a function was passed an attribute argument that was not an attribute name string");return -1;}return _4.indexOf(this._headings,_a);},getValue:function(_b,_c,_d){var _e=this.getValues(_b,_c);return (_e.length>0)?_e[0]:_d;},getValues:function(_f,_10){this._assertIsItem(_f);var _11=this._assertIsAttribute(_10);if(_11>-1){return [_6.xml.parser.textContent(_f.cells[_11])];}return [];},getAttributes:function(_12){this._assertIsItem(_12);var _13=[];for(var i=0;i<this._headings.length;i++){if(this.hasAttribute(_12,this._headings[i])){_13.push(this._headings[i]);}}return _13;},hasAttribute:function(_14,_15){return this.getValues(_14,_15).length>0;},containsValue:function(_16,_17,_18){var _19=undefined;if(typeof _18==="string"){_19=_4.data.util.filter.patternToRegExp(_18,false);}return this._containsValue(_16,_17,_18,_19);},_containsValue:function(_1a,_1b,_1c,_1d){var _1e=this.getValues(_1a,_1b);for(var i=0;i<_1e.length;++i){var _1f=_1e[i];if(typeof _1f==="string"&&_1d){return (_1f.match(_1d)!==null);}else{if(_1c===_1f){return true;}}}return false;},isItem:function(_20){if(_20&&_20.store&&_20.store===this){return true;}return false;},isItemLoaded:function(_21){return this.isItem(_21);},loadItem:function(_22){this._assertIsItem(_22.item);},_fetchItems:function(_23,_24,_25){if(this._rootNode){this._finishFetchItems(_23,_24,_25);}else{if(!this.url){this._rootNode=_4.byId(this.tableId);this._getHeadings();for(var i=0;i<this._rootNode.rows.length;i++){this._rootNode.rows[i].store=this;}}else{var _26={url:this.url,handleAs:"text"};var _27=this;var _28=_4.xhrGet(_26);_28.addCallback(function(_29){var _2a=function(_2b,id){if(_2b.id==id){return _2b;}if(_2b.childNodes){for(var i=0;i<_2b.childNodes.length;i++){var _2c=_2a(_2b.childNodes[i],id);if(_2c){return _2c;}}}return null;};var d=document.createElement("div");d.innerHTML=_29;_27._rootNode=_2a(d,_27.tableId);_27._getHeadings.call(_27);for(var i=0;i<_27._rootNode.rows.length;i++){_27._rootNode.rows[i].store=_27;}_27._finishFetchItems(_23,_24,_25);});_28.addErrback(function(_2d){_25(_2d,_23);});}}},_finishFetchItems:function(_2e,_2f,_30){var _31=null;var _32=this._getAllItems();if(_2e.query){var _33=_2e.queryOptions?_2e.queryOptions.ignoreCase:false;_31=[];var _34={};var _35;var key;for(key in _2e.query){_35=_2e.query[key]+"";if(typeof _35==="string"){_34[key]=_4.data.util.filter.patternToRegExp(_35,_33);}}for(var i=0;i<_32.length;++i){var _36=true;var _37=_32[i];for(key in _2e.query){_35=_2e.query[key]+"";if(!this._containsValue(_37,key,_35,_34[key])){_36=false;}}if(_36){_31.push(_37);}}_2f(_31,_2e);}else{if(_32.length>0){_31=_32.slice(0,_32.length);}_2f(_31,_2e);}},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Identity":true};},close:function(_38){},getLabel:function(_39){if(this.isItem(_39)){return "Table Row #"+this.getIdentity(_39);}return undefined;},getLabelAttributes:function(_3a){return null;},getIdentity:function(_3b){this._assertIsItem(_3b);if(!_4.isOpera){return _3b.sectionRowIndex;}else{return (_4.indexOf(this._rootNode.rows,_3b)-1);}},getIdentityAttributes:function(_3c){return null;},fetchItemByIdentity:function(_3d){var _3e=_3d.identity;var _3f=this;var _40=null;var _41=null;if(!this._rootNode){if(!this.url){this._rootNode=_4.byId(this.tableId);this._getHeadings();for(var i=0;i<this._rootNode.rows.length;i++){this._rootNode.rows[i].store=this;}_40=this._rootNode.rows[_3e+1];if(_3d.onItem){_41=_3d.scope?_3d.scope:_4.global;_3d.onItem.call(_41,_40);}}else{var _42={url:this.url,handleAs:"text"};var _43=_4.xhrGet(_42);_43.addCallback(function(_44){var _45=function(_46,id){if(_46.id==id){return _46;}if(_46.childNodes){for(var i=0;i<_46.childNodes.length;i++){var _47=_45(_46.childNodes[i],id);if(_47){return _47;}}}return null;};var d=document.createElement("div");d.innerHTML=_44;_3f._rootNode=_45(d,_3f.tableId);_3f._getHeadings.call(_3f);for(var i=0;i<_3f._rootNode.rows.length;i++){_3f._rootNode.rows[i].store=_3f;}_40=_3f._rootNode.rows[_3e+1];if(_3d.onItem){_41=_3d.scope?_3d.scope:_4.global;_3d.onItem.call(_41,_40);}});_43.addErrback(function(_48){if(_3d.onError){_41=_3d.scope?_3d.scope:_4.global;_3d.onError.call(_41,_48);}});}}else{if(this._rootNode.rows[_3e+1]){_40=this._rootNode.rows[_3e+1];if(_3d.onItem){_41=_3d.scope?_3d.scope:_4.global;_3d.onItem.call(_41,_40);}}}}});_4.extend(_6.data.HtmlTableStore,_4.data.util.simpleFetch);}}};});