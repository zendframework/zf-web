/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.AtomReadStore"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"],["require","dojo.date.stamp"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.AtomReadStore"]){_4._hasResource["dojox.data.AtomReadStore"]=true;_4.provide("dojox.data.AtomReadStore");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.require("dojo.date.stamp");_4.experimental("dojox.data.AtomReadStore");_4.declare("dojox.data.AtomReadStore",null,{constructor:function(_7){if(_7){this.url=_7.url;this.rewriteUrl=_7.rewriteUrl;this.label=_7.label||this.label;this.sendQuery=(_7.sendQuery||_7.sendquery||this.sendQuery);this.unescapeHTML=_7.unescapeHTML;if("urlPreventCache" in _7){this.urlPreventCache=_7.urlPreventCache?true:false;}}if(!this.url){throw new Error("AtomReadStore: a URL must be specified when creating the data store");}},url:"",label:"title",sendQuery:false,unescapeHTML:false,urlPreventCache:false,getValue:function(_8,_9,_a){this._assertIsItem(_8);this._assertIsAttribute(_9);this._initItem(_8);_9=_9.toLowerCase();if(!_8._attribs[_9]&&!_8._parsed){this._parseItem(_8);_8._parsed=true;}var _b=_8._attribs[_9];if(!_b&&_9=="summary"){var _c=this.getValue(_8,"content");var _d=new RegExp("/(<([^>]+)>)/g","i");var _e=_c.text.replace(_d,"");_b={text:_e.substring(0,Math.min(400,_e.length)),type:"text"};_8._attribs[_9]=_b;}if(_b&&this.unescapeHTML){if((_9=="content"||_9=="summary"||_9=="subtitle")&&!_8["_"+_9+"Escaped"]){_b.text=this._unescapeHTML(_b.text);_8["_"+_9+"Escaped"]=true;}}return _b?_4.isArray(_b)?_b[0]:_b:_a;},getValues:function(_f,_10){this._assertIsItem(_f);this._assertIsAttribute(_10);this._initItem(_f);_10=_10.toLowerCase();if(!_f._attribs[_10]){this._parseItem(_f);}var _11=_f._attribs[_10];return _11?((_11.length!==undefined&&typeof (_11)!=="string")?_11:[_11]):undefined;},getAttributes:function(_12){this._assertIsItem(_12);if(!_12._attribs){this._initItem(_12);this._parseItem(_12);}var _13=[];for(var x in _12._attribs){_13.push(x);}return _13;},hasAttribute:function(_14,_15){return (this.getValue(_14,_15)!==undefined);},containsValue:function(_16,_17,_18){var _19=this.getValues(_16,_17);for(var i=0;i<_19.length;i++){if((typeof _18==="string")){if(_19[i].toString&&_19[i].toString()===_18){return true;}}else{if(_19[i]===_18){return true;}}}return false;},isItem:function(_1a){if(_1a&&_1a.element&&_1a.store&&_1a.store===this){return true;}return false;},isItemLoaded:function(_1b){return this.isItem(_1b);},loadItem:function(_1c){},getFeatures:function(){var _1d={"dojo.data.api.Read":true};return _1d;},getLabel:function(_1e){if((this.label!=="")&&this.isItem(_1e)){var _1f=this.getValue(_1e,this.label);if(_1f&&_1f.text){return _1f.text;}else{if(_1f){return _1f.toString();}else{return undefined;}}}return undefined;},getLabelAttributes:function(_20){if(this.label!==""){return [this.label];}return null;},getFeedValue:function(_21,_22){var _23=this.getFeedValues(_21,_22);if(_4.isArray(_23)){return _23[0];}return _23;},getFeedValues:function(_24,_25){if(!this.doc){return _25;}if(!this._feedMetaData){this._feedMetaData={element:this.doc.getElementsByTagName("feed")[0],store:this,_attribs:{}};this._parseItem(this._feedMetaData);}return this._feedMetaData._attribs[_24]||_25;},_initItem:function(_26){if(!_26._attribs){_26._attribs={};}},_fetchItems:function(_27,_28,_29){var url=this._getFetchUrl(_27);if(!url){_29(new Error("No URL specified."));return;}var _2a=(!this.sendQuery?_27:null);var _2b=this;var _2c=function(_2d){_2b.doc=_2d;var _2e=_2b._getItems(_2d,_2a);var _2f=_27.query;if(_2f){if(_2f.id){_2e=_4.filter(_2e,function(_30){return (_2b.getValue(_30,"id")==_2f.id);});}else{if(_2f.category){_2e=_4.filter(_2e,function(_31){var _32=_2b.getValues(_31,"category");if(!_32){return false;}return _4.some(_32,"return item.term=='"+_2f.category+"'");});}}}if(_2e&&_2e.length>0){_28(_2e,_27);}else{_28([],_27);}};if(this.doc){_2c(this.doc);}else{var _33={url:url,handleAs:"xml",preventCache:this.urlPreventCache};var _34=_4.xhrGet(_33);_34.addCallback(_2c);_34.addErrback(function(_35){_29(_35,_27);});}},_getFetchUrl:function(_36){if(!this.sendQuery){return this.url;}var _37=_36.query;if(!_37){return this.url;}if(_4.isString(_37)){return this.url+_37;}var _38="";for(var _39 in _37){var _3a=_37[_39];if(_3a){if(_38){_38+="&";}_38+=(_39+"="+_3a);}}if(!_38){return this.url;}var _3b=this.url;if(_3b.indexOf("?")<0){_3b+="?";}else{_3b+="&";}return _3b+_38;},_getItems:function(_3c,_3d){if(this._items){return this._items;}var _3e=[];var _3f=[];if(_3c.childNodes.length<1){this._items=_3e;console.log("dojox.data.AtomReadStore: Received an invalid Atom document. Check the content type header");return _3e;}var _40=_4.filter(_3c.childNodes,"return item.tagName && item.tagName.toLowerCase() == 'feed'");var _41=_3d.query;if(!_40||_40.length!=1){console.log("dojox.data.AtomReadStore: Received an invalid Atom document, number of feed tags = "+(_40?_40.length:0));return _3e;}_3f=_4.filter(_40[0].childNodes,"return item.tagName && item.tagName.toLowerCase() == 'entry'");if(_3d.onBegin){_3d.onBegin(_3f.length,this.sendQuery?_3d:{});}for(var i=0;i<_3f.length;i++){var _42=_3f[i];if(_42.nodeType!=1){continue;}_3e.push(this._getItem(_42));}this._items=_3e;return _3e;},close:function(_43){},_getItem:function(_44){return {element:_44,store:this};},_parseItem:function(_45){var _46=_45._attribs;var _47=this;var _48,_49;function _4a(_4b){var txt=_4b.textContent||_4b.innerHTML||_4b.innerXML;if(!txt&&_4b.childNodes[0]){var _4c=_4b.childNodes[0];if(_4c&&(_4c.nodeType==3||_4c.nodeType==4)){txt=_4b.childNodes[0].nodeValue;}}return txt;};function _4d(_4e){return {text:_4a(_4e),type:_4e.getAttribute("type")};};_4.forEach(_45.element.childNodes,function(_4f){var _50=_4f.tagName?_4f.tagName.toLowerCase():"";switch(_50){case "title":_46[_50]={text:_4a(_4f),type:_4f.getAttribute("type")};break;case "subtitle":case "summary":case "content":_46[_50]=_4d(_4f);break;case "author":var _51,_52;_4.forEach(_4f.childNodes,function(_53){if(!_53.tagName){return;}switch(_53.tagName.toLowerCase()){case "name":_51=_53;break;case "uri":_52=_53;break;}});var _54={};if(_51&&_51.length==1){_54.name=_4a(_51[0]);}if(_52&&_52.length==1){_54.uri=_4a(_52[0]);}_46[_50]=_54;break;case "id":_46[_50]=_4a(_4f);break;case "updated":_46[_50]=_4.date.stamp.fromISOString(_4a(_4f));break;case "published":_46[_50]=_4.date.stamp.fromISOString(_4a(_4f));break;case "category":if(!_46[_50]){_46[_50]=[];}_46[_50].push({scheme:_4f.getAttribute("scheme"),term:_4f.getAttribute("term")});break;case "link":if(!_46[_50]){_46[_50]=[];}var _55={rel:_4f.getAttribute("rel"),href:_4f.getAttribute("href"),type:_4f.getAttribute("type")};_46[_50].push(_55);if(_55.rel=="alternate"){_46["alternate"]=_55;}break;default:break;}});},_unescapeHTML:function(_56){_56=_56.replace(/&#8217;/m,"'").replace(/&#8243;/m,"\"").replace(/&#60;/m,">").replace(/&#62;/m,"<").replace(/&#38;/m,"&");return _56;},_assertIsItem:function(_57){if(!this.isItem(_57)){throw new Error("dojox.data.AtomReadStore: Invalid item argument.");}},_assertIsAttribute:function(_58){if(typeof _58!=="string"){throw new Error("dojox.data.AtomReadStore: Invalid attribute argument.");}}});_4.extend(_6.data.AtomReadStore,_4.data.util.simpleFetch);}}};});