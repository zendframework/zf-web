/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.AppStore"],["require","dojox.atom.io.Connection"],["require","dojo.data.util.simpleFetch"],["require","dojo.data.util.filter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.AppStore"]){_4._hasResource["dojox.data.AppStore"]=true;_4.provide("dojox.data.AppStore");_4.require("dojox.atom.io.Connection");_4.require("dojo.data.util.simpleFetch");_4.require("dojo.data.util.filter");_4.experimental("dojox.data.AppStore");_4.declare("dojox.data.AppStore",null,{url:"",urlPreventCache:false,xmethod:false,_atomIO:null,_feed:null,_requests:null,_processing:null,_updates:null,_adds:null,_deletes:null,constructor:function(_7){if(_7&&_7.url){this.url=_7.url;}if(_7&&_7.urlPreventCache){this.urlPreventCache=_7.urlPreventCache;}if(!this.url){throw new Error("A URL is required to instantiate an APP Store object");}},_setFeed:function(_8,_9){this._feed=_8;var i;for(i=0;i<this._feed.entries.length;i++){this._feed.entries[i].store=this;}if(this._requests){for(i=0;i<this._requests.length;i++){var _a=this._requests[i];if(_a.request&&_a.fh&&_a.eh){this._finishFetchItems(_a.request,_a.fh,_a.eh);}else{if(_a.clear){this._feed=null;}else{if(_a.add){this._feed.addEntry(_a.add);}else{if(_a.remove){this._feed.removeEntry(_a.remove);}}}}}}this._requests=null;},_getAllItems:function(){var _b=[];for(var i=0;i<this._feed.entries.length;i++){_b.push(this._feed.entries[i]);}return _b;},_assertIsItem:function(_c){if(!this.isItem(_c)){throw new Error("This error message is provided when a function is called in the following form: "+"getAttribute(argument, attributeName).  The argument variable represents the member "+"or owner of the object. The error is created when an item that does not belong "+"to this store is specified as an argument.");}},_assertIsAttribute:function(_d){if(typeof _d!=="string"){throw new Error("The attribute argument must be a string. The error is created "+"when a different type of variable is specified such as an array or object.");}for(var _e in _6.atom.io.model._actions){if(_e==_d){return true;}}return false;},_addUpdate:function(_f){if(!this._updates){this._updates=[_f];}else{this._updates.push(_f);}},getValue:function(_10,_11,_12){var _13=this.getValues(_10,_11);return (_13.length>0)?_13[0]:_12;},getValues:function(_14,_15){this._assertIsItem(_14);var _16=this._assertIsAttribute(_15);if(_16){if((_15==="author"||_15==="contributor"||_15==="link")&&_14[_15+"s"]){return _14[_15+"s"];}if(_15==="category"&&_14.categories){return _14.categories;}if(_14[_15]){_14=_14[_15];if(_14.declaredClass=="dojox.atom.io.model.Content"){return [_14.value];}return [_14];}}return [];},getAttributes:function(_17){this._assertIsItem(_17);var _18=[];for(var key in _6.atom.io.model._actions){if(this.hasAttribute(_17,key)){_18.push(key);}}return _18;},hasAttribute:function(_19,_1a){return this.getValues(_19,_1a).length>0;},containsValue:function(_1b,_1c,_1d){var _1e=undefined;if(typeof _1d==="string"){_1e=_4.data.util.filter.patternToRegExp(_1d,false);}return this._containsValue(_1b,_1c,_1d,_1e);},_containsValue:function(_1f,_20,_21,_22,_23){var _24=this.getValues(_1f,_20);for(var i=0;i<_24.length;++i){var _25=_24[i];if(typeof _25==="string"&&_22){if(_23){_25=_25.replace(new RegExp(/^\s+/),"");_25=_25.replace(new RegExp(/\s+$/),"");}_25=_25.replace(/\r|\n|\r\n/g,"");return (_25.match(_22)!==null);}else{if(_21===_25){return true;}}}return false;},isItem:function(_26){return _26&&_26.store&&_26.store===this;},isItemLoaded:function(_27){return this.isItem(_27);},loadItem:function(_28){this._assertIsItem(_28.item);},_fetchItems:function(_29,_2a,_2b){if(this._feed){this._finishFetchItems(_29,_2a,_2b);}else{var _2c=false;if(!this._requests){this._requests=[];_2c=true;}this._requests.push({request:_29,fh:_2a,eh:_2b});if(_2c){this._atomIO=new _6.atom.io.Connection(false,this.urlPreventCache);this._atomIO.getFeed(this.url,this._setFeed,null,this);}}},_finishFetchItems:function(_2d,_2e,_2f){var _30=null;var _31=this._getAllItems();if(_2d.query){var _32=_2d.queryOptions?_2d.queryOptions.ignoreCase:false;_30=[];var _33={};var key;var _34;for(key in _2d.query){_34=_2d.query[key]+"";if(typeof _34==="string"){_33[key]=_4.data.util.filter.patternToRegExp(_34,_32);}}for(var i=0;i<_31.length;++i){var _35=true;var _36=_31[i];for(key in _2d.query){_34=_2d.query[key]+"";if(!this._containsValue(_36,key,_34,_33[key],_2d.trim)){_35=false;}}if(_35){_30.push(_36);}}}else{if(_31.length>0){_30=_31.slice(0,_31.length);}}try{_2e(_30,_2d);}catch(e){_2f(e,_2d);}},getFeatures:function(){return {"dojo.data.api.Read":true,"dojo.data.api.Write":true,"dojo.data.api.Identity":true};},close:function(_37){this._feed=null;},getLabel:function(_38){if(this.isItem(_38)){return this.getValue(_38,"title","No Title");}return undefined;},getLabelAttributes:function(_39){return ["title"];},getIdentity:function(_3a){this._assertIsItem(_3a);return this.getValue(_3a,"id");},getIdentityAttributes:function(_3b){return ["id"];},fetchItemByIdentity:function(_3c){this._fetchItems({query:{id:_3c.identity},onItem:_3c.onItem,scope:_3c.scope},function(_3d,_3e){var _3f=_3e.scope;if(!_3f){_3f=_4.global;}if(_3d.length<1){_3e.onItem.call(_3f,null);}else{_3e.onItem.call(_3f,_3d[0]);}},_3c.onError);},newItem:function(_40){var _41=new _6.atom.io.model.Entry();var _42=null;var _43=null;var i;for(var key in _40){if(this._assertIsAttribute(key)){_42=_40[key];switch(key){case "link":for(i in _42){_43=_42[i];_41.addLink(_43.href,_43.rel,_43.hrefLang,_43.title,_43.type);}break;case "author":for(i in _42){_43=_42[i];_41.addAuthor(_43.name,_43.email,_43.uri);}break;case "contributor":for(i in _42){_43=_42[i];_41.addContributor(_43.name,_43.email,_43.uri);}break;case "category":for(i in _42){_43=_42[i];_41.addCategory(_43.scheme,_43.term,_43.label);}break;case "icon":case "id":case "logo":case "xmlBase":case "rights":_41[key]=_42;break;case "updated":case "published":case "issued":case "modified":_41[key]=_6.atom.io.model.util.createDate(_42);break;case "content":case "summary":case "title":case "subtitle":_41[key]=new _6.atom.io.model.Content(key);_41[key].value=_42;break;default:_41[key]=_42;break;}}}_41.store=this;_41.isDirty=true;if(!this._adds){this._adds=[_41];}else{this._adds.push(_41);}if(this._feed){this._feed.addEntry(_41);}else{if(this._requests){this._requests.push({add:_41});}else{this._requests=[{add:_41}];this._atomIO=new _6.atom.io.Connection(false,this.urlPreventCache);this._atomIO.getFeed(this.url,_4.hitch(this,this._setFeed));}}return true;},deleteItem:function(_44){this._assertIsItem(_44);if(!this._deletes){this._deletes=[_44];}else{this._deletes.push(_44);}if(this._feed){this._feed.removeEntry(_44);}else{if(this._requests){this._requests.push({remove:_44});}else{this._requests=[{remove:_44}];this._atomIO=new _6.atom.io.Connection(false,this.urlPreventCache);this._atomIO.getFeed(this.url,_4.hitch(this,this._setFeed));}}_44=null;return true;},setValue:function(_45,_46,_47){this._assertIsItem(_45);var _48={item:_45};if(this._assertIsAttribute(_46)){switch(_46){case "link":_48.links=_45.links;this._addUpdate(_48);_45.links=null;_45.addLink(_47.href,_47.rel,_47.hrefLang,_47.title,_47.type);_45.isDirty=true;return true;case "author":_48.authors=_45.authors;this._addUpdate(_48);_45.authors=null;_45.addAuthor(_47.name,_47.email,_47.uri);_45.isDirty=true;return true;case "contributor":_48.contributors=_45.contributors;this._addUpdate(_48);_45.contributors=null;_45.addContributor(_47.name,_47.email,_47.uri);_45.isDirty=true;return true;case "category":_48.categories=_45.categories;this._addUpdate(_48);_45.categories=null;_45.addCategory(_47.scheme,_47.term,_47.label);_45.isDirty=true;return true;case "icon":case "id":case "logo":case "xmlBase":case "rights":_48[_46]=_45[_46];this._addUpdate(_48);_45[_46]=_47;_45.isDirty=true;return true;case "updated":case "published":case "issued":case "modified":_48[_46]=_45[_46];this._addUpdate(_48);_45[_46]=_6.atom.io.model.util.createDate(_47);_45.isDirty=true;return true;case "content":case "summary":case "title":case "subtitle":_48[_46]=_45[_46];this._addUpdate(_48);_45[_46]=new _6.atom.io.model.Content(_46);_45[_46].value=_47;_45.isDirty=true;return true;default:_48[_46]=_45[_46];this._addUpdate(_48);_45[_46]=_47;_45.isDirty=true;return true;}}return false;},setValues:function(_49,_4a,_4b){if(_4b.length===0){return this.unsetAttribute(_49,_4a);}this._assertIsItem(_49);var _4c={item:_49};var _4d;var i;if(this._assertIsAttribute(_4a)){switch(_4a){case "link":_4c.links=_49.links;_49.links=null;for(i in _4b){_4d=_4b[i];_49.addLink(_4d.href,_4d.rel,_4d.hrefLang,_4d.title,_4d.type);}_49.isDirty=true;return true;case "author":_4c.authors=_49.authors;_49.authors=null;for(i in _4b){_4d=_4b[i];_49.addAuthor(_4d.name,_4d.email,_4d.uri);}_49.isDirty=true;return true;case "contributor":_4c.contributors=_49.contributors;_49.contributors=null;for(i in _4b){_4d=_4b[i];_49.addContributor(_4d.name,_4d.email,_4d.uri);}_49.isDirty=true;return true;case "categories":_4c.categories=_49.categories;_49.categories=null;for(i in _4b){_4d=_4b[i];_49.addCategory(_4d.scheme,_4d.term,_4d.label);}_49.isDirty=true;return true;case "icon":case "id":case "logo":case "xmlBase":case "rights":_4c[_4a]=_49[_4a];_49[_4a]=_4b[0];_49.isDirty=true;return true;case "updated":case "published":case "issued":case "modified":_4c[_4a]=_49[_4a];_49[_4a]=_6.atom.io.model.util.createDate(_4b[0]);_49.isDirty=true;return true;case "content":case "summary":case "title":case "subtitle":_4c[_4a]=_49[_4a];_49[_4a]=new _6.atom.io.model.Content(_4a);_49[_4a].values[0]=_4b[0];_49.isDirty=true;return true;default:_4c[_4a]=_49[_4a];_49[_4a]=_4b[0];_49.isDirty=true;return true;}}this._addUpdate(_4c);return false;},unsetAttribute:function(_4e,_4f){this._assertIsItem(_4e);if(this._assertIsAttribute(_4f)){if(_4e[_4f]!==null){var _50={item:_4e};switch(_4f){case "author":case "contributor":case "link":_50[_4f+"s"]=_4e[_4f+"s"];break;case "category":_50.categories=_4e.categories;break;default:_50[_4f]=_4e[_4f];break;}_4e.isDirty=true;_4e[_4f]=null;this._addUpdate(_50);return true;}}return false;},save:function(_51){var i;for(i in this._adds){this._atomIO.addEntry(this._adds[i],null,function(){},_51.onError,false,_51.scope);}this._adds=null;for(i in this._updates){this._atomIO.updateEntry(this._updates[i].item,function(){},_51.onError,false,this.xmethod,_51.scope);}this._updates=null;for(i in this._deletes){this._atomIO.removeEntry(this._deletes[i],function(){},_51.onError,this.xmethod,_51.scope);}this._deletes=null;this._atomIO.getFeed(this.url,_4.hitch(this,this._setFeed));if(_51.onComplete){var _52=_51.scope||_4.global;_51.onComplete.call(_52);}},revert:function(){var i;for(i in this._adds){this._feed.removeEntry(this._adds[i]);}this._adds=null;var _53,_54,key;for(i in this._updates){_53=this._updates[i];_54=_53.item;for(key in _53){if(key!=="item"){_54[key]=_53[key];}}}this._updates=null;for(i in this._deletes){this._feed.addEntry(this._deletes[i]);}this._deletes=null;return true;},isDirty:function(_55){if(_55){this._assertIsItem(_55);return _55.isDirty?true:false;}return (this._adds!==null||this._updates!==null);}});_4.extend(_6.data.AppStore,_4.data.util.simpleFetch);}}};});