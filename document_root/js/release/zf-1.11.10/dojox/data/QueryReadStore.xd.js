/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.QueryReadStore"],["require","dojo.string"],["require","dojo.data.util.sorter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.QueryReadStore"]){_4._hasResource["dojox.data.QueryReadStore"]=true;_4.provide("dojox.data.QueryReadStore");_4.require("dojo.string");_4.require("dojo.data.util.sorter");_4.declare("dojox.data.QueryReadStore",null,{url:"",requestMethod:"get",_className:"dojox.data.QueryReadStore",_items:[],_lastServerQuery:null,_numRows:-1,lastRequestHash:null,doClientPaging:false,doClientSorting:false,_itemsByIdentity:null,_identifier:null,_features:{"dojo.data.api.Read":true,"dojo.data.api.Identity":true},_labelAttr:"label",constructor:function(_7){_4.mixin(this,_7);},getValue:function(_8,_9,_a){this._assertIsItem(_8);if(!_4.isString(_9)){throw new Error(this._className+".getValue(): Invalid attribute, string expected!");}if(!this.hasAttribute(_8,_9)){if(_a){return _a;}console.log(this._className+".getValue(): Item does not have the attribute '"+_9+"'.");}return _8.i[_9];},getValues:function(_b,_c){this._assertIsItem(_b);var _d=[];if(this.hasAttribute(_b,_c)){_d.push(_b.i[_c]);}return _d;},getAttributes:function(_e){this._assertIsItem(_e);var _f=[];for(var i in _e.i){_f.push(i);}return _f;},hasAttribute:function(_10,_11){return this.isItem(_10)&&typeof _10.i[_11]!="undefined";},containsValue:function(_12,_13,_14){var _15=this.getValues(_12,_13);var len=_15.length;for(var i=0;i<len;i++){if(_15[i]==_14){return true;}}return false;},isItem:function(_16){if(_16){return typeof _16.r!="undefined"&&_16.r==this;}return false;},isItemLoaded:function(_17){return this.isItem(_17);},loadItem:function(_18){if(this.isItemLoaded(_18.item)){return;}},fetch:function(_19){_19=_19||{};if(!_19.store){_19.store=this;}var _1a=this;var _1b=function(_1c,_1d){if(_1d.onError){var _1e=_1d.scope||_4.global;_1d.onError.call(_1e,_1c,_1d);}};var _1f=function(_20,_21,_22){var _23=_21.abort||null;var _24=false;var _25=_21.start?_21.start:0;if(_1a.doClientPaging==false){_25=0;}var _26=_21.count?(_25+_21.count):_20.length;_21.abort=function(){_24=true;if(_23){_23.call(_21);}};var _27=_21.scope||_4.global;if(!_21.store){_21.store=_1a;}if(_21.onBegin){_21.onBegin.call(_27,_22,_21);}if(_21.sort&&_1a.doClientSorting){_20.sort(_4.data.util.sorter.createSortFunction(_21.sort,_1a));}if(_21.onItem){for(var i=_25;(i<_20.length)&&(i<_26);++i){var _28=_20[i];if(!_24){_21.onItem.call(_27,_28,_21);}}}if(_21.onComplete&&!_24){var _29=null;if(!_21.onItem){_29=_20.slice(_25,_26);}_21.onComplete.call(_27,_29,_21);}};this._fetchItems(_19,_1f,_1b);return _19;},getFeatures:function(){return this._features;},close:function(_2a){},getLabel:function(_2b){if(this._labelAttr&&this.isItem(_2b)){return this.getValue(_2b,this._labelAttr);}return undefined;},getLabelAttributes:function(_2c){if(this._labelAttr){return [this._labelAttr];}return null;},_xhrFetchHandler:function(_2d,_2e,_2f,_30){_2d=this._filterResponse(_2d);if(_2d.label){this._labelAttr=_2d.label;}var _31=_2d.numRows||-1;this._items=[];_4.forEach(_2d.items,function(e){this._items.push({i:e,r:this});},this);var _32=_2d.identifier;this._itemsByIdentity={};if(_32){this._identifier=_32;var i;for(i=0;i<this._items.length;++i){var _33=this._items[i].i;var _34=_33[_32];if(!this._itemsByIdentity[_34]){this._itemsByIdentity[_34]=_33;}else{throw new Error(this._className+":  The json data as specified by: ["+this.url+"] is malformed.  Items within the list have identifier: ["+_32+"].  Value collided: ["+_34+"]");}}}else{this._identifier=Number;for(i=0;i<this._items.length;++i){this._items[i].n=i;}}_31=this._numRows=(_31===-1)?this._items.length:_31;_2f(this._items,_2e,_31);this._numRows=_31;},_fetchItems:function(_35,_36,_37){var _38=_35.serverQuery||_35.query||{};if(!this.doClientPaging){_38.start=_35.start||0;if(_35.count){_38.count=_35.count;}}if(!this.doClientSorting){if(_35.sort){var _39=_35.sort[0];if(_39&&_39.attribute){var _3a=_39.attribute;if(_39.descending){_3a="-"+_3a;}_38.sort=_3a;}}}if(this.doClientPaging&&this._lastServerQuery!==null&&_4.toJson(_38)==_4.toJson(this._lastServerQuery)){this._numRows=(this._numRows===-1)?this._items.length:this._numRows;_36(this._items,_35,this._numRows);}else{var _3b=this.requestMethod.toLowerCase()=="post"?_4.xhrPost:_4.xhrGet;var _3c=_3b({url:this.url,handleAs:"json-comment-optional",content:_38});_3c.addCallback(_4.hitch(this,function(_3d){this._xhrFetchHandler(_3d,_35,_36,_37);}));_3c.addErrback(function(_3e){_37(_3e,_35);});this.lastRequestHash=new Date().getTime()+"-"+String(Math.random()).substring(2);this._lastServerQuery=_4.mixin({},_38);}},_filterResponse:function(_3f){return _3f;},_assertIsItem:function(_40){if(!this.isItem(_40)){throw new Error(this._className+": Invalid item argument.");}},_assertIsAttribute:function(_41){if(typeof _41!=="string"){throw new Error(this._className+": Invalid attribute argument ('"+_41+"').");}},fetchItemByIdentity:function(_42){if(this._itemsByIdentity){var _43=this._itemsByIdentity[_42.identity];if(!(_43===undefined)){if(_42.onItem){var _44=_42.scope?_42.scope:_4.global;_42.onItem.call(_44,{i:_43,r:this});}return;}}var _45=function(_46,_47){var _48=_42.scope?_42.scope:_4.global;if(_42.onError){_42.onError.call(_48,_46);}};var _49=function(_4a,_4b){var _4c=_42.scope?_42.scope:_4.global;try{var _4d=null;if(_4a&&_4a.length==1){_4d=_4a[0];}if(_42.onItem){_42.onItem.call(_4c,_4d);}}catch(error){if(_42.onError){_42.onError.call(_4c,error);}}};var _4e={serverQuery:{id:_42.identity}};this._fetchItems(_4e,_49,_45);},getIdentity:function(_4f){var _50=null;if(this._identifier===Number){_50=_4f.n;}else{_50=_4f.i[this._identifier];}return _50;},getIdentityAttributes:function(_51){return [this._identifier];}});}}};});