/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit._editor.plugins.FontChoice"],["require","dijit._editor._Plugin"],["require","dijit._editor.range"],["require","dijit._editor.selection"],["require","dijit.form.FilteringSelect"],["require","dojo.data.ItemFileReadStore"],["require","dojo.i18n"],["requireLocalization","dijit._editor","FontChoice",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit._editor.plugins.FontChoice"]){_4._hasResource["dijit._editor.plugins.FontChoice"]=true;_4.provide("dijit._editor.plugins.FontChoice");_4.require("dijit._editor._Plugin");_4.require("dijit._editor.range");_4.require("dijit._editor.selection");_4.require("dijit.form.FilteringSelect");_4.require("dojo.data.ItemFileReadStore");_4.require("dojo.i18n");_4.declare("dijit._editor.plugins._FontDropDown",[_5._Widget,_5._Templated],{label:"",widgetsInTemplate:true,plainText:false,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'>"+"<label class='dijitLeft dijitInline' for='${selectId}'>${label}</label>"+"<input dojoType='dijit.form.FilteringSelect' required=false labelType=html labelAttr=label searchAttr=name "+"tabIndex='-1' id='${selectId}' dojoAttachPoint='select' value=''/>"+"</span>",postMixInProperties:function(){this.inherited(arguments);this.strings=_4.i18n.getLocalization("dijit._editor","FontChoice");this.label=this.strings[this.command];this.id=_5.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.selectId=this.id+"_select";this.inherited(arguments);},postCreate:function(){var _7=_4.map(this.values,function(_8){var _9=this.strings[_8]||_8;return {label:this.getLabel(_8,_9),name:_9,value:_8};},this);this.select.store=new _4.data.ItemFileReadStore({data:{identifier:"value",items:_7}});this.select.attr("value","",false);this.disabled=this.select.attr("disabled");},_setValueAttr:function(_a,_b){_b=_b!==false?true:false;this.select.attr("value",_4.indexOf(this.values,_a)<0?"":_a,_b);if(!_b){this.select._lastValueReported=null;}},_getValueAttr:function(){return this.select.attr("value");},focus:function(){this.select.focus();},_setDisabledAttr:function(_c){this.disabled=_c;this.select.attr("disabled",_c);}});_4.declare("dijit._editor.plugins._FontNameDropDown",_5._editor.plugins._FontDropDown,{generic:false,command:"fontName",postMixInProperties:function(){if(!this.values){this.values=this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"];}this.inherited(arguments);},getLabel:function(_d,_e){if(this.plainText){return _e;}else{return "<div style='font-family: "+_d+"'>"+_e+"</div>";}},_setValueAttr:function(_f,_10){_10=_10!==false?true:false;if(this.generic){var map={"Arial":"sans-serif","Helvetica":"sans-serif","Myriad":"sans-serif","Times":"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive","Courier":"monospace","Courier New":"monospace","Papyrus":"fantasy"};_f=map[_f]||_f;}this.inherited(arguments,[_f,_10]);}});_4.declare("dijit._editor.plugins._FontSizeDropDown",_5._editor.plugins._FontDropDown,{command:"fontSize",values:[1,2,3,4,5,6,7],getLabel:function(_11,_12){if(this.plainText){return _12;}else{return "<font size="+_11+"'>"+_12+"</font>";}},_setValueAttr:function(_13,_14){_14=_14!==false?true:false;if(_13.indexOf&&_13.indexOf("px")!=-1){var _15=parseInt(_13,10);_13={10:1,13:2,16:3,18:4,24:5,32:6,48:7}[_15]||_13;}this.inherited(arguments,[_13,_14]);}});_4.declare("dijit._editor.plugins._FormatBlockDropDown",_5._editor.plugins._FontDropDown,{command:"formatBlock",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments);this.attr("value","noFormat",false);},getLabel:function(_16,_17){if(this.plainText){return _17;}else{return "<"+_16+">"+_17+"</"+_16+">";}},_execCommand:function(_18,_19,_1a){if(_1a==="noFormat"){var _1b;var end;var sel=_5.range.getSelection(_18.window);if(sel&&sel.rangeCount>0){var _1c=sel.getRangeAt(0);var _1d,tag;if(_1c){_1b=_1c.startContainer;end=_1c.endContainer;while(_1b&&_1b!==_18.editNode&&_1b!==_18.document.body&&_1b.nodeType!==1){_1b=_1b.parentNode;}while(end&&end!==_18.editNode&&end!==_18.document.body&&end.nodeType!==1){end=end.parentNode;}var _1e=_4.hitch(this,function(_1f,_20){if(_1f.childNodes&&_1f.childNodes.length){var i;for(i=0;i<_1f.childNodes.length;i++){var c=_1f.childNodes[i];if(c.nodeType==1){if(_4.withGlobal(_18.window,"inSelection",_5._editor.selection,[c])){var tag=c.tagName?c.tagName.toLowerCase():"";if(_4.indexOf(this.values,tag)!==-1){_20.push(c);}_1e(c,_20);}}}}});var _21=_4.hitch(this,function(_22){if(_22&&_22.length){_18.beginEditing();while(_22.length){this._removeFormat(_18,_22.pop());}_18.endEditing();}});var _23=[];if(_1b==end){var _24;_1d=_1b;while(_1d&&_1d!==_18.editNode&&_1d!==_18.document.body){if(_1d.nodeType==1){tag=_1d.tagName?_1d.tagName.toLowerCase():"";if(_4.indexOf(this.values,tag)!==-1){_24=_1d;break;}}_1d=_1d.parentNode;}_1e(_1b,_23);if(_24){_23=[_24].concat(_23);}_21(_23);}else{_1d=_1b;while(_4.withGlobal(_18.window,"inSelection",_5._editor.selection,[_1d])){if(_1d.nodeType==1){tag=_1d.tagName?_1d.tagName.toLowerCase():"";if(_4.indexOf(this.values,tag)!==-1){_23.push(_1d);}_1e(_1d,_23);}_1d=_1d.nextSibling;}_21(_23);}_18.onDisplayChanged();}}}else{_18.execCommand(_19,_1a);}},_removeFormat:function(_25,_26){if(_25.customUndo){while(_26.firstChild){_4.place(_26.firstChild,_26,"before");}_26.parentNode.removeChild(_26);}else{_4.withGlobal(_25.window,"selectElementChildren",_5._editor.selection,[_26]);var _27=_4.withGlobal(_25.window,"getSelectedHtml",_5._editor.selection,[null]);_4.withGlobal(_25.window,"selectElement",_5._editor.selection,[_26]);_25.execCommand("inserthtml",_27||"");}}});_4.declare("dijit._editor.plugins.FontChoice",_5._editor._Plugin,{useDefaultCommand:false,_initButton:function(){var _28={fontName:_5._editor.plugins._FontNameDropDown,fontSize:_5._editor.plugins._FontSizeDropDown,formatBlock:_5._editor.plugins._FormatBlockDropDown}[this.command],_29=this.params;if(this.params.custom){_29.values=this.params.custom;}this.button=new _28(_29);this.connect(this.button.select,"onChange",function(_2a){this.editor.focus();if(this.command=="fontName"&&_2a.indexOf(" ")!=-1){_2a="'"+_2a+"'";}if(this.button._execCommand){this.button._execCommand(this.editor,this.command,_2a);}else{this.editor.execCommand(this.command,_2a);}this.editor.customUndo=this.editor.customUndo||_4.isWebKit;});},updateState:function(){var _2b=this.editor;var _2c=this.command;if(!_2b||!_2b.isLoaded||!_2c.length){return;}if(this.button){var _2d;try{_2d=_2b.queryCommandValue(_2c)||"";}catch(e){_2d="";}var _2e=_4.isString(_2d)&&_2d.match(/'([^']*)'/);if(_2e){_2d=_2e[1];}if(_2c==="formatBlock"){if(!_2d||_2d=="p"){_2d=null;var _2f;var sel=_5.range.getSelection(this.editor.window);if(sel&&sel.rangeCount>0){var _30=sel.getRangeAt(0);if(_30){_2f=_30.endContainer;}}while(_2f&&_2f!==_2b.editNode&&_2f!==_2b.document){var tg=_2f.tagName?_2f.tagName.toLowerCase():"";if(tg&&_4.indexOf(this.button.values,tg)>-1){_2d=tg;break;}_2f=_2f.parentNode;}if(!_2d){_2d="noFormat";}}else{if(_4.indexOf(this.button.values,_2d)<0){_2d="noFormat";}}}if(_2d!==this.button.attr("value")){this.button.attr("value",_2d,false);}}}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}switch(o.args.name){case "fontName":case "fontSize":case "formatBlock":o.plugin=new _5._editor.plugins.FontChoice({command:o.args.name,plainText:o.args.plainText?o.args.plainText:false});}});}}};});