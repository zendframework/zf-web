/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dijit.form._FormSelectWidget"],["require","dijit.form._FormWidget"],["require","dojo.data.util.sorter"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dijit.form._FormSelectWidget"]){_4._hasResource["dijit.form._FormSelectWidget"]=true;_4.provide("dijit.form._FormSelectWidget");_4.require("dijit.form._FormWidget");_4.require("dojo.data.util.sorter");_4.declare("dijit.form._FormSelectWidget",_5.form._FormValueWidget,{multiple:false,options:null,store:null,query:null,queryOptions:null,onFetch:null,sortByLabel:true,loadChildrenOnOpen:false,getOptions:function(_7){var _8=_7,_9=this.options||[],l=_9.length;if(_8===undefined){return _9;}if(_4.isArray(_8)){return _4.map(_8,"return this.getOptions(item);",this);}if(_4.isObject(_7)){if(!_4.some(this.options,function(o,_a){if(o===_8||(o.value&&o.value===_8.value)){_8=_a;return true;}return false;})){_8=-1;}}if(typeof _8=="string"){for(var i=0;i<l;i++){if(_9[i].value===_8){_8=i;break;}}}if(typeof _8=="number"&&_8>=0&&_8<l){return this.options[_8];}return null;},addOption:function(_b){if(!_4.isArray(_b)){_b=[_b];}_4.forEach(_b,function(i){if(i&&_4.isObject(i)){this.options.push(i);}},this);this._loadChildren();},removeOption:function(_c){if(!_4.isArray(_c)){_c=[_c];}var _d=this.getOptions(_c);_4.forEach(_d,function(i){if(i){this.options=_4.filter(this.options,function(_e,_f){return (_e.value!==i.value);});this._removeOptionItem(i);}},this);this._loadChildren();},updateOption:function(_10){if(!_4.isArray(_10)){_10=[_10];}_4.forEach(_10,function(i){var _11=this.getOptions(i),k;if(_11){for(k in i){_11[k]=i[k];}}},this);this._loadChildren();},setStore:function(_12,_13,_14){var _15=this.store;_14=_14||{};if(_15!==_12){_4.forEach(this._notifyConnections||[],_4.disconnect);delete this._notifyConnections;if(_12&&_12.getFeatures()["dojo.data.api.Notification"]){this._notifyConnections=[_4.connect(_12,"onNew",this,"_onNewItem"),_4.connect(_12,"onDelete",this,"_onDeleteItem"),_4.connect(_12,"onSet",this,"_onSetItem")];}this.store=_12;}this._onChangeActive=false;if(this.options&&this.options.length){this.removeOption(this.options);}if(_12){var cb=function(_16){if(this.sortByLabel&&!_14.sort&&_16.length){_16.sort(_4.data.util.sorter.createSortFunction([{attribute:_12.getLabelAttributes(_16[0])[0]}],_12));}if(_14.onFetch){_16=_14.onFetch(_16);}_4.forEach(_16,function(i){this._addOptionForItem(i);},this);this._loadingStore=false;this.attr("value",(("_pendingValue" in this)?this._pendingValue:_13));delete this._pendingValue;if(!this.loadChildrenOnOpen){this._loadChildren();}else{this._pseudoLoadChildren(_16);}this._fetchedWith=_17;this._lastValueReported=this.multiple?[]:null;this._onChangeActive=true;this.onSetStore();this._handleOnChange(this.value);};var _17=_4.mixin({onComplete:cb,scope:this},_14);this._loadingStore=true;_12.fetch(_17);}else{delete this._fetchedWith;}return _15;},_setValueAttr:function(_18,_19){if(this._loadingStore){this._pendingValue=_18;return;}var _1a=this.getOptions()||[];if(!_4.isArray(_18)){_18=[_18];}_4.forEach(_18,function(i,idx){if(!_4.isObject(i)){i=i+"";}if(typeof i==="string"){_18[idx]=_4.filter(_1a,function(_1b){return _1b.value===i;})[0]||{value:"",label:""};}},this);_18=_4.filter(_18,function(i){return i&&i.value;});if(!this.multiple&&(!_18[0]||!_18[0].value)&&_1a.length){_18[0]=_1a[0];}_4.forEach(_1a,function(i){i.selected=_4.some(_18,function(v){return v.value===i.value;});});var val=_4.map(_18,function(i){return i.value;}),_1c=_4.map(_18,function(i){return i.label;});this.value=this.multiple?val:val[0];this._setDisplay(this.multiple?_1c:_1c[0]);this._updateSelection();this._handleOnChange(this.value,_19);},_getDisplayedValueAttr:function(){var val=this.attr("value");if(!_4.isArray(val)){val=[val];}var ret=_4.map(this.getOptions(val),function(v){if(v&&"label" in v){return v.label;}else{if(v){return v.value;}}return null;},this);return this.multiple?ret:ret[0];},_getValueDeprecated:false,getValue:function(){return this._lastValue;},undo:function(){this._setValueAttr(this._lastValueReported,false);},_loadChildren:function(){if(this._loadingStore){return;}_4.forEach(this._getChildren(),function(_1d){_1d.destroyRecursive();});_4.forEach(this.options,this._addOptionItem,this);this._updateSelection();},_updateSelection:function(){this.value=this._getValueFromOpts();var val=this.value;if(!_4.isArray(val)){val=[val];}if(val&&val[0]){_4.forEach(this._getChildren(),function(_1e){var _1f=_4.some(val,function(v){return _1e.option&&(v===_1e.option.value);});_4.toggleClass(_1e.domNode,this.baseClass+"SelectedOption",_1f);_5.setWaiState(_1e.domNode,"selected",_1f);},this);}this._handleOnChange(this.value);},_getValueFromOpts:function(){var _20=this.getOptions()||[];if(!this.multiple&&_20.length){var opt=_4.filter(_20,function(i){return i.selected;})[0];if(opt&&opt.value){return opt.value;}else{_20[0].selected=true;return _20[0].value;}}else{if(this.multiple){return _4.map(_4.filter(_20,function(i){return i.selected;}),function(i){return i.value;})||[];}}return "";},_onNewItem:function(_21,_22){if(!_22||!_22.parent){this._addOptionForItem(_21);}},_onDeleteItem:function(_23){var _24=this.store;this.removeOption(_24.getIdentity(_23));},_onSetItem:function(_25){this.updateOption(this._getOptionObjForItem(_25));},_getOptionObjForItem:function(_26){var _27=this.store,_28=_27.getLabel(_26),_29=(_28?_27.getIdentity(_26):null);return {value:_29,label:_28,item:_26};},_addOptionForItem:function(_2a){var _2b=this.store;if(!_2b.isItemLoaded(_2a)){_2b.loadItem({item:_2a,onComplete:function(i){this._addOptionForItem(_2a);},scope:this});return;}var _2c=this._getOptionObjForItem(_2a);this.addOption(_2c);},constructor:function(_2d){this._oValue=(_2d||{}).value||null;},_fillContent:function(){var _2e=this.options;if(!_2e){_2e=this.options=this.srcNodeRef?_4.query(">",this.srcNodeRef).map(function(_2f){if(_2f.getAttribute("type")==="separator"){return {value:"",label:"",selected:false,disabled:false};}return {value:_2f.getAttribute("value"),label:String(_2f.innerHTML),selected:_2f.getAttribute("selected")||false,disabled:_2f.getAttribute("disabled")||false};},this):[];}if(!this.value){this.value=this._getValueFromOpts();}else{if(this.multiple&&typeof this.value=="string"){this.value=this.value.split(",");}}},postCreate:function(){_4.setSelectable(this.focusNode,false);this.inherited(arguments);this.connect(this,"onChange","_updateSelection");this.connect(this,"startup","_loadChildren");this._setValueAttr(this.value,null);},startup:function(){this.inherited(arguments);var _30=this.store,_31={};_4.forEach(["query","queryOptions","onFetch"],function(i){if(this[i]){_31[i]=this[i];}delete this[i];},this);if(_30&&_30.getFeatures()["dojo.data.api.Identity"]){this.store=null;this.setStore(_30,this._oValue,_31);}},destroy:function(){_4.forEach(this._notifyConnections||[],_4.disconnect);this.inherited(arguments);},_addOptionItem:function(_32){},_removeOptionItem:function(_33){},_setDisplay:function(_34){},_getChildren:function(){return [];},_getSelectedOptionsAttr:function(){return this.getOptions(this.attr("value"));},_pseudoLoadChildren:function(_35){},onSetStore:function(){}});}}};});