/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojo._base.xhr"],["require","dojo._base.Deferred"],["require","dojo._base.json"],["require","dojo._base.lang"],["require","dojo._base.query"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojo._base.xhr"]){_4._hasResource["dojo._base.xhr"]=true;_4.provide("dojo._base.xhr");_4.require("dojo._base.Deferred");_4.require("dojo._base.json");_4.require("dojo._base.lang");_4.require("dojo._base.query");(function(){var _7=_4,_8=_7.config;function _9(_a,_b,_c){if(_c===null){return;}var _d=_a[_b];if(typeof _d=="string"){_a[_b]=[_d,_c];}else{if(_7.isArray(_d)){_d.push(_c);}else{_a[_b]=_c;}}};_4.fieldToObject=function(_e){var _f=null;var _10=_7.byId(_e);if(_10){var _11=_10.name;var _12=(_10.type||"").toLowerCase();if(_11&&_12&&!_10.disabled){if(_12=="radio"||_12=="checkbox"){if(_10.checked){_f=_10.value;}}else{if(_10.multiple){_f=[];_7.query("option",_10).forEach(function(opt){if(opt.selected){_f.push(opt.value);}});}else{_f=_10.value;}}}}return _f;};_4.formToObject=function(_13){var ret={};var _14="file|submit|image|reset|button|";_7.forEach(_4.byId(_13).elements,function(_15){var _16=_15.name;var _17=(_15.type||"").toLowerCase();if(_16&&_17&&_14.indexOf(_17)==-1&&!_15.disabled){_9(ret,_16,_7.fieldToObject(_15));if(_17=="image"){ret[_16+".x"]=ret[_16+".y"]=ret[_16].x=ret[_16].y=0;}}});return ret;};_4.objectToQuery=function(map){var enc=encodeURIComponent;var _18=[];var _19={};for(var _1a in map){var _1b=map[_1a];if(_1b!=_19[_1a]){var _1c=enc(_1a)+"=";if(_7.isArray(_1b)){for(var i=0;i<_1b.length;i++){_18.push(_1c+enc(_1b[i]));}}else{_18.push(_1c+enc(_1b));}}}return _18.join("&");};_4.formToQuery=function(_1d){return _7.objectToQuery(_7.formToObject(_1d));};_4.formToJson=function(_1e,_1f){return _7.toJson(_7.formToObject(_1e),_1f);};_4.queryToObject=function(str){var ret={};var qp=str.split("&");var dec=decodeURIComponent;_7.forEach(qp,function(_20){if(_20.length){var _21=_20.split("=");var _22=dec(_21.shift());var val=dec(_21.join("="));if(typeof ret[_22]=="string"){ret[_22]=[ret[_22]];}if(_7.isArray(ret[_22])){ret[_22].push(val);}else{ret[_22]=val;}}});return ret;};_4._blockAsync=false;var _23=_7._contentHandlers=_4.contentHandlers={text:function(xhr){return xhr.responseText;},json:function(xhr){return _7.fromJson(xhr.responseText||null);},"json-comment-filtered":function(xhr){if(!_4.config.useCommentedJson){console.warn("Consider using the standard mimetype:application/json."+" json-commenting can introduce security issues. To"+" decrease the chances of hijacking, use the standard the 'json' handler and"+" prefix your json with: {}&&\n"+"Use djConfig.useCommentedJson=true to turn off this message.");}var _24=xhr.responseText;var _25=_24.indexOf("/*");var _26=_24.lastIndexOf("*/");if(_25==-1||_26==-1){throw new Error("JSON was not comment filtered");}return _7.fromJson(_24.substring(_25+2,_26));},javascript:function(xhr){return _7.eval(xhr.responseText);},xml:function(xhr){var _27=xhr.responseXML;if(_7.isIE&&(!_27||!_27.documentElement)){var ms=function(n){return "MSXML"+n+".DOMDocument";};var dp=["Microsoft.XMLDOM",ms(6),ms(4),ms(3),ms(2)];_7.some(dp,function(p){try{var dom=new ActiveXObject(p);dom.async=false;dom.loadXML(xhr.responseText);_27=dom;}catch(e){return false;}return true;});}return _27;},"json-comment-optional":function(xhr){if(xhr.responseText&&/^[^{\[]*\/\*/.test(xhr.responseText)){return _23["json-comment-filtered"](xhr);}else{return _23["json"](xhr);}}};_4._ioSetArgs=function(_28,_29,_2a,_2b){var _2c={args:_28,url:_28.url};var _2d=null;if(_28.form){var _2e=_7.byId(_28.form);var _2f=_2e.getAttributeNode("action");_2c.url=_2c.url||(_2f?_2f.value:null);_2d=_7.formToObject(_2e);}var _30=[{}];if(_2d){_30.push(_2d);}if(_28.content){_30.push(_28.content);}if(_28.preventCache){_30.push({"dojo.preventCache":new Date().valueOf()});}_2c.query=_7.objectToQuery(_7.mixin.apply(null,_30));_2c.handleAs=_28.handleAs||"text";var d=new _7.Deferred(_29);d.addCallbacks(_2a,function(_31){return _2b(_31,d);});var ld=_28.load;if(ld&&_7.isFunction(ld)){d.addCallback(function(_32){return ld.call(_28,_32,_2c);});}var err=_28.error;if(err&&_7.isFunction(err)){d.addErrback(function(_33){return err.call(_28,_33,_2c);});}var _34=_28.handle;if(_34&&_7.isFunction(_34)){d.addBoth(function(_35){return _34.call(_28,_35,_2c);});}if(_8.ioPublish&&_7.publish&&_2c.args.ioPublish!==false){d.addCallbacks(function(res){_7.publish("/dojo/io/load",[d,res]);return res;},function(res){_7.publish("/dojo/io/error",[d,res]);return res;});d.addBoth(function(res){_7.publish("/dojo/io/done",[d,res]);return res;});}d.ioArgs=_2c;return d;};var _36=function(dfd){dfd.canceled=true;var xhr=dfd.ioArgs.xhr;var _37=typeof xhr.abort;if(_37=="function"||_37=="object"||_37=="unknown"){xhr.abort();}var err=dfd.ioArgs.error;if(!err){err=new Error("xhr cancelled");err.dojoType="cancel";}return err;};var _38=function(dfd){var ret=_23[dfd.ioArgs.handleAs](dfd.ioArgs.xhr);return ret===undefined?null:ret;};var _39=function(_3a,dfd){if(!dfd.ioArgs.args.failOk){console.error(_3a);}return _3a;};var _3b=null;var _3c=[];var _3d=0;var _3e=function(dfd){if(_3d<=0){_3d=0;if(_8.ioPublish&&_7.publish&&(!dfd||dfd&&dfd.ioArgs.args.ioPublish!==false)){_7.publish("/dojo/io/stop");}}};var _3f=function(){var now=(new Date()).getTime();if(!_7._blockAsync){for(var i=0,tif;i<_3c.length&&(tif=_3c[i]);i++){var dfd=tif.dfd;var _40=function(){if(!dfd||dfd.canceled||!tif.validCheck(dfd)){_3c.splice(i--,1);_3d-=1;}else{if(tif.ioCheck(dfd)){_3c.splice(i--,1);tif.resHandle(dfd);_3d-=1;}else{if(dfd.startTime){if(dfd.startTime+(dfd.ioArgs.args.timeout||0)<now){_3c.splice(i--,1);var err=new Error("timeout exceeded");err.dojoType="timeout";dfd.errback(err);dfd.cancel();_3d-=1;}}}}};if(_4.config.debugAtAllCosts){_40.call(this);}else{try{_40.call(this);}catch(e){dfd.errback(e);}}}}_3e(dfd);if(!_3c.length){clearInterval(_3b);_3b=null;return;}};_4._ioCancelAll=function(){try{_7.forEach(_3c,function(i){try{i.dfd.cancel();}catch(e){}});}catch(e){}};if(_7.isIE){_7.addOnWindowUnload(_7._ioCancelAll);}_7._ioNotifyStart=function(dfd){if(_8.ioPublish&&_7.publish&&dfd.ioArgs.args.ioPublish!==false){if(!_3d){_7.publish("/dojo/io/start");}_3d+=1;_7.publish("/dojo/io/send",[dfd]);}};_7._ioWatch=function(dfd,_41,_42,_43){var _44=dfd.ioArgs.args;if(_44.timeout){dfd.startTime=(new Date()).getTime();}_3c.push({dfd:dfd,validCheck:_41,ioCheck:_42,resHandle:_43});if(!_3b){_3b=setInterval(_3f,50);}if(_44.sync){_3f();}};var _45="application/x-www-form-urlencoded";var _46=function(dfd){return dfd.ioArgs.xhr.readyState;};var _47=function(dfd){return 4==dfd.ioArgs.xhr.readyState;};var _48=function(dfd){var xhr=dfd.ioArgs.xhr;if(_7._isDocumentOk(xhr)){dfd.callback(dfd);}else{var err=new Error("Unable to load "+dfd.ioArgs.url+" status:"+xhr.status);err.status=xhr.status;err.responseText=xhr.responseText;dfd.errback(err);}};_4._ioAddQueryToUrl=function(_49){if(_49.query.length){_49.url+=(_49.url.indexOf("?")==-1?"?":"&")+_49.query;_49.query=null;}};_4.xhr=function(_4a,_4b,_4c){var dfd=_7._ioSetArgs(_4b,_36,_38,_39);var _4d=dfd.ioArgs;var xhr=_4d.xhr=_7._xhrObj(_4d.args);if(!xhr){dfd.cancel();return dfd;}if("postData" in _4b){_4d.query=_4b.postData;}else{if("putData" in _4b){_4d.query=_4b.putData;}else{if("rawBody" in _4b){_4d.query=_4b.rawBody;}else{if((arguments.length>2&&!_4c)||"POST|PUT".indexOf(_4a.toUpperCase())==-1){_7._ioAddQueryToUrl(_4d);}}}}xhr.open(_4a,_4d.url,_4b.sync!==true,_4b.user||undefined,_4b.password||undefined);if(_4b.headers){for(var hdr in _4b.headers){if(hdr.toLowerCase()==="content-type"&&!_4b.contentType){_4b.contentType=_4b.headers[hdr];}else{if(_4b.headers[hdr]){xhr.setRequestHeader(hdr,_4b.headers[hdr]);}}}}xhr.setRequestHeader("Content-Type",_4b.contentType||_45);if(!_4b.headers||!("X-Requested-With" in _4b.headers)){xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");}_7._ioNotifyStart(dfd);if(_4.config.debugAtAllCosts){xhr.send(_4d.query);}else{try{xhr.send(_4d.query);}catch(e){_4d.error=e;dfd.cancel();}}_7._ioWatch(dfd,_46,_47,_48);xhr=null;return dfd;};_4.xhrGet=function(_4e){return _7.xhr("GET",_4e);};_4.rawXhrPost=_4.xhrPost=function(_4f){return _7.xhr("POST",_4f,true);};_4.rawXhrPut=_4.xhrPut=function(_50){return _7.xhr("PUT",_50,true);};_4.xhrDelete=function(_51){return _7.xhr("DELETE",_51);};})();}}};});