/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.OpmlStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.OpmlStore"]){_4._hasResource["dojox.data.OpmlStore"]=true;_4.provide("dojox.data.OpmlStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.simpleFetch");_4.declare("dojox.data.OpmlStore",null,{constructor:function(_7){this._xmlData=null;this._arrayOfTopLevelItems=[];this._arrayOfAllItems=[];this._metadataNodes=null;this._loadFinished=false;this.url=_7.url;this._opmlData=_7.data;if(_7.label){this.label=_7.label;}this._loadInProgress=false;this._queuedFetches=[];this._identityMap={};this._identCount=0;this._idProp="_I";if(_7&&"urlPreventCache" in _7){this.urlPreventCache=_7.urlPreventCache?true:false;}},label:"text",url:"",urlPreventCache:false,_assertIsItem:function(_8){if(!this.isItem(_8)){throw new Error("dojo.data.OpmlStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_9){if(!_4.isString(_9)){throw new Error("dojox.data.OpmlStore: a function was passed an attribute argument that was not an attribute object nor an attribute name string");}},_removeChildNodesThatAreNotElementNodes:function(_a,_b){var _c=_a.childNodes;if(_c.length===0){return;}var _d=[];var i,_e;for(i=0;i<_c.length;++i){_e=_c[i];if(_e.nodeType!=1){_d.push(_e);}}for(i=0;i<_d.length;++i){_e=_d[i];_a.removeChild(_e);}if(_b){for(i=0;i<_c.length;++i){_e=_c[i];this._removeChildNodesThatAreNotElementNodes(_e,_b);}}},_processRawXmlTree:function(_f){this._loadFinished=true;this._xmlData=_f;var _10=_f.getElementsByTagName("head");var _11=_10[0];if(_11){this._removeChildNodesThatAreNotElementNodes(_11);this._metadataNodes=_11.childNodes;}var _12=_f.getElementsByTagName("body");var _13=_12[0];if(_13){this._removeChildNodesThatAreNotElementNodes(_13,true);var _14=_12[0].childNodes;for(var i=0;i<_14.length;++i){var _15=_14[i];if(_15.tagName=="outline"){this._identityMap[this._identCount]=_15;this._identCount++;this._arrayOfTopLevelItems.push(_15);this._arrayOfAllItems.push(_15);this._checkChildNodes(_15);}}}},_checkChildNodes:function(_16){if(_16.firstChild){for(var i=0;i<_16.childNodes.length;i++){var _17=_16.childNodes[i];if(_17.tagName=="outline"){this._identityMap[this._identCount]=_17;this._identCount++;this._arrayOfAllItems.push(_17);this._checkChildNodes(_17);}}}},_getItemsArray:function(_18){if(_18&&_18.deep){return this._arrayOfAllItems;}return this._arrayOfTopLevelItems;},getValue:function(_19,_1a,_1b){this._assertIsItem(_19);this._assertIsAttribute(_1a);if(_1a=="children"){return (_19.firstChild||_1b);}else{var _1c=_19.getAttribute(_1a);return (_1c!==undefined)?_1c:_1b;}},getValues:function(_1d,_1e){this._assertIsItem(_1d);this._assertIsAttribute(_1e);var _1f=[];if(_1e=="children"){for(var i=0;i<_1d.childNodes.length;++i){_1f.push(_1d.childNodes[i]);}}else{if(_1d.getAttribute(_1e)!==null){_1f.push(_1d.getAttribute(_1e));}}return _1f;},getAttributes:function(_20){this._assertIsItem(_20);var _21=[];var _22=_20;var _23=_22.attributes;for(var i=0;i<_23.length;++i){var _24=_23.item(i);_21.push(_24.nodeName);}if(_22.childNodes.length>0){_21.push("children");}return _21;},hasAttribute:function(_25,_26){return (this.getValues(_25,_26).length>0);},containsValue:function(_27,_28,_29){var _2a=undefined;if(typeof _29==="string"){_2a=_4.data.util.filter.patternToRegExp(_29,false);}return this._containsValue(_27,_28,_29,_2a);},_containsValue:function(_2b,_2c,_2d,_2e){var _2f=this.getValues(_2b,_2c);for(var i=0;i<_2f.length;++i){var _30=_2f[i];if(typeof _30==="string"&&_2e){return (_30.match(_2e)!==null);}else{if(_2d===_30){return true;}}}return false;},isItem:function(_31){return (_31&&_31.nodeType==1&&_31.tagName=="outline"&&_31.ownerDocument===this._xmlData);},isItemLoaded:function(_32){return this.isItem(_32);},loadItem:function(_33){},getLabel:function(_34){if(this.isItem(_34)){return this.getValue(_34,this.label);}return undefined;},getLabelAttributes:function(_35){return [this.label];},_fetchItems:function(_36,_37,_38){var _39=this;var _3a=function(_3b,_3c){var _3d=null;if(_3b.query){_3d=[];var _3e=_3b.queryOptions?_3b.queryOptions.ignoreCase:false;var _3f={};for(var key in _3b.query){var _40=_3b.query[key];if(typeof _40==="string"){_3f[key]=_4.data.util.filter.patternToRegExp(_40,_3e);}}for(var i=0;i<_3c.length;++i){var _41=true;var _42=_3c[i];for(var key in _3b.query){var _40=_3b.query[key];if(!_39._containsValue(_42,key,_40,_3f[key])){_41=false;}}if(_41){_3d.push(_42);}}}else{if(_3c.length>0){_3d=_3c.slice(0,_3c.length);}}_37(_3d,_3b);};if(this._loadFinished){_3a(_36,this._getItemsArray(_36.queryOptions));}else{if(this._loadInProgress){this._queuedFetches.push({args:_36,filter:_3a});}else{if(this.url!==""){this._loadInProgress=true;var _43={url:_39.url,handleAs:"xml",preventCache:_39.urlPreventCache};var _44=_4.xhrGet(_43);_44.addCallback(function(_45){_39._processRawXmlTree(_45);_3a(_36,_39._getItemsArray(_36.queryOptions));_39._handleQueuedFetches();});_44.addErrback(function(_46){throw _46;});}else{if(this._opmlData){this._processRawXmlTree(this._opmlData);this._opmlData=null;_3a(_36,this._getItemsArray(_36.queryOptions));}else{throw new Error("dojox.data.OpmlStore: No OPML source data was provided as either URL or XML data input.");}}}}},getFeatures:function(){var _47={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};return _47;},getIdentity:function(_48){if(this.isItem(_48)){for(var i in this._identityMap){if(this._identityMap[i]===_48){return i;}}}return null;},fetchItemByIdentity:function(_49){if(!this._loadFinished){var _4a=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_49});}else{this._loadInProgress=true;var _4b={url:_4a.url,handleAs:"xml"};var _4c=_4.xhrGet(_4b);_4c.addCallback(function(_4d){var _4e=_49.scope?_49.scope:_4.global;try{_4a._processRawXmlTree(_4d);var _4f=_4a._identityMap[_49.identity];if(!_4a.isItem(_4f)){_4f=null;}if(_49.onItem){_49.onItem.call(_4e,_4f);}_4a._handleQueuedFetches();}catch(error){if(_49.onError){_49.onError.call(_4e,error);}}});_4c.addErrback(function(_50){this._loadInProgress=false;if(_49.onError){var _51=_49.scope?_49.scope:_4.global;_49.onError.call(_51,_50);}});}}else{if(this._opmlData){this._processRawXmlTree(this._opmlData);this._opmlData=null;var _52=this._identityMap[_49.identity];if(!_4a.isItem(_52)){_52=null;}if(_49.onItem){var _53=_49.scope?_49.scope:_4.global;_49.onItem.call(_53,_52);}}}}else{var _52=this._identityMap[_49.identity];if(!this.isItem(_52)){_52=null;}if(_49.onItem){var _53=_49.scope?_49.scope:_4.global;_49.onItem.call(_53,_52);}}},getIdentityAttributes:function(_54){return null;},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _55=this._queuedFetches[i];var _56=_55.args;var _57=_55.filter;if(_57){_57(_56,this._getItemsArray(_56.queryOptions));}else{this.fetchItemByIdentity(_56);}}this._queuedFetches=[];}},close:function(_58){}});_4.extend(_6.data.OpmlStore,_4.data.util.simpleFetch);}}};});