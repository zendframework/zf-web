/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.KeyValueStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.simpleFetch"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.KeyValueStore"]){_4._hasResource["dojox.data.KeyValueStore"]=true;_4.provide("dojox.data.KeyValueStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.simpleFetch");_4.declare("dojox.data.KeyValueStore",null,{constructor:function(_7){if(_7.url){this.url=_7.url;}this._keyValueString=_7.data;this._keyValueVar=_7.dataVar;this._keyAttribute="key";this._valueAttribute="value";this._storeProp="_keyValueStore";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];if(_7&&"urlPreventCache" in _7){this.urlPreventCache=_7.urlPreventCache?true:false;}},url:"",data:"",urlPreventCache:false,_assertIsItem:function(_8){if(!this.isItem(_8)){throw new Error("dojox.data.KeyValueStore: a function was passed an item argument that was not an item");}},_assertIsAttribute:function(_9,_a){if(!_4.isString(_a)){throw new Error("dojox.data.KeyValueStore: a function was passed an attribute argument that was not an attribute object nor an attribute name string");}},getValue:function(_b,_c,_d){this._assertIsItem(_b);this._assertIsAttribute(_b,_c);var _e;if(_c==this._keyAttribute){_e=_b[this._keyAttribute];}else{_e=_b[this._valueAttribute];}if(_e===undefined){_e=_d;}return _e;},getValues:function(_f,_10){var _11=this.getValue(_f,_10);return (_11?[_11]:[]);},getAttributes:function(_12){return [this._keyAttribute,this._valueAttribute,_12[this._keyAttribute]];},hasAttribute:function(_13,_14){this._assertIsItem(_13);this._assertIsAttribute(_13,_14);return (_14==this._keyAttribute||_14==this._valueAttribute||_14==_13[this._keyAttribute]);},containsValue:function(_15,_16,_17){var _18=undefined;if(typeof _17==="string"){_18=_4.data.util.filter.patternToRegExp(_17,false);}return this._containsValue(_15,_16,_17,_18);},_containsValue:function(_19,_1a,_1b,_1c){var _1d=this.getValues(_19,_1a);for(var i=0;i<_1d.length;++i){var _1e=_1d[i];if(typeof _1e==="string"&&_1c){return (_1e.match(_1c)!==null);}else{if(_1b===_1e){return true;}}}return false;},isItem:function(_1f){if(_1f&&_1f[this._storeProp]===this){return true;}return false;},isItemLoaded:function(_20){return this.isItem(_20);},loadItem:function(_21){},getFeatures:function(){return this._features;},close:function(_22){},getLabel:function(_23){return _23[this._keyAttribute];},getLabelAttributes:function(_24){return [this._keyAttribute];},_fetchItems:function(_25,_26,_27){var _28=this;var _29=function(_2a,_2b){var _2c=null;if(_2a.query){_2c=[];var _2d=_2a.queryOptions?_2a.queryOptions.ignoreCase:false;var _2e={};for(var key in _2a.query){var _2f=_2a.query[key];if(typeof _2f==="string"){_2e[key]=_4.data.util.filter.patternToRegExp(_2f,_2d);}}for(var i=0;i<_2b.length;++i){var _30=true;var _31=_2b[i];for(var key in _2a.query){var _2f=_2a.query[key];if(!_28._containsValue(_31,key,_2f,_2e[key])){_30=false;}}if(_30){_2c.push(_31);}}}else{if(_2a.identity){_2c=[];var _32;for(var key in _2b){_32=_2b[key];if(_32[_28._keyAttribute]==_2a.identity){_2c.push(_32);break;}}}else{if(_2b.length>0){_2c=_2b.slice(0,_2b.length);}}}_26(_2c,_2a);};if(this._loadFinished){_29(_25,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_25,filter:_29});}else{this._loadInProgress=true;var _33={url:_28.url,handleAs:"json-comment-filtered",preventCache:this.urlPreventCache};var _34=_4.xhrGet(_33);_34.addCallback(function(_35){_28._processData(_35);_29(_25,_28._arrayOfAllItems);_28._handleQueuedFetches();});_34.addErrback(function(_36){_28._loadInProgress=false;throw _36;});}}else{if(this._keyValueString){this._processData(eval(this._keyValueString));this._keyValueString=null;_29(_25,this._arrayOfAllItems);}else{if(this._keyValueVar){this._processData(this._keyValueVar);this._keyValueVar=null;_29(_25,this._arrayOfAllItems);}else{throw new Error("dojox.data.KeyValueStore: No source data was provided as either URL, String, or Javascript variable data input.");}}}}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _37=this._queuedFetches[i];var _38=_37.filter;var _39=_37.args;if(_38){_38(_39,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_37.args);}}this._queuedFetches=[];}},_processData:function(_3a){this._arrayOfAllItems=[];for(var i=0;i<_3a.length;i++){this._arrayOfAllItems.push(this._createItem(_3a[i]));}this._loadFinished=true;this._loadInProgress=false;},_createItem:function(_3b){var _3c={};_3c[this._storeProp]=this;for(var i in _3b){_3c[this._keyAttribute]=i;_3c[this._valueAttribute]=_3b[i];break;}return _3c;},getIdentity:function(_3d){if(this.isItem(_3d)){return _3d[this._keyAttribute];}return null;},getIdentityAttributes:function(_3e){return [this._keyAttribute];},fetchItemByIdentity:function(_3f){_3f.oldOnItem=_3f.onItem;_3f.onItem=null;_3f.onComplete=this._finishFetchItemByIdentity;this.fetch(_3f);},_finishFetchItemByIdentity:function(_40,_41){var _42=_41.scope||_4.global;if(_40.length){_41.oldOnItem.call(_42,_40[0]);}else{_41.oldOnItem.call(_42,null);}}});_4.extend(_6.data.KeyValueStore,_4.data.util.simpleFetch);}}};});