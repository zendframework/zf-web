/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.data.CssRuleStore"],["require","dojo.data.util.filter"],["require","dojo.data.util.sorter"],["require","dojox.data.css"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.data.CssRuleStore"]){_4._hasResource["dojox.data.CssRuleStore"]=true;_4.provide("dojox.data.CssRuleStore");_4.require("dojo.data.util.filter");_4.require("dojo.data.util.sorter");_4.require("dojox.data.css");_4.declare("dojox.data.CssRuleStore",null,{_storeRef:"_S",_labelAttribute:"selector",_cache:null,_browserMap:null,_cName:"dojox.data.CssRuleStore",constructor:function(_7){if(_7){_4.mixin(this,_7);}this._cache={};this._allItems=null;this._waiting=[];this.gatherHandle=null;var _8=this;function _9(){try{_8.context=_6.data.css.determineContext(_8.context);if(_8.gatherHandle){clearInterval(_8.gatherHandle);_8.gatherHandle=null;}while(_8._waiting.length){var _a=_8._waiting.pop();_6.data.css.rules.forEach(_a.forFunc,null,_8.context);_a.finishFunc();}}catch(e){}};this.gatherHandle=setInterval(_9,250);},setContext:function(_b){if(_b){this.close();this.context=_6.data.css.determineContext(_b);}},getFeatures:function(){return {"dojo.data.api.Read":true};},isItem:function(_c){if(_c&&_c[this._storeRef]==this){return true;}return false;},hasAttribute:function(_d,_e){this._assertIsItem(_d);this._assertIsAttribute(_e);var _f=this.getAttributes(_d);if(_4.indexOf(_f,_e)!=-1){return true;}return false;},getAttributes:function(_10){this._assertIsItem(_10);var _11=["selector","classes","rule","style","cssText","styleSheet","parentStyleSheet","parentStyleSheetHref"];var _12=_10.rule.style;if(_12){var key;for(key in _12){_11.push("style."+key);}}return _11;},getValue:function(_13,_14,_15){var _16=this.getValues(_13,_14);var _17=_15;if(_16&&_16.length>0){return _16[0];}return _15;},getValues:function(_18,_19){this._assertIsItem(_18);this._assertIsAttribute(_19);var _1a=null;if(_19==="selector"){_1a=_18.rule["selectorText"];if(_1a&&_4.isString(_1a)){_1a=_1a.split(",");}}else{if(_19==="classes"){_1a=_18.classes;}else{if(_19==="rule"){_1a=_18.rule.rule;}else{if(_19==="style"){_1a=_18.rule.style;}else{if(_19==="cssText"){if(_4.isIE){if(_18.rule.style){_1a=_18.rule.style.cssText;if(_1a){_1a="{ "+_1a.toLowerCase()+" }";}}}else{_1a=_18.rule.cssText;if(_1a){_1a=_1a.substring(_1a.indexOf("{"),_1a.length);}}}else{if(_19==="styleSheet"){_1a=_18.rule.styleSheet;}else{if(_19==="parentStyleSheet"){_1a=_18.rule.parentStyleSheet;}else{if(_19==="parentStyleSheetHref"){if(_18.href){_1a=_18.href;}}else{if(_19.indexOf("style.")===0){var _1b=_19.substring(_19.indexOf("."),_19.length);_1a=_18.rule.style[_1b];}else{_1a=[];}}}}}}}}}if(_1a!==undefined){if(!_4.isArray(_1a)){_1a=[_1a];}}return _1a;},getLabel:function(_1c){this._assertIsItem(_1c);return this.getValue(_1c,this._labelAttribute);},getLabelAttributes:function(_1d){return [this._labelAttribute];},containsValue:function(_1e,_1f,_20){var _21=undefined;if(typeof _20==="string"){_21=_4.data.util.filter.patternToRegExp(_20,false);}return this._containsValue(_1e,_1f,_20,_21);},isItemLoaded:function(_22){return this.isItem(_22);},loadItem:function(_23){this._assertIsItem(_23.item);},fetch:function(_24){_24=_24||{};if(!_24.store){_24.store=this;}var _25=_24.scope||_4.global;if(this._pending&&this._pending.length>0){this._pending.push({request:_24,fetch:true});}else{this._pending=[{request:_24,fetch:true}];this._fetch(_24);}return _24;},_fetch:function(_26){var _27=_26.scope||_4.global;if(this._allItems===null){this._allItems={};try{if(this.gatherHandle){this._waiting.push({"forFunc":_4.hitch(this,this._handleRule),"finishFunc":_4.hitch(this,this._handleReturn)});}else{_6.data.css.rules.forEach(_4.hitch(this,this._handleRule),null,this.context);this._handleReturn();}}catch(e){if(_26.onError){_26.onError.call(_27,e,_26);}}}else{this._handleReturn();}},_handleRule:function(_28,_29,_2a){var _2b=_28["selectorText"];var s=_2b.split(" ");var _2c=[];for(var j=0;j<s.length;j++){var tmp=s[j];var _2d=tmp.indexOf(".");if(tmp&&tmp.length>0&&_2d!==-1){var _2e=tmp.indexOf(",")||tmp.indexOf("[");tmp=tmp.substring(_2d,((_2e!==-1&&_2e>_2d)?_2e:tmp.length));_2c.push(tmp);}}var _2f={};_2f.rule=_28;_2f.styleSheet=_29;_2f.href=_2a;_2f.classes=_2c;_2f[this._storeRef]=this;if(!this._allItems[_2b]){this._allItems[_2b]=[];}this._allItems[_2b].push(_2f);},_handleReturn:function(){var _30=[];var _31=[];var _32=null;for(var i in this._allItems){_32=this._allItems[i];for(var j in _32){_31.push(_32[j]);}}var _33;while(this._pending.length){_33=this._pending.pop();_33.request._items=_31;_30.push(_33);}while(_30.length){_33=_30.pop();this._handleFetchReturn(_33.request);}},_handleFetchReturn:function(_34){var _35=_34.scope||_4.global;var _36=[];var _37="all";var i;if(_34.query){_37=_4.toJson(_34.query);}if(this._cache[_37]){_36=this._cache[_37];}else{if(_34.query){for(i in _34._items){var _38=_34._items[i];var _39=_4.isWebKit?true:(_34.queryOptions?_34.queryOptions.ignoreCase:false);var _3a={};var key;var _3b;for(key in _34.query){_3b=_34.query[key];if(typeof _3b==="string"){_3a[key]=_4.data.util.filter.patternToRegExp(_3b,_39);}}var _3c=true;for(key in _34.query){_3b=_34.query[key];if(!this._containsValue(_38,key,_3b,_3a[key])){_3c=false;}}if(_3c){_36.push(_38);}}this._cache[_37]=_36;}else{for(i in _34._items){_36.push(_34._items[i]);}}}var _3d=_36.length;if(_34.sort){_36.sort(_4.data.util.sorter.createSortFunction(_34.sort,this));}var _3e=0;var _3f=_36.length;if(_34.start>0&&_34.start<_36.length){_3e=_34.start;}if(_34.count&&_34.count){_3f=_34.count;}var _40=_3e+_3f;if(_40>_36.length){_40=_36.length;}_36=_36.slice(_3e,_40);if(_34.onBegin){_34.onBegin.call(_35,_3d,_34);}if(_34.onItem){if(_4.isArray(_36)){for(i=0;i<_36.length;i++){_34.onItem.call(_35,_36[i],_34);}if(_34.onComplete){_34.onComplete.call(_35,null,_34);}}}else{if(_34.onComplete){_34.onComplete.call(_35,_36,_34);}}return _34;},close:function(){this._cache={};this._allItems=null;},_assertIsItem:function(_41){if(!this.isItem(_41)){throw new Error(this._cName+": Invalid item argument.");}},_assertIsAttribute:function(_42){if(typeof _42!=="string"){throw new Error(this._cName+": Invalid attribute argument.");}},_containsValue:function(_43,_44,_45,_46){return _4.some(this.getValues(_43,_44),function(_47){if(_47!==null&&!_4.isObject(_47)&&_46){if(_47.toString().match(_46)){return true;}}else{if(_45===_47){return true;}}return false;});}});}}};});