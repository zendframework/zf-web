/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.form.ListInput"],["require","dijit.form._FormWidget"],["require","dijit.form.ValidationTextBox"],["require","dijit.InlineEditBox"],["requireLocalization","dijit","common",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw","ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,ko,nb,nl,pl,pt,pt-pt,ru,sk,sl,sv,th,tr,zh,zh-tw"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.form.ListInput"]){_4._hasResource["dojox.form.ListInput"]=true;_4.experimental("dojox.form.ListInput");_4.provide("dojox.form.ListInput");_4.require("dijit.form._FormWidget");_4.require("dijit.form.ValidationTextBox");_4.require("dijit.InlineEditBox");_4.declare("dojox.form.ListInput",[_5.form._FormValueWidget],{constructor:function(){this._items=[];if(!_4.isArray(this.delimiter)){this.delimiter=[this.delimiter];}var r="("+this.delimiter.join("|")+")?";this.regExp="^"+this.regExp+r+"$";},inputClass:"dojox.form._ListInputInputBox",inputHandler:"onChange",inputProperties:{minWidth:50},submitOnlyValidValue:true,useOnBlur:true,readOnlyInput:false,maxItems:null,showCloseButtonWhenValid:true,showCloseButtonWhenInvalid:true,regExp:".*",delimiter:",",constraints:{},baseClass:"dojoxListInput",type:"select",value:"",templateString:"<div dojoAttachPoint=\"focusNode\" class=\"dijit dijitReset dijitLeft dojoxListInput\"><select dojoAttachpoint=\"_selectNode\" multiple=\"multiple\" class=\"dijitHidden\" ${nameAttrSetting}></select><ul dojoAttachPoint=\"_listInput\"><li dojoAttachEvent=\"onclick: _onClick\" class=\"dijitInputField dojoxListInputNode dijitHidden\" dojoAttachPoint=\"_inputNode\"></li></ul></div>",useAnim:true,duration:500,easingIn:null,easingOut:null,readOnlyItem:false,useArrowForEdit:true,_items:null,_lastAddedItem:null,_currentItem:null,_input:null,_count:0,postCreate:function(){this.inherited(arguments);this._createInputBox();},_setReadOnlyInputAttr:function(_7){console.warn("_setReadOnlyInputAttr",this.id,_7);if(!this._started){return this._createInputBox();}this.readOnlyInput=_7;this._createInputBox();},_setReadOnlyItemAttr:function(_8){if(!this._started){return;}for(var i in this._items){this._items[i].attr("readOnlyItem",_8);}},_createInputBox:function(){console.warn("_createInputBox",this.id,this.readOnlyInput);_4[(this.readOnlyInput?"add":"remove")+"Class"](this._inputNode,"dijitHidden");if(this.readOnlyInput){return;}if(this._input){return;}if(this.inputHandler===null){return !console.warn("you must add some handler to connect to input field");}if(_4.isString(this.inputHandler)){this.inputHandler=this.inputHandler.split(",");}if(_4.isString(this.inputProperties)){this.inputProperties=_4.fromJson(this.inputProperties);}var _9=_4.getObject(this.inputClass,false);this.inputProperties.regExp=this.regExpGen(this.constraints);this._input=new _9(this.inputProperties);this._input.startup();this._inputNode.appendChild(this._input.domNode);_4.forEach(this.inputHandler,function(_a){this.connect(this._input,_4.string.trim(_a),"_onHandler");},this);this.connect(this._input,"onKeyDown","_inputOnKeyDown");this.connect(this._input,"onBlur","_inputOnBlur");},compare:function(_b,_c){_b=_b.join(",");_c=_c.join(",");if(_b>_c){return 1;}else{if(_b<_c){return -1;}else{return 0;}}},add:function(_d){if(this._count>=this.maxItems&&this.maxItems!==null){return;}this._lastValueReported=this._getValues();if(!_4.isArray(_d)){_d=[_d];}for(var i in _d){var _e=_d[i];if(_e===""||typeof _e!="string"){continue;}this._count++;var re=new RegExp(this.regExpGen(this.constraints));this._lastAddedItem=new _6.form._ListInputInputItem({"index":this._items.length,readOnlyItem:this.readOnlyItem,value:_e,regExp:this.regExpGen(this.constraints)});this._lastAddedItem.startup();this._testItem(this._lastAddedItem,_e);this._lastAddedItem.onClose=_4.hitch(this,"_onItemClose",this._lastAddedItem);this._lastAddedItem.onChange=_4.hitch(this,"_onItemChange",this._lastAddedItem);this._lastAddedItem.onEdit=_4.hitch(this,"_onItemEdit",this._lastAddedItem);this._lastAddedItem.onKeyDown=_4.hitch(this,"_onItemKeyDown",this._lastAddedItem);if(this.useAnim){_4.style(this._lastAddedItem.domNode,{opacity:0,display:""});}this._placeItem(this._lastAddedItem.domNode);if(this.useAnim){var _f=_4.fadeIn({node:this._lastAddedItem.domNode,duration:this.duration,easing:this.easingIn}).play();}this._items[this._lastAddedItem.index]=this._lastAddedItem;if(this._onChangeActive&&this.intermediateChanges){this.onChange(_e);}if(this._count>=this.maxItems&&this.maxItems!==null){break;}}this._updateValues();if(this._lastValueReported.length==0){this._lastValueReported=this.value;}if(!this.readOnlyInput){this._input.attr("value","");}if(this._onChangeActive){this.onChange(this.value);}this._setReadOnlyWhenMaxItemsReached();},_setReadOnlyWhenMaxItemsReached:function(){this.attr("readOnlyInput",(this._count>=this.maxItems&&this.maxItems!==null));},_setSelectNode:function(){this._selectNode.options.length=0;var _10=this.submitOnlyValidValue?this.attr("MatchedValue"):this.value;if(!_4.isArray(_10)){return;}_4.forEach(_10,function(_11){this._selectNode.options[this._selectNode.options.length]=new Option(_11,_11,true,true);},this);},_placeItem:function(_12){_4.place(_12,this._inputNode,"before");},_getCursorPos:function(_13){if(typeof _13.selectionStart!="undefined"){return _13.selectionStart;}try{_13.focus();}catch(e){}var _14=_13.createTextRange();_14.moveToBookmark(_4.doc.selection.createRange().getBookmark());_14.moveEnd("character",_13.value.length);try{return _13.value.length-_14.text.length;}finally{_14=null;}},_onItemClose:function(_15){if(this.disabled){return;}if(this.useAnim){var _16=_4.fadeOut({node:_15.domNode,duration:this.duration,easing:this.easingOut,onEnd:_4.hitch(this,"_destroyItem",_15)}).play();}else{this._destroyItem(_15);}},_onItemKeyDown:function(_17,e){if(this.readOnlyItem||!this.useArrowForEdit){return;}if(e.keyCode==_4.keys.LEFT_ARROW&&this._getCursorPos(e.target)==0){this._editBefore(_17);}else{if(e.keyCode==_4.keys.RIGHT_ARROW&&this._getCursorPos(e.target)==e.target.value.length){this._editAfter(_17);}}},_editBefore:function(_18){this._currentItem=this._getPreviousItem(_18);if(this._currentItem!==null){this._currentItem.edit();}},_editAfter:function(_19){this._currentItem=this._getNextItem(_19);if(this._currentItem!==null){this._currentItem.edit();}if(!this.readOnlyInput){if(this._currentItem===null){this._focusInput();}}},_onItemChange:function(_1a,_1b){if(!_1b){_1b=_1a.attr("value");}this._testItem(_1a,_1b);this._updateValues();},_onItemEdit:function(_1c){_4.removeClass(_1c.domNode,"dijitError");_4.removeClass(_1c.domNode,this.baseClass+"Match");_4.removeClass(_1c.domNode,this.baseClass+"Mismatch");},_testItem:function(_1d,_1e){var re=new RegExp(this.regExpGen(this.constraints));var _1f=_1e.match(re);_4.removeClass(_1d.domNode,this.baseClass+(!_1f?"Match":"Mismatch"));_4.addClass(_1d.domNode,this.baseClass+(_1f?"Match":"Mismatch"));_4[(!_1f?"add":"remove")+"Class"](_1d.domNode,"dijitError");if((this.showCloseButtonWhenValid&&_1f)||(this.showCloseButtonWhenInvalid&&!_1f)){_4.addClass(_1d.domNode,this.baseClass+"Closable");}else{_4.removeClass(_1d.domNode,this.baseClass+"Closable");}},_getValueAttr:function(){return this.value;},_setValueAttr:function(_20){this._destroyAllItems();this.add(this._parseValue(_20));},_parseValue:function(_21){if(typeof _21=="string"){if(_4.isString(this.delimiter)){this.delimiter=[this.delimiter];}var re=new RegExp("^.*("+this.delimiter.join("|")+").*");if(_21.match(re)){re=new RegExp(this.delimiter.join("|"));return _21.split(re);}}return _21;},regExpGen:function(_22){return this.regExp;},_setDisabledAttr:function(_23){if(!this.readOnlyItem){for(var i in this._items){this._items[i].attr("disabled",_23);}}if(!this.readOnlyInput){this._input.attr("disabled",_23);}this.inherited(arguments);},_onHandler:function(_24){var _25=this._parseValue(_24);if(_4.isArray(_25)){this.add(_25);}},_onClick:function(e){this._focusInput();},_focusInput:function(){if(!this.readOnlyInput&&this._input.focus){this._input.focus();}},_inputOnKeyDown:function(e){this._currentItem=null;if(e.keyCode==_4.keys.BACKSPACE&&this._input.attr("value")==""&&this.attr("lastItem")){this._destroyItem(this.attr("lastItem"));}else{if(e.keyCode==_4.keys.ENTER&&this._input.attr("value")!=""){this.add(this._input.attr("value"));}else{if(e.keyCode==_4.keys.LEFT_ARROW&&this._getCursorPos(this._input.focusNode)==0&&!this.readOnlyItem&&this.useArrowForEdit){this._editBefore();}}}},_inputOnBlur:function(){if(this.useOnBlur&&this._input.attr("value")!=""){this.add(this._input.attr("value"));}},_getMatchedValueAttr:function(){return this._getValues(_4.hitch(this,this._matchValidator));},_getMismatchedValueAttr:function(){return this._getValues(_4.hitch(this,this._mismatchValidator));},_getValues:function(_26){var _27=[];_26=_26||this._nullValidator;for(var i in this._items){var _28=this._items[i];if(_28===null){continue;}var _29=_28.attr("value");if(_26(_29)){_27.push(_29);}}return _27;},_nullValidator:function(_2a){return true;},_matchValidator:function(_2b){var re=new RegExp(this.regExpGen(this.constraints));return _2b.match(re);},_mismatchValidator:function(_2c){var re=new RegExp(this.regExpGen(this.constraints));return !(_2c.match(re));},_getLastItemAttr:function(){return this._getSomeItem();},_getSomeItem:function(_2d,_2e){_2d=_2d||false;_2e=_2e||"last";var _2f=null;var _30=-1;for(var i in this._items){if(this._items[i]===null){continue;}if(_2e=="before"&&this._items[i]===_2d){break;}_2f=this._items[i];if(_2e=="first"||_30==0){_30=1;break;}if(_2e=="after"&&this._items[i]===_2d){_30=0;}}if(_2e=="after"&&_30==0){_2f=null;}return _2f;},_getPreviousItem:function(_31){return this._getSomeItem(_31,"before");},_getNextItem:function(_32){return this._getSomeItem(_32,"after");},_destroyItem:function(_33,_34){this._items[_33.index]=null;_33.destroy();this._count--;if(_34!==false){this._updateValues();this._setReadOnlyWhenMaxItemsReached();}},_updateValues:function(){this.value=this._getValues();this._setSelectNode();},_destroyAllItems:function(){for(var i in this._items){if(this._items[i]==null){continue;}this._destroyItem(this._items[i],false);}this._items=[];this._count=0;this.value=null;this._setSelectNode();this._setReadOnlyWhenMaxItemsReached();},destroy:function(){this._destroyAllItems();this._lastAddedItem=null;if(!this._input){this._input.destroy();}this.inherited(arguments);}});_4.declare("dojox.form._ListInputInputItem",[_5._Widget,_5._Templated],{templateString:"<li class=\"dijit dijitReset dijitLeft dojoxListInputItem\" dojoAttachEvent=\"onclick: onClick\" ><span dojoAttachPoint=\"labelNode\"></span></li>",closeButtonNode:null,readOnlyItem:true,baseClass:"dojoxListInputItem",value:"",regExp:".*",_editBox:null,_handleKeyDown:null,attributeMap:{value:{node:"labelNode",type:"innerHTML"}},postMixInProperties:function(){var _35=_4.i18n.getLocalization("dijit","common");_4.mixin(this,_35);this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.closeButtonNode=_4.create("span",{"class":"dijitButtonNode dijitDialogCloseIcon",title:this.itemClose,onclick:_4.hitch(this,"onClose"),onmouseenter:_4.hitch(this,"_onCloseEnter"),onmouseleave:_4.hitch(this,"_onCloseLeave")},this.domNode);_4.create("span",{"class":"closeText",title:this.itemClose,innerHTML:"x"},this.closeButtonNode);},startup:function(){this.inherited(arguments);this._createInlineEditBox();},_setReadOnlyItemAttr:function(_36){this.readOnlyItem=_36;if(!_36){this._createInlineEditBox();}else{if(this._editBox){this._editBox.attr("disabled",true);}}},_createInlineEditBox:function(){if(this.readOnlyItem){return;}if(!this._started){return;}if(this._editBox){this._editBox.attr("disabled",false);return;}this._editBox=new _5.InlineEditBox({value:this.value,editor:"dijit.form.ValidationTextBox",editorParams:{regExp:this.regExp}},this.labelNode);this.connect(this._editBox,"edit","_onEdit");this.connect(this._editBox,"onChange","_onCloseEdit");this.connect(this._editBox,"onCancel","_onCloseEdit");},edit:function(){if(!this.readOnlyItem){this._editBox.edit();}},_onCloseEdit:function(_37){_4.removeClass(this.closeButtonNode,this.baseClass+"Edited");_4.disconnect(this._handleKeyDown);this.onChange(_37);},_onEdit:function(){_4.addClass(this.closeButtonNode,this.baseClass+"Edited");this._handleKeyDown=_4.connect(this._editBox.editWidget,"_onKeyPress",this,"onKeyDown");this.onEdit();},_setDisabledAttr:function(_38){if(!this.readOnlyItem){this._editBox.attr("disabled",_38);}},_getValueAttr:function(){return (!this.readOnlyItem&&this._started?this._editBox.attr("value"):this.value);},destroy:function(){if(this._editBox){this._editBox.destroy();}this.inherited(arguments);},_onCloseEnter:function(){_4.addClass(this.closeButtonNode,"dijitDialogCloseIcon-hover");},_onCloseLeave:function(){_4.removeClass(this.closeButtonNode,"dijitDialogCloseIcon-hover");},onClose:function(){},onEdit:function(){},onClick:function(){},onChange:function(_39){},onKeyDown:function(_3a){}});_4.declare("dojox.form._ListInputInputBox",[_5.form.ValidationTextBox],{minWidth:50,intermediateChanges:true,regExp:".*",_sizer:null,onChange:function(_3b){this.inherited(arguments);if(this._sizer===null){this._sizer=_4.create("div",{style:{position:"absolute",left:"-10000px",top:"-10000px"}},_4.body());}this._sizer.innerHTML=_3b;var w=_4.contentBox(this._sizer).w+this.minWidth;_4.contentBox(this.domNode,{w:w});},destroy:function(){_4.destroy(this._sizer);this.inherited(arguments);}});}}};});