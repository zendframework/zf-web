/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.image.SlideShow"],["require","dojo.string"],["require","dojo.fx"],["require","dijit._Widget"],["require","dijit._Templated"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.image.SlideShow"]){_4._hasResource["dojox.image.SlideShow"]=true;_4.provide("dojox.image.SlideShow");_4.require("dojo.string");_4.require("dojo.fx");_4.require("dijit._Widget");_4.require("dijit._Templated");_4.declare("dojox.image.SlideShow",[_5._Widget,_5._Templated],{imageHeight:375,imageWidth:500,title:"",titleTemplate:"${title} <span class=\"slideShowCounterText\">(${current} of ${total})</span>",noLink:false,loop:true,hasNav:true,images:[],pageSize:20,autoLoad:true,autoStart:false,fixedHeight:false,imageStore:null,linkAttr:"link",imageLargeAttr:"imageUrl",titleAttr:"title",slideshowInterval:3,templateString:_4.cache("dojox.image","resources/SlideShow.html","<div dojoAttachPoint=\"outerNode\" class=\"slideShowWrapper\">\n\t<div style=\"position:relative;\" dojoAttachPoint=\"innerWrapper\">\n\t\t<div class=\"slideShowNav\" dojoAttachEvent=\"onclick: _handleClick\">\n\t\t\t<div class=\"dijitInline slideShowTitle\" dojoAttachPoint=\"titleNode\">${title}</div>\n\t\t</div>\n\t\t<div dojoAttachPoint=\"navNode\" class=\"slideShowCtrl\" dojoAttachEvent=\"onclick: _handleClick\">\n\t\t\t<span dojoAttachPoint=\"navPrev\" class=\"slideShowCtrlPrev\"></span>\n\t\t\t<span dojoAttachPoint=\"navPlay\" class=\"slideShowCtrlPlay\"></span>\n\t\t\t<span dojoAttachPoint=\"navNext\" class=\"slideShowCtrlNext\"></span>\n\t\t</div>\n\t\t<div dojoAttachPoint=\"largeNode\" class=\"slideShowImageWrapper\"></div>\t\t\n\t\t<div dojoAttachPoint=\"hiddenNode\" class=\"slideShowHidden\"></div>\n\t</div>\n</div>\n"),_imageCounter:0,_tmpImage:null,_request:null,postCreate:function(){this.inherited(arguments);var _7=document.createElement("img");_7.setAttribute("width",this.imageWidth);_7.setAttribute("height",this.imageHeight);if(this.hasNav){_4.connect(this.outerNode,"onmouseover",this,function(_8){try{this._showNav();}catch(e){}});_4.connect(this.outerNode,"onmouseout",this,function(_9){try{this._hideNav(_9);}catch(e){}});}this.outerNode.style.width=this.imageWidth+"px";_7.setAttribute("src",this._blankGif);var _a=this;this.largeNode.appendChild(_7);this._tmpImage=this._currentImage=_7;this._fitSize(true);this._loadImage(0,_4.hitch(this,"showImage",0));this._calcNavDimensions();},setDataStore:function(_b,_c,_d){this.reset();var _e=this;this._request={query:{},start:_c.start||0,count:_c.count||this.pageSize,onBegin:function(_f,_10){_e.maxPhotos=_f;}};if(_c.query){_4.mixin(this._request.query,_c.query);}if(_d){_4.forEach(["imageLargeAttr","linkAttr","titleAttr"],function(_11){if(_d[_11]){this[_11]=_d[_11];}},this);}var _12=function(_13){_e.maxPhotos=_13.length;_e._request.onComplete=null;if(_e.autoStart){_e.imageIndex=-1;_e.toggleSlideShow();}else{_e.showImage(0);}};this.imageStore=_b;this._request.onComplete=_12;this._request.start=0;this.imageStore.fetch(this._request);},reset:function(){_4.query("> *",this.largeNode).orphan();this.largeNode.appendChild(this._tmpImage);_4.query("> *",this.hiddenNode).orphan();_4.forEach(this.images,function(img){if(img&&img.parentNode){img.parentNode.removeChild(img);}});this.images=[];this.isInitialized=false;this._imageCounter=0;},isImageLoaded:function(_14){return this.images&&this.images.length>_14&&this.images[_14];},moveImageLoadingPointer:function(_15){this._imageCounter=_15;},destroy:function(){if(this._slideId){this._stop();}this.inherited(arguments);},showNextImage:function(_16,_17){if(_16&&this._timerCancelled){return false;}if(this.imageIndex+1>=this.maxPhotos){if(_16&&(this.loop||_17)){this.imageIndex=-1;}else{if(this._slideId){this._stop();}return false;}}this.showImage(this.imageIndex+1,_4.hitch(this,function(){if(_16){this._startTimer();}}));return true;},toggleSlideShow:function(){if(this._slideId){this._stop();}else{_4.toggleClass(this.domNode,"slideShowPaused");this._timerCancelled=false;var idx=this.imageIndex;if(idx<0||(this.images[idx]&&this.images[idx]._img.complete)){var _18=this.showNextImage(true,true);if(!_18){this._stop();}}else{var _19=_4.subscribe(this.getShowTopicName(),_4.hitch(this,function(_1a){setTimeout(_4.hitch(this,function(){if(_1a.index==idx){var _1b=this.showNextImage(true,true);if(!_1b){this._stop();}_4.unsubscribe(_19);}}),this.slideshowInterval*1000);}));_4.publish(this.getShowTopicName(),[{index:idx,title:"",url:""}]);}}},getShowTopicName:function(){return (this.widgetId||this.id)+"/imageShow";},getLoadTopicName:function(){return (this.widgetId?this.widgetId:this.id)+"/imageLoad";},showImage:function(_1c,_1d){if(!_1d&&this._slideId){this.toggleSlideShow();}var _1e=this;var _1f=this.largeNode.getElementsByTagName("div");this.imageIndex=_1c;var _20=function(){if(_1e.images[_1c]){while(_1e.largeNode.firstChild){_1e.largeNode.removeChild(_1e.largeNode.firstChild);}_4.style(_1e.images[_1c],"opacity",0);_1e.largeNode.appendChild(_1e.images[_1c]);_1e._currentImage=_1e.images[_1c]._img;_1e._fitSize();var _21=function(a,b,c){var img=_1e.images[_1c].firstChild;if(img.tagName.toLowerCase()!="img"){img=img.firstChild;}var _22=img.getAttribute("title")||"";if(_1e._navShowing){_1e._showNav(true);}_4.publish(_1e.getShowTopicName(),[{index:_1c,title:_22,url:img.getAttribute("src")}]);if(_1d){_1d(a,b,c);}_1e._setTitle(_22);};_4.fadeIn({node:_1e.images[_1c],duration:300,onEnd:_21}).play();}else{_1e._loadImage(_1c,function(){_1e.showImage(_1c,_1d);});}};if(_1f&&_1f.length>0){_4.fadeOut({node:_1f[0],duration:300,onEnd:function(){_1e.hiddenNode.appendChild(_1f[0]);_20();}}).play();}else{_20();}},_fitSize:function(_23){if(!this.fixedHeight||_23){var _24=(this._currentImage.height+(this.hasNav?20:0));_4.style(this.innerWrapper,"height",_24+"px");return;}_4.style(this.largeNode,"paddingTop",this._getTopPadding()+"px");},_getTopPadding:function(){if(!this.fixedHeight){return 0;}return (this.imageHeight-this._currentImage.height)/2;},_loadNextImage:function(){if(!this.autoLoad){return;}while(this.images.length>=this._imageCounter&&this.images[this._imageCounter]){this._imageCounter++;}this._loadImage(this._imageCounter);},_loadImage:function(_25,_26){if(this.images[_25]||!this._request){return;}var _27=_25-(_25%(this._request.count||this.pageSize));this._request.start=_27;this._request.onComplete=function(_28){var _29=_25-_27;if(_28&&_28.length>_29){_2a(_28[_29]);}else{}};var _2b=this;var _2c=this.imageStore;var _2a=function(_2d){var url=_2b.imageStore.getValue(_2d,_2b.imageLargeAttr);var img=new Image();var div=_4.create("div",{id:_2b.id+"_imageDiv"+_25});div._img=img;var _2e=_2b.imageStore.getValue(_2d,_2b.linkAttr);if(!_2e||_2b.noLink){div.appendChild(img);}else{var a=_4.create("a",{"href":_2e,"target":"_blank"},div);a.appendChild(img);}_4.connect(img,"onload",function(){if(_2c!=_2b.imageStore){return;}_2b._fitImage(img);_4.attr(div,{"width":_2b.imageWidth,"height":_2b.imageHeight});_4.publish(_2b.getLoadTopicName(),[_25]);setTimeout(function(){_2b._loadNextImage();},1);if(_26){_26();}});_2b.hiddenNode.appendChild(div);var _2f=_4.create("div",{className:"slideShowTitle"},div);_2b.images[_25]=div;_4.attr(img,"src",url);var _30=_2b.imageStore.getValue(_2d,_2b.titleAttr);if(_30){_4.attr(img,"title",_30);}};this.imageStore.fetch(this._request);},_stop:function(){if(this._slideId){clearTimeout(this._slideId);}this._slideId=null;this._timerCancelled=true;_4.removeClass(this.domNode,"slideShowPaused");},_prev:function(){if(this.imageIndex<1){return;}this.showImage(this.imageIndex-1);},_next:function(){this.showNextImage();},_startTimer:function(){var id=this.id;this._slideId=setTimeout(function(){_5.byId(id).showNextImage(true);},this.slideshowInterval*1000);},_calcNavDimensions:function(){_4.style(this.navNode,"position","absolute");_4.style(this.navNode,"top","-10000px");_4._setOpacity(this.navNode,99);this.navPlay._size=_4.marginBox(this.navPlay);this.navPrev._size=_4.marginBox(this.navPrev);this.navNext._size=_4.marginBox(this.navNext);_4._setOpacity(this.navNode,0);_4.style(this.navNode,{"position":"",top:""});},_setTitle:function(_31){this.titleNode.innerHTML=_4.string.substitute(this.titleTemplate,{title:_31,current:1+this.imageIndex,total:this.maxPhotos||""});},_fitImage:function(img){var _32=img.width;var _33=img.height;if(_32>this.imageWidth){_33=Math.floor(_33*(this.imageWidth/_32));img.height=_33;img.width=_32=this.imageWidth;}if(_33>this.imageHeight){_32=Math.floor(_32*(this.imageHeight/_33));img.height=this.imageHeight;img.width=_32;}},_handleClick:function(e){switch(e.target){case this.navNext:this._next();break;case this.navPrev:this._prev();break;case this.navPlay:this.toggleSlideShow();break;}},_showNav:function(_34){if(this._navShowing&&!_34){return;}_4.style(this.navNode,"marginTop","0px");var _35=_4.style(this.navNode,"width")/2-this.navPlay._size.w/2-this.navPrev._size.w;_4.style(this.navPlay,"marginLeft",_35+"px");var _36=_4.marginBox(this.outerNode);var _37=this._currentImage.height-this.navPlay._size.h-10+this._getTopPadding();if(_37>this._currentImage.height){_37+=10;}_4[this.imageIndex<1?"addClass":"removeClass"](this.navPrev,"slideShowCtrlHide");_4[this.imageIndex+1>=this.maxPhotos?"addClass":"removeClass"](this.navNext,"slideShowCtrlHide");var _38=this;if(this._navAnim){this._navAnim.stop();}if(this._navShowing){return;}this._navAnim=_4.fadeIn({node:this.navNode,duration:300,onEnd:function(){_38._navAnim=null;}});this._navAnim.play();this._navShowing=true;},_hideNav:function(e){if(!e||!this._overElement(this.outerNode,e)){var _39=this;if(this._navAnim){this._navAnim.stop();}this._navAnim=_4.fadeOut({node:this.navNode,duration:300,onEnd:function(){_39._navAnim=null;}});this._navAnim.play();this._navShowing=false;}},_overElement:function(_3a,e){if(typeof (_4)=="undefined"){return false;}_3a=_4.byId(_3a);var m={x:e.pageX,y:e.pageY};var bb=_4._getBorderBox(_3a);var _3b=_4.coords(_3a,true);var _3c=_3b.x;return (m.x>=_3c&&m.x<=(_3c+bb.w)&&m.y>=_3b.y&&m.y<=(top+bb.h));}});}}};});