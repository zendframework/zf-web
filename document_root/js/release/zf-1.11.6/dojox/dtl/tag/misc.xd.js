/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.dtl.tag.misc"],["require","dojox.dtl._base"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.dtl.tag.misc"]){_4._hasResource["dojox.dtl.tag.misc"]=true;_4.provide("dojox.dtl.tag.misc");_4.require("dojox.dtl._base");(function(){var dd=_6.dtl;var _7=dd.tag.misc;_7.DebugNode=_4.extend(function(_8){this.text=_8;},{render:function(_9,_a){var _b=_9.getKeys();var _c=[];var _d={};for(var i=0,_e;_e=_b[i];i++){_d[_e]=_9[_e];_c+="["+_e+": "+typeof _9[_e]+"]\n";}console.debug(_d);return this.text.set(_c).render(_9,_a,this);},unrender:function(_f,_10){return _10;},clone:function(_11){return new this.constructor(this.text.clone(_11));},toString:function(){return "ddtm.DebugNode";}});_7.FilterNode=_4.extend(function(_12,_13){this._varnode=_12;this._nodelist=_13;},{render:function(_14,_15){var _16=this._nodelist.render(_14,new _6.string.Builder());_14=_14.update({"var":_16.toString()});var _17=this._varnode.render(_14,_15);_14=_14.pop();return _15;},unrender:function(_18,_19){return _19;},clone:function(_1a){return new this.constructor(this._expression,this._nodelist.clone(_1a));}});_7.FirstOfNode=_4.extend(function(_1b,_1c){this._vars=_1b;this.vars=_4.map(_1b,function(_1d){return new _6.dtl._Filter(_1d);});this.contents=_1c;},{render:function(_1e,_1f){for(var i=0,_20;_20=this.vars[i];i++){var _21=_20.resolve(_1e);if(typeof _21!="undefined"){if(_21===null){_21="null";}this.contents.set(_21);return this.contents.render(_1e,_1f);}}return this.contents.unrender(_1e,_1f);},unrender:function(_22,_23){return this.contents.unrender(_22,_23);},clone:function(_24){return new this.constructor(this._vars,this.contents.clone(_24));}});_7.SpacelessNode=_4.extend(function(_25,_26){this.nodelist=_25;this.contents=_26;},{render:function(_27,_28){if(_28.getParent){var _29=[_4.connect(_28,"onAddNodeComplete",this,"_watch"),_4.connect(_28,"onSetParent",this,"_watchParent")];_28=this.nodelist.render(_27,_28);_4.disconnect(_29[0]);_4.disconnect(_29[1]);}else{var _2a=this.nodelist.dummyRender(_27);this.contents.set(_2a.replace(/>\s+</g,"><"));_28=this.contents.render(_27,_28);}return _28;},unrender:function(_2b,_2c){return this.nodelist.unrender(_2b,_2c);},clone:function(_2d){return new this.constructor(this.nodelist.clone(_2d),this.contents.clone(_2d));},_isEmpty:function(_2e){return (_2e.nodeType==3&&!_2e.data.match(/[^\s\n]/));},_watch:function(_2f){if(this._isEmpty(_2f)){var _30=false;if(_2f.parentNode.firstChild==_2f){_2f.parentNode.removeChild(_2f);}}else{var _31=_2f.parentNode.childNodes;if(_2f.nodeType==1&&_31.length>2){for(var i=2,_32;_32=_31[i];i++){if(_31[i-2].nodeType==1&&this._isEmpty(_31[i-1])){_2f.parentNode.removeChild(_31[i-1]);return;}}}}},_watchParent:function(_33){var _34=_33.childNodes;if(_34.length){while(_33.childNodes.length){var _35=_33.childNodes[_33.childNodes.length-1];if(!this._isEmpty(_35)){return;}_33.removeChild(_35);}}}});_7.TemplateTagNode=_4.extend(function(tag,_36){this.tag=tag;this.contents=_36;},{mapping:{openblock:"{%",closeblock:"%}",openvariable:"{{",closevariable:"}}",openbrace:"{",closebrace:"}",opencomment:"{#",closecomment:"#}"},render:function(_37,_38){this.contents.set(this.mapping[this.tag]);return this.contents.render(_37,_38);},unrender:function(_39,_3a){return this.contents.unrender(_39,_3a);},clone:function(_3b){return new this.constructor(this.tag,this.contents.clone(_3b));}});_7.WidthRatioNode=_4.extend(function(_3c,max,_3d,_3e){this.current=new dd._Filter(_3c);this.max=new dd._Filter(max);this.width=_3d;this.contents=_3e;},{render:function(_3f,_40){var _41=+this.current.resolve(_3f);var max=+this.max.resolve(_3f);if(typeof _41!="number"||typeof max!="number"||!max){this.contents.set("");}else{this.contents.set(""+Math.round((_41/max)*this.width));}return this.contents.render(_3f,_40);},unrender:function(_42,_43){return this.contents.unrender(_42,_43);},clone:function(_44){return new this.constructor(this.current.getExpression(),this.max.getExpression(),this.width,this.contents.clone(_44));}});_7.WithNode=_4.extend(function(_45,_46,_47){this.target=new dd._Filter(_45);this.alias=_46;this.nodelist=_47;},{render:function(_48,_49){var _4a=this.target.resolve(_48);_48=_48.push();_48[this.alias]=_4a;_49=this.nodelist.render(_48,_49);_48=_48.pop();return _49;},unrender:function(_4b,_4c){return _4c;},clone:function(_4d){return new this.constructor(this.target.getExpression(),this.alias,this.nodelist.clone(_4d));}});_4.mixin(_7,{comment:function(_4e,_4f){_4e.skip_past("endcomment");return dd._noOpNode;},debug:function(_50,_51){return new _7.DebugNode(_50.create_text_node());},filter:function(_52,_53){var _54=_53.contents.split(null,1)[1];var _55=_52.create_variable_node("var|"+_54);var _56=_52.parse(["endfilter"]);_52.next_token();return new _7.FilterNode(_55,_56);},firstof:function(_57,_58){var _59=_58.split_contents().slice(1);if(!_59.length){throw new Error("'firstof' statement requires at least one argument");}return new _7.FirstOfNode(_59,_57.create_text_node());},spaceless:function(_5a,_5b){var _5c=_5a.parse(["endspaceless"]);_5a.delete_first_token();return new _7.SpacelessNode(_5c,_5a.create_text_node());},templatetag:function(_5d,_5e){var _5f=_5e.contents.split();if(_5f.length!=2){throw new Error("'templatetag' statement takes one argument");}var tag=_5f[1];var _60=_7.TemplateTagNode.prototype.mapping;if(!_60[tag]){var _61=[];for(var key in _60){_61.push(key);}throw new Error("Invalid templatetag argument: '"+tag+"'. Must be one of: "+_61.join(", "));}return new _7.TemplateTagNode(tag,_5d.create_text_node());},widthratio:function(_62,_63){var _64=_63.contents.split();if(_64.length!=4){throw new Error("widthratio takes three arguments");}var _65=+_64[3];if(typeof _65!="number"){throw new Error("widthratio final argument must be an integer");}return new _7.WidthRatioNode(_64[1],_64[2],_65,_62.create_text_node());},with_:function(_66,_67){var _68=_67.split_contents();if(_68.length!=4||_68[2]!="as"){throw new Error("do_width expected format as 'with value as name'");}var _69=_66.parse(["endwith"]);_66.next_token();return new _7.WithNode(_68[1],_68[3],_69);}});})();}}};});