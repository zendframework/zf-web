/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.gfx.VectorText"],["require","dojox.gfx"],["require","dojox.xml.DomParser"],["require","dojox.html.metrics"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.gfx.VectorText"]){_4._hasResource["dojox.gfx.VectorText"]=true;_4.provide("dojox.gfx.VectorText");_4.require("dojox.gfx");_4.require("dojox.xml.DomParser");_4.require("dojox.html.metrics");(function(){_4.mixin(_6.gfx,{vectorFontFitting:{NONE:0,FLOW:1,FIT:2},defaultVectorText:{type:"vectortext",x:0,y:0,width:null,height:null,text:"",align:"start",decoration:"none",fitting:0,leading:1.5},defaultVectorFont:{type:"vectorfont",size:"10pt",family:null},_vectorFontCache:{},_svgFontCache:{},getVectorFont:function(_7){if(_6.gfx._vectorFontCache[_7]){return _6.gfx._vectorFontCache[_7];}return new _6.gfx.VectorFont(_7);}});_4.declare("dojox.gfx.VectorFont",null,{_entityRe:/&(quot|apos|lt|gt|amp|#x[^;]+|#\d+);/g,_decodeEntitySequence:function(_8){if(!_8.match(this._entityRe)){return;}var _9={amp:"&",apos:"'",quot:"\"",lt:"<",gt:">"};var r,_a="";while((r=this._entityRe.exec(_8))!==null){if(r[1].charAt(1)=="x"){_a+=String.fromCharCode(r[1].slice(2),16);}else{if(!isNaN(parseInt(r[1].slice(1),10))){_a+=String.fromCharCode(r[1].slice(1));}else{_a+=_9(r[1]);}}}return _a;},_parse:function(_b,_c){var _d=_6.gfx._svgFontCache[_c]||_6.xml.DomParser.parse(_b);var f=_d.documentElement.byName("font")[0],_e=_d.documentElement.byName("font-face")[0];var _f=parseFloat(_e.getAttribute("units-per-em")||1000,10);var _10={x:parseFloat(f.getAttribute("horiz-adv-x"),10),y:parseFloat(f.getAttribute("vert-adv-y")||0,10)};if(!_10.y){_10.y=_f;}var _11={horiz:{x:parseFloat(f.getAttribute("horiz-origin-x")||0,10),y:parseFloat(f.getAttribute("horiz-origin-y")||0,10)},vert:{x:parseFloat(f.getAttribute("vert-origin-x")||0,10),y:parseFloat(f.getAttribute("vert-origin-y")||0,10)}};var _12=_e.getAttribute("font-family"),_13=_e.getAttribute("font-style")||"all",_14=_e.getAttribute("font-variant")||"normal",_15=_e.getAttribute("font-weight")||"all",_16=_e.getAttribute("font-stretch")||"normal",_17=_e.getAttribute("unicode-range")||"U+0-10FFFF",_18=_e.getAttribute("panose-1")||"0 0 0 0 0 0 0 0 0 0",_19=_e.getAttribute("cap-height"),_1a=parseFloat(_e.getAttribute("ascent")||(_f-_11.vert.y),10),_1b=parseFloat(_e.getAttribute("descent")||_11.vert.y,10),_1c={};var _1d=_12;if(_e.byName("font-face-name")[0]){_1d=_e.byName("font-face-name")[0].getAttribute("name");}if(_6.gfx._vectorFontCache[_1d]){return;}_4.forEach(["alphabetic","ideographic","mathematical","hanging"],function(_1e){var a=_e.getAttribute(_1e);if(a!==null){_1c[_1e]=parseFloat(a,10);}});var _1f=parseFloat(_d.documentElement.byName("missing-glyph")[0].getAttribute("horiz-adv-x")||_10.x,10);var _20={},_21={},g=_d.documentElement.byName("glyph");_4.forEach(g,function(_22){var _23=_22.getAttribute("unicode"),_1d=_22.getAttribute("glyph-name"),_24=parseFloat(_22.getAttribute("horiz-adv-x")||_10.x,10),_25=_22.getAttribute("d");if(_23.match(this._entityRe)){_23=this._decodeEntitySequence(_23);}var o={code:_23,name:_1d,xAdvance:_24,path:_25};_20[_23]=o;_21[_1d]=o;},this);var _26=_d.documentElement.byName("hkern");_4.forEach(_26,function(_27,i){var k=-parseInt(_27.getAttribute("k"),10);var u1=_27.getAttribute("u1"),g1=_27.getAttribute("g1"),u2=_27.getAttribute("u2"),g2=_27.getAttribute("g2"),gl;if(u1){u1=this._decodeEntitySequence(u1);if(_20[u1]){gl=_20[u1];}}else{if(_21[g1]){gl=_21[g1];}}if(gl){if(!gl.kern){gl.kern={};}if(u2){u2=this._decodeEntitySequence(u2);gl.kern[u2]={x:k};}else{if(_21[g2]){gl.kern[_21[g2].code]={x:k};}}}},this);_4.mixin(this,{family:_12,name:_1d,style:_13,variant:_14,weight:_15,stretch:_16,range:_17,viewbox:{width:_f,height:_f},origin:_11,advance:_4.mixin(_10,{missing:{x:_1f,y:_1f}}),ascent:_1a,descent:_1b,baseline:_1c,glyphs:_20});_6.gfx._vectorFontCache[_1d]=this;_6.gfx._vectorFontCache[_c]=this;if(_1d!=_12&&!_6.gfx._vectorFontCache[_12]){_6.gfx._vectorFontCache[_12]=this;}if(!_6.gfx._svgFontCache[_c]){_6.gfx._svgFontCache[_c]=_d;}},_clean:function(){var _28=this.name,_29=this.family;_4.forEach(["family","name","style","variant","weight","stretch","range","viewbox","origin","advance","ascent","descent","baseline","glyphs"],function(_2a){try{delete this[_2a];}catch(e){}},this);if(_6.gfx._vectorFontCache[_28]){delete _6.gfx._vectorFontCache[_28];}if(_6.gfx._vectorFontCache[_29]){delete _6.gfx._vectorFontCache[_29];}return this;},constructor:function(url){this._defaultLeading=1.5;if(url!==undefined){this.load(url);}},load:function(url){this.onLoadBegin(url.toString());this._parse(_6.gfx._svgFontCache[url.toString()]||_4._getText(url.toString()),url.toString());this.onLoad(this);return this;},initialized:function(){return (this.glyphs!==null);},_round:function(n){return Math.round(1000*n)/1000;},_leading:function(_2b){return this.viewbox.height*(_2b||this._defaultLeading);},_normalize:function(str){return str.replace(/\s+/g,String.fromCharCode(32));},_getWidth:function(_2c){var w=0,_2d=0,_2e=null;_4.forEach(_2c,function(_2f,i){_2d=_2f.xAdvance;if(_2c[i]&&_2f.kern&&_2f.kern[_2c[i].code]){_2d+=_2f.kern[_2c[i].code].x;}w+=_2d;_2e=_2f;});if(_2e&&_2e.code==" "){w-=_2e.xAdvance;}return this._round(w);},_getLongestLine:function(_30){var _31=0,idx=0;_4.forEach(_30,function(_32,i){var max=Math.max(_31,this._getWidth(_32));if(max>_31){_31=max;idx=i;}},this);return {width:_31,index:idx,line:_30[idx]};},_trim:function(_33){var fn=function(arr){if(!arr.length){return;}if(arr[arr.length-1].code==" "){arr.splice(arr.length-1,1);}if(!arr.length){return;}if(arr[0].code==" "){arr.splice(0,1);}};if(_4.isArray(_33[0])){_4.forEach(_33,fn);}else{fn(_33);}return _33;},_split:function(_34,_35){var w=this._getWidth(_34),_36=Math.floor(w/_35),_37=[],cw=0,c=[],_38=false;for(var i=0,l=_34.length;i<l;i++){if(_34[i].code==" "){_38=true;}cw+=_34[i].xAdvance;if(i+1<l&&_34[i].kern&&_34[i].kern[_34[i+1].code]){cw+=_34[i].kern[_34[i+1].code].x;}if(cw>=_36){var chr=_34[i];while(_38&&chr.code!=" "&&i>=0){chr=c.pop();i--;}_37.push(c);c=[];cw=0;_38=false;}c.push(_34[i]);}if(c.length){_37.push(c);}return this._trim(_37);},_getSizeFactor:function(_39){_39+="";var _3a=_6.html.metrics.getCachedFontMeasurements(),_3b=this.viewbox.height,f=_3a["1em"],_3c=parseFloat(_39,10);if(_39.indexOf("em")>-1){return this._round((_3a["1em"]*_3c)/_3b);}else{if(_39.indexOf("ex")>-1){return this._round((_3a["1ex"]*_3c)/_3b);}else{if(_39.indexOf("pt")>-1){return this._round(((_3a["12pt"]/12)*_3c)/_3b);}else{if(_39.indexOf("px")>-1){return this._round(((_3a["16px"]/16)*_3c)/_3b);}else{if(_39.indexOf("%")>-1){return this._round((_3a["1em"]*(_3c/100))/_3b);}else{f=_3a[_39]||_3a.medium;return this._round(f/_3b);}}}}}},_getFitFactor:function(_3d,w,h,l){if(!h){return this._round(w/this._getWidth(_3d));}else{var _3e=this._getLongestLine(_3d).width,_3f=(_3d.length*(this.viewbox.height*l))-((this.viewbox.height*l)-this.viewbox.height);return this._round(Math.min(w/_3e,h/_3f));}},_getBestFit:function(_40,w,h,_41){var _42=32,_43=0,_44=_42;while(_42>0){var f=this._getFitFactor(this._split(_40,_42),w,h,_41);if(f>_43){_43=f;_44=_42;}_42--;}return {scale:_43,lines:this._split(_40,_44)};},_getBestFlow:function(_45,w,_46){var _47=[],cw=0,c=[],_48=false;for(var i=0,l=_45.length;i<l;i++){if(_45[i].code==" "){_48=true;}var tw=_45[i].xAdvance;if(i+1<l&&_45[i].kern&&_45[i].kern[_45[i+1].code]){tw+=_45[i].kern[_45[i+1].code].x;}cw+=_46*tw;if(cw>=w){var chr=_45[i];while(_48&&chr.code!=" "&&i>=0){chr=c.pop();i--;}_47.push(c);c=[];cw=0;_48=false;}c.push(_45[i]);}if(c.length){_47.push(c);}return this._trim(_47);},getWidth:function(_49,_4a){return this._getWidth(_4.map(this._normalize(_49).split(""),function(chr){return this.glyphs[chr]||{xAdvance:this.advance.missing.x};},this))*(_4a||1);},getLineHeight:function(_4b){return this.viewbox.height*(_4b||1);},getCenterline:function(_4c){return (_4c||1)*(this.viewbox.height/2);},getBaseline:function(_4d){return (_4d||1)*(this.viewbox.height+this.descent);},draw:function(_4e,_4f,_50,_51,_52){if(!this.initialized()){throw new Error("dojox.gfx.VectorFont.draw(): we have not been initialized yet.");}var g=_4e.createGroup();if(_4f.x||_4f.y){_4e.applyTransform({dx:_4f.x||0,dy:_4f.y||0});}var _53=_4.map(this._normalize(_4f.text).split(""),function(chr){return this.glyphs[chr]||{path:null,xAdvance:this.advance.missing.x};},this);var _54=_50.size,_55=_4f.fitting,_56=_4f.width,_57=_4f.height,_58=_4f.align,_59=_4f.leading||this._defaultLeading;if(_55){if((_55==_6.gfx.vectorFontFitting.FLOW&&!_56)||(_55==_6.gfx.vectorFontFitting.FIT&&(!_56||!_57))){_55=_6.gfx.vectorFontFitting.NONE;}}var _5a,_5b;switch(_55){case _6.gfx.vectorFontFitting.FIT:var o=this._getBestFit(_53,_56,_57,_59);_5b=o.scale;_5a=o.lines;break;case _6.gfx.vectorFontFitting.FLOW:_5b=this._getSizeFactor(_54);_5a=this._getBestFlow(_53,_56,_5b);break;default:_5b=this._getSizeFactor(_54);_5a=[_53];}_5a=_4.filter(_5a,function(_5c){return _5c.length>0;});var cy=0,_5d=this._getLongestLine(_5a).width;for(var i=0,l=_5a.length;i<l;i++){var cx=0,_5e=_5a[i],_5f=this._getWidth(_5e),lg=g.createGroup();for(var j=0;j<_5e.length;j++){var _60=_5e[j];if(_60.path!==null){var p=lg.createPath(_60.path).setFill(_51);if(_52){p.setStroke(_52);}p.setTransform([_6.gfx.matrix.flipY,_6.gfx.matrix.translate(cx,-this.viewbox.height-this.descent)]);}cx+=_60.xAdvance;if(j+1<_5e.length&&_60.kern&&_60.kern[_5e[j+1].code]){cx+=_60.kern[_5e[j+1].code].x;}}var dx=0;if(_58=="middle"){dx=_5d/2-_5f/2;}else{if(_58=="end"){dx=_5d-_5f;}}lg.setTransform({dx:dx,dy:cy});cy+=this.viewbox.height*_59;}g.setTransform(_6.gfx.matrix.scale(_5b));return g;},onLoadBegin:function(url){},onLoad:function(_61){}});})();}}};});