/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.grid._Builder"],["require","dojox.grid.util"],["require","dojo.dnd.Moveable"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.grid._Builder"]){_4._hasResource["dojox.grid._Builder"]=true;_4.provide("dojox.grid._Builder");_4.require("dojox.grid.util");_4.require("dojo.dnd.Moveable");(function(){var dg=_6.grid;var _7=function(td){return td.cellIndex>=0?td.cellIndex:_4.indexOf(td.parentNode.cells,td);};var _8=function(tr){return tr.rowIndex>=0?tr.rowIndex:_4.indexOf(tr.parentNode.childNodes,tr);};var _9=function(_a,_b){return _a&&((_a.rows||0)[_b]||_a.childNodes[_b]);};var _c=function(_d){for(var n=_d;n&&n.tagName!="TABLE";n=n.parentNode){}return n;};var _e=function(_f,_10){for(var n=_f;n&&_10(n);n=n.parentNode){}return n;};var _11=function(_12){var _13=_12.toUpperCase();return function(_14){return _14.tagName!=_13;};};var _15=_6.grid.util.rowIndexTag;var _16=_6.grid.util.gridViewTag;dg._Builder=_4.extend(function(_17){if(_17){this.view=_17;this.grid=_17.grid;}},{view:null,_table:"<table class=\"dojoxGridRowTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" role=\"presentation\"",getTableArray:function(){var _18=[this._table];if(this.view.viewWidth){_18.push([" style=\"width:",this.view.viewWidth,";\""].join(""));}_18.push(">");return _18;},generateCellMarkup:function(_19,_1a,_1b,_1c){var _1d=[],_1e;if(_1c){var _1f=_19.index!=_19.grid.getSortIndex()?"":_19.grid.sortInfo>0?"aria-sort=\"ascending\"":"aria-sort=\"descending\"";if(!_19.id){_19.id=this.grid.id+"Hdr"+_19.index;}_1e=["<th tabIndex=\"-1\" aria-readonly=\"true\" role=\"columnheader\"",_1f,"id=\"",_19.id,"\""];}else{var _20=this.grid.editable&&!_19.editable?"aria-readonly=\"true\"":"";_1e=["<td tabIndex=\"-1\" role=\"gridcell\"",_20];}if(_19.colSpan){_1e.push(" colspan=\"",_19.colSpan,"\"");}if(_19.rowSpan){_1e.push(" rowspan=\"",_19.rowSpan,"\"");}_1e.push(" class=\"dojoxGridCell ");if(_19.classes){_1e.push(_19.classes," ");}if(_1b){_1e.push(_1b," ");}_1d.push(_1e.join(""));_1d.push("");_1e=["\" idx=\"",_19.index,"\" style=\""];if(_1a&&_1a[_1a.length-1]!=";"){_1a+=";";}_1e.push(_19.styles,_1a||"",_19.hidden?"display:none;":"");if(_19.unitWidth){_1e.push("width:",_19.unitWidth,";");}_1d.push(_1e.join(""));_1d.push("");_1e=["\""];if(_19.attrs){_1e.push(" ",_19.attrs);}_1e.push(">");_1d.push(_1e.join(""));_1d.push("");_1d.push(_1c?"</th>":"</td>");return _1d;},isCellNode:function(_21){return Boolean(_21&&_21!=_4.doc&&_4.attr(_21,"idx"));},getCellNodeIndex:function(_22){return _22?Number(_4.attr(_22,"idx")):-1;},getCellNode:function(_23,_24){for(var i=0,row;(row=_9(_23.firstChild,i));i++){for(var j=0,_25;(_25=row.cells[j]);j++){if(this.getCellNodeIndex(_25)==_24){return _25;}}}return null;},findCellTarget:function(_26,_27){var n=_26;while(n&&(!this.isCellNode(n)||(n.offsetParent&&_16 in n.offsetParent.parentNode&&n.offsetParent.parentNode[_16]!=this.view.id))&&(n!=_27)){n=n.parentNode;}return n!=_27?n:null;},baseDecorateEvent:function(e){e.dispatch="do"+e.type;e.grid=this.grid;e.sourceView=this.view;e.cellNode=this.findCellTarget(e.target,e.rowNode);e.cellIndex=this.getCellNodeIndex(e.cellNode);e.cell=(e.cellIndex>=0?this.grid.getCell(e.cellIndex):null);},findTarget:function(_28,_29){var n=_28;while(n&&(n!=this.domNode)&&(!(_29 in n)||(_16 in n&&n[_16]!=this.view.id))){n=n.parentNode;}return (n!=this.domNode)?n:null;},findRowTarget:function(_2a){return this.findTarget(_2a,_15);},isIntraNodeEvent:function(e){try{return (e.cellNode&&e.relatedTarget&&_4.isDescendant(e.relatedTarget,e.cellNode));}catch(x){return false;}},isIntraRowEvent:function(e){try{var row=e.relatedTarget&&this.findRowTarget(e.relatedTarget);return !row&&(e.rowIndex==-1)||row&&(e.rowIndex==row.gridRowIndex);}catch(x){return false;}},dispatchEvent:function(e){if(e.dispatch in this){return this[e.dispatch](e);}return false;},domouseover:function(e){if(e.cellNode&&(e.cellNode!=this.lastOverCellNode)){this.lastOverCellNode=e.cellNode;this.grid.onMouseOver(e);}this.grid.onMouseOverRow(e);},domouseout:function(e){if(e.cellNode&&(e.cellNode==this.lastOverCellNode)&&!this.isIntraNodeEvent(e,this.lastOverCellNode)){this.lastOverCellNode=null;this.grid.onMouseOut(e);if(!this.isIntraRowEvent(e)){this.grid.onMouseOutRow(e);}}},domousedown:function(e){if(e.cellNode){this.grid.onMouseDown(e);}this.grid.onMouseDownRow(e);}});dg._ContentBuilder=_4.extend(function(_2b){dg._Builder.call(this,_2b);},dg._Builder.prototype,{update:function(){this.prepareHtml();},prepareHtml:function(){var _2c=this.grid.get,_2d=this.view.structure.cells;for(var j=0,row;(row=_2d[j]);j++){for(var i=0,_2e;(_2e=row[i]);i++){_2e.get=_2e.get||(_2e.value==undefined)&&_2c;_2e.markup=this.generateCellMarkup(_2e,_2e.cellStyles,_2e.cellClasses,false);if(!this.grid.editable&&_2e.editable){this.grid.editable=true;}}}},generateHtml:function(_2f,_30){var _31=this.getTableArray(),v=this.view,_32=v.structure.cells,_33=this.grid.getItem(_30);_6.grid.util.fire(this.view,"onBeforeRow",[_30,_32]);for(var j=0,row;(row=_32[j]);j++){if(row.hidden||row.header){continue;}_31.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");for(var i=0,_34,m,cc,cs;(_34=row[i]);i++){m=_34.markup;cc=_34.customClasses=[];cs=_34.customStyles=[];m[5]=_34.format(_30,_33);m[1]=cc.join(" ");m[3]=cs.join(";");_31.push.apply(_31,m);}_31.push("</tr>");}_31.push("</table>");return _31.join("");},decorateEvent:function(e){e.rowNode=this.findRowTarget(e.target);if(!e.rowNode){return false;}e.rowIndex=e.rowNode[_15];this.baseDecorateEvent(e);e.cell=this.grid.getCell(e.cellIndex);return true;}});dg._HeaderBuilder=_4.extend(function(_35){this.moveable=null;dg._Builder.call(this,_35);},dg._Builder.prototype,{_skipBogusClicks:false,overResizeWidth:4,minColWidth:1,update:function(){if(this.tableMap){this.tableMap.mapRows(this.view.structure.cells);}else{this.tableMap=new dg._TableMap(this.view.structure.cells);}},generateHtml:function(_36,_37){var _38=this.getTableArray(),_39=this.view.structure.cells;_6.grid.util.fire(this.view,"onBeforeRow",[-1,_39]);for(var j=0,row;(row=_39[j]);j++){if(row.hidden){continue;}_38.push(!row.invisible?"<tr>":"<tr class=\"dojoxGridInvisible\">");for(var i=0,_3a,_3b;(_3a=row[i]);i++){_3a.customClasses=[];_3a.customStyles=[];if(this.view.simpleStructure){if(_3a.draggable){if(_3a.headerClasses){if(_3a.headerClasses.indexOf("dojoDndItem")==-1){_3a.headerClasses+=" dojoDndItem";}}else{_3a.headerClasses="dojoDndItem";}}if(_3a.attrs){if(_3a.attrs.indexOf("dndType='gridColumn_")==-1){_3a.attrs+=" dndType='gridColumn_"+this.grid.id+"'";}}else{_3a.attrs="dndType='gridColumn_"+this.grid.id+"'";}}_3b=this.generateCellMarkup(_3a,_3a.headerStyles,_3a.headerClasses,true);_3b[5]=(_37!=undefined?_37:_36(_3a));_3b[3]=_3a.customStyles.join(";");_3b[1]=_3a.customClasses.join(" ");_38.push(_3b.join(""));}_38.push("</tr>");}_38.push("</table>");return _38.join("");},getCellX:function(e){var n,x=e.layerX;if(_4.isMoz){n=_e(e.target,_11("th"));x-=(n&&n.offsetLeft)||0;var t=e.sourceView.getScrollbarWidth();if(!_4._isBodyLtr()&&e.sourceView.headerNode.scrollLeft<t){x-=t;}}n=_e(e.target,function(){if(!n||n==e.cellNode){return false;}x+=(n.offsetLeft<0?0:n.offsetLeft);return true;});return x;},decorateEvent:function(e){this.baseDecorateEvent(e);e.rowIndex=-1;e.cellX=this.getCellX(e);return true;},prepareResize:function(e,mod){do{var i=_7(e.cellNode);e.cellNode=(i?e.cellNode.parentNode.cells[i+mod]:null);e.cellIndex=(e.cellNode?this.getCellNodeIndex(e.cellNode):-1);}while(e.cellNode&&e.cellNode.style.display=="none");return Boolean(e.cellNode);},canResize:function(e){if(!e.cellNode||e.cellNode.colSpan>1){return false;}var _3c=this.grid.getCell(e.cellIndex);return !_3c.noresize&&_3c.canResize();},overLeftResizeArea:function(e){if(_4.hasClass(_4.body(),"dojoDndMove")){return false;}if(_4.isIE){var tN=e.target;if(_4.hasClass(tN,"dojoxGridArrowButtonNode")||_4.hasClass(tN,"dojoxGridArrowButtonChar")){return false;}}if(_4._isBodyLtr()){return (e.cellIndex>0)&&(e.cellX<this.overResizeWidth)&&this.prepareResize(e,-1);}var t=e.cellNode&&(e.cellX<this.overResizeWidth);return t;},overRightResizeArea:function(e){if(_4.hasClass(_4.body(),"dojoDndMove")){return false;}if(_4.isIE){var tN=e.target;if(_4.hasClass(tN,"dojoxGridArrowButtonNode")||_4.hasClass(tN,"dojoxGridArrowButtonChar")){return false;}}if(_4._isBodyLtr()){return e.cellNode&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth);}return (e.cellIndex>0)&&(e.cellX>=e.cellNode.offsetWidth-this.overResizeWidth)&&this.prepareResize(e,-1);},domousemove:function(e){if(!this.moveable){var c=(this.overRightResizeArea(e)?"dojoxGridColResize":(this.overLeftResizeArea(e)?"dojoxGridColResize":""));if(c&&!this.canResize(e)){c="dojoxGridColNoResize";}_4.toggleClass(e.sourceView.headerNode,"dojoxGridColNoResize",(c=="dojoxGridColNoResize"));_4.toggleClass(e.sourceView.headerNode,"dojoxGridColResize",(c=="dojoxGridColResize"));if(_4.isIE){var t=e.sourceView.headerNode.scrollLeft;e.sourceView.headerNode.scrollLeft=t;}if(c){_4.stopEvent(e);}}},domousedown:function(e){if(!this.moveable){if((this.overRightResizeArea(e)||this.overLeftResizeArea(e))&&this.canResize(e)){this.beginColumnResize(e);}else{this.grid.onMouseDown(e);this.grid.onMouseOverRow(e);}}},doclick:function(e){if(this._skipBogusClicks){_4.stopEvent(e);return true;}return false;},colResizeSetup:function(e,_3d){var _3e=_4.contentBox(e.sourceView.headerNode);if(_3d){this.lineDiv=document.createElement("div");var vw=(_4.position||_4._abs)(e.sourceView.headerNode,true);var _3f=_4.contentBox(e.sourceView.domNode);_4.style(this.lineDiv,{top:vw.y+"px",left:e.clientX+"px",height:(_3f.h+_3e.h)+"px"});_4.addClass(this.lineDiv,"dojoxGridResizeColLine");this.lineDiv._origLeft=e.clientX;_4.body().appendChild(this.lineDiv);}var _40=[],_41=this.tableMap.findOverlappingNodes(e.cellNode);for(var i=0,_42;(_42=_41[i]);i++){_40.push({node:_42,index:this.getCellNodeIndex(_42),width:_42.offsetWidth});}var _43=e.sourceView;var adj=_4._isBodyLtr()?1:-1;var _44=e.grid.views.views;var _45=[];for(var j=_43.idx+adj,_46;(_46=_44[j]);j=j+adj){_45.push({node:_46.headerNode,left:window.parseInt(_46.headerNode.style.left)});}var _47=_43.headerContentNode.firstChild;var _48={scrollLeft:e.sourceView.headerNode.scrollLeft,view:_43,node:e.cellNode,index:e.cellIndex,w:_4.contentBox(e.cellNode).w,vw:_3e.w,table:_47,tw:_4.contentBox(_47).w,spanners:_40,followers:_45};return _48;},beginColumnResize:function(e){this.moverDiv=document.createElement("div");_4.style(this.moverDiv,{position:"absolute",left:0});_4.body().appendChild(this.moverDiv);_4.addClass(this.grid.domNode,"dojoxGridColumnResizing");var m=(this.moveable=new _4.dnd.Moveable(this.moverDiv));var _49=this.colResizeSetup(e,true);m.onMove=_4.hitch(this,"doResizeColumn",_49);_4.connect(m,"onMoveStop",_4.hitch(this,function(){this.endResizeColumn(_49);if(_49.node.releaseCapture){_49.node.releaseCapture();}this.moveable.destroy();delete this.moveable;this.moveable=null;_4.removeClass(this.grid.domNode,"dojoxGridColumnResizing");}));if(e.cellNode.setCapture){e.cellNode.setCapture();}m.onMouseDown(e);},doResizeColumn:function(_4a,_4b,_4c){var _4d=_4c.l;var _4e={deltaX:_4d,w:_4a.w+_4d,vw:_4a.vw+_4d,tw:_4a.tw+_4d};this.dragRecord={inDrag:_4a,mover:_4b,leftTop:_4c};if(_4e.w>=this.minColWidth){if(!_4b){this.doResizeNow(_4a,_4e);}else{_4.style(this.lineDiv,"left",(this.lineDiv._origLeft+_4e.deltaX)+"px");}}},endResizeColumn:function(_4f){if(this.dragRecord){var _50=this.dragRecord.leftTop;var _51=_4._isBodyLtr()?_50.l:-_50.l;_51+=Math.max(_4f.w+_51,this.minColWidth)-(_4f.w+_51);if(_4.isWebKit&&_4f.spanners.length){_51+=_4._getPadBorderExtents(_4f.spanners[0].node).w;}var _52={deltaX:_51,w:_4f.w+_51,vw:_4f.vw+_51,tw:_4f.tw+_51};this.doResizeNow(_4f,_52);}_4.destroy(this.lineDiv);_4.destroy(this.moverDiv);_4.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=true;_4f.view.update();this._skipBogusClicks=false;this.grid.onResizeColumn(_4f.index);},doResizeNow:function(_53,_54){_53.view.convertColPctToFixed();if(_53.view.flexCells&&!_53.view.testFlexCells()){var t=_c(_53.node);if(t){(t.style.width="");}}var i,s,sw,f,fl;for(i=0;(s=_53.spanners[i]);i++){sw=s.width+_54.deltaX;s.node.style.width=sw+"px";_53.view.setColWidth(s.index,sw);}for(i=0;(f=_53.followers[i]);i++){fl=f.left+_54.deltaX;f.node.style.left=fl+"px";}_53.node.style.width=_54.w+"px";_53.view.setColWidth(_53.index,_54.w);_53.view.headerNode.style.width=_54.vw+"px";_53.view.setColumnsWidth(_54.tw);if(!_4._isBodyLtr()){_53.view.headerNode.scrollLeft=_53.scrollLeft+_54.deltaX;}}});dg._TableMap=_4.extend(function(_55){this.mapRows(_55);},{map:null,mapRows:function(_56){var _57=_56.length;if(!_57){return;}this.map=[];var row;for(var k=0;(row=_56[k]);k++){this.map[k]=[];}for(var j=0;(row=_56[j]);j++){for(var i=0,x=0,_58,_59,_5a;(_58=row[i]);i++){while(this.map[j][x]){x++;}this.map[j][x]={c:i,r:j};_5a=_58.rowSpan||1;_59=_58.colSpan||1;for(var y=0;y<_5a;y++){for(var s=0;s<_59;s++){this.map[j+y][x+s]=this.map[j][x];}}x+=_59;}}},dumpMap:function(){for(var j=0,row,h="";(row=this.map[j]);j++,h=""){for(var i=0,_5b;(_5b=row[i]);i++){h+=_5b.r+","+_5b.c+"   ";}}},getMapCoords:function(_5c,_5d){for(var j=0,row;(row=this.map[j]);j++){for(var i=0,_5e;(_5e=row[i]);i++){if(_5e.c==_5d&&_5e.r==_5c){return {j:j,i:i};}}}return {j:-1,i:-1};},getNode:function(_5f,_60,_61){var row=_5f&&_5f.rows[_60];return row&&row.cells[_61];},_findOverlappingNodes:function(_62,_63,_64){var _65=[];var m=this.getMapCoords(_63,_64);for(var j=0,row;(row=this.map[j]);j++){if(j==m.j){continue;}var rw=row[m.i];var n=(rw?this.getNode(_62,rw.r,rw.c):null);if(n){_65.push(n);}}return _65;},findOverlappingNodes:function(_66){return this._findOverlappingNodes(_c(_66),_8(_66.parentNode),_7(_66));}});})();}}};});