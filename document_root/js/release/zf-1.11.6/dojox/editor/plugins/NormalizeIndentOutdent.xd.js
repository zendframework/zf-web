/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._xdResourceLoaded(function(_1,_2,_3){return {depends:[["provide","dojox.editor.plugins.NormalizeIndentOutdent"],["require","dijit._editor._Plugin"],["require","dijit._editor.selection"]],defineResource:function(_4,_5,_6){if(!_4._hasResource["dojox.editor.plugins.NormalizeIndentOutdent"]){_4._hasResource["dojox.editor.plugins.NormalizeIndentOutdent"]=true;_4.provide("dojox.editor.plugins.NormalizeIndentOutdent");_4.require("dijit._editor._Plugin");_4.require("dijit._editor.selection");_4.experimental("dojox.editor.plugins.NormalizeIndentOutdent");_4.declare("dojox.editor.plugins.NormalizeIndentOutdent",_5._editor._Plugin,{indentBy:40,indentUnits:"px",setEditor:function(_7){this.editor=_7;_7._indentImpl=_4.hitch(this,this._indentImpl);_7._outdentImpl=_4.hitch(this,this._outdentImpl);if(!_7._indentoutdent_queryCommandEnabled){_7._indentoutdent_queryCommandEnabled=_7.queryCommandEnabled;}_7.queryCommandEnabled=_4.hitch(this,this._queryCommandEnabled);_7.customUndo=true;},_queryCommandEnabled:function(_8){var c=_8.toLowerCase();var ed,_9,_a,_b,_c,_d;var _e="marginLeft";if(!this._isLtr()){_e="marginRight";}if(c==="indent"){ed=this.editor;_9=_5.range.getSelection(ed.window);if(_9&&_9.rangeCount>0){_a=_9.getRangeAt(0);_b=_a.startContainer;while(_b&&_b!==ed.document&&_b!==ed.editNode){_c=this._getTagName(_b);if(_c==="li"){_d=_b.previousSibling;while(_d&&_d.nodeType!==1){_d=_d.previousSibling;}if(_d&&this._getTagName(_d)==="li"){return true;}else{return false;}}else{if(this._isIndentableElement(_c)){return true;}}_b=_b.parentNode;}if(this._isRootInline(_a.startContainer)){return true;}}}else{if(c==="outdent"){ed=this.editor;_9=_5.range.getSelection(ed.window);if(_9&&_9.rangeCount>0){_a=_9.getRangeAt(0);_b=_a.startContainer;while(_b&&_b!==ed.document&&_b!==ed.editNode){_c=this._getTagName(_b);if(_c==="li"){return this.editor._indentoutdent_queryCommandEnabled(_8);}else{if(this._isIndentableElement(_c)){var _f=_b.style?_b.style[_e]:"";if(_f){_f=this._convertIndent(_f);if(_f/this.indentBy>=1){return true;}}return false;}}_b=_b.parentNode;}if(this._isRootInline(_a.startContainer)){return false;}}}else{return this.editor._indentoutdent_queryCommandEnabled(_8);}}return false;},_indentImpl:function(_10){var ed=this.editor;var sel=_5.range.getSelection(ed.window);if(sel&&sel.rangeCount>0){var _11=sel.getRangeAt(0);var _12=_11.startContainer;var tag,_13,end,div;if(_11.startContainer===_11.endContainer){if(this._isRootInline(_11.startContainer)){_13=_11.startContainer;while(_13&&_13.parentNode!==ed.editNode){_13=_13.parentNode;}while(_13&&_13.previousSibling&&(this._isTextElement(_13)||(_13.nodeType===1&&this._isInlineFormat(this._getTagName(_13))))){_13=_13.previousSibling;}if(_13&&_13.nodeType===1&&!this._isInlineFormat(this._getTagName(_13))){_13=_13.nextSibling;}if(_13){div=ed.document.createElement("div");_4.place(div,_13,"after");div.appendChild(_13);end=div.nextSibling;while(end&&(this._isTextElement(end)||(end.nodeType===1&&this._isInlineFormat(this._getTagName(end))))){div.appendChild(end);end=div.nextSibling;}this._indentElement(div);_4.withGlobal(ed.window,"selectElementChildren",_5._editor.selection,[div]);_4.withGlobal(ed.window,"collapse",_5._editor.selection,[true]);}}else{while(_12&&_12!==ed.document&&_12!==ed.editNode){tag=this._getTagName(_12);if(tag==="li"){this._indentList(_12);return;}else{if(this._isIndentableElement(tag)){this._indentElement(_12);return;}}_12=_12.parentNode;}}}else{var _14;_13=_11.startContainer;end=_11.endContainer;while(_13&&this._isTextElement(_13)&&_13.parentNode!==ed.editNode){_13=_13.parentNode;}while(end&&this._isTextElement(end)&&end.parentNode!==ed.editNode){end=end.parentNode;}if(end===ed.editNode||end===ed.document.body){_14=_13;while(_14.nextSibling&&_4.withGlobal(ed.window,"inSelection",_5._editor.selection,[_14])){_14=_14.nextSibling;}end=_14;if(end===ed.editNode||end===ed.document.body){tag=this._getTagName(_13);if(tag==="li"){this._indentList(_13);}else{if(this._isIndentableElement(tag)){this._indentElement(_13);}else{if(this._isTextElement(_13)||this._isInlineFormat(tag)){div=ed.document.createElement("div");_4.place(div,_13,"after");var _15=_13;while(_15&&(this._isTextElement(_15)||(_15.nodeType===1&&this._isInlineFormat(this._getTagName(_15))))){div.appendChild(_15);_15=div.nextSibling;}this._indentElement(div);}}}return;}}end=end.nextSibling;_14=_13;while(_14&&_14!==end){if(_14.nodeType===1){tag=this._getTagName(_14);if(_4.isIE){if(tag==="p"&&this._isEmpty(_14)){_14=_14.nextSibling;continue;}}if(tag==="li"){if(div){if(this._isEmpty(div)){div.parentNode.removeChild(div);}else{this._indentElement(div);}div=null;}this._indentList(_14);}else{if(!this._isInlineFormat(tag)&&this._isIndentableElement(tag)){if(div){if(this._isEmpty(div)){div.parentNode.removeChild(div);}else{this._indentElement(div);}div=null;}_14=this._indentElement(_14);}else{if(this._isInlineFormat(tag)){if(!div){div=ed.document.createElement("div");_4.place(div,_14,"after");div.appendChild(_14);_14=div;}else{div.appendChild(_14);_14=div;}}}}}else{if(this._isTextElement(_14)){if(!div){div=ed.document.createElement("div");_4.place(div,_14,"after");div.appendChild(_14);_14=div;}else{div.appendChild(_14);_14=div;}}}_14=_14.nextSibling;}if(div){if(this._isEmpty(div)){div.parentNode.removeChild(div);}else{this._indentElement(div);}div=null;}}}},_indentElement:function(_16){var _17="marginLeft";if(!this._isLtr()){_17="marginRight";}var tag=this._getTagName(_16);if(tag==="ul"||tag==="ol"){var div=this.editor.document.createElement("div");_4.place(div,_16,"after");div.appendChild(_16);_16=div;}var _18=_16.style?_16.style[_17]:"";if(_18){_18=this._convertIndent(_18);_18=(parseInt(_18,10)+this.indentBy)+this.indentUnits;}else{_18=this.indentBy+this.indentUnits;}_4.style(_16,_17,_18);return _16;},_outdentElement:function(_19){var _1a="marginLeft";if(!this._isLtr()){_1a="marginRight";}var _1b=_19.style?_19.style[_1a]:"";if(_1b){_1b=this._convertIndent(_1b);if(_1b-this.indentBy>0){_1b=(parseInt(_1b,10)-this.indentBy)+this.indentUnits;}else{_1b="";}_4.style(_19,_1a,_1b);}},_outdentImpl:function(_1c){var ed=this.editor;var sel=_5.range.getSelection(ed.window);if(sel&&sel.rangeCount>0){var _1d=sel.getRangeAt(0);var _1e=_1d.startContainer;var tag;if(_1d.startContainer===_1d.endContainer){while(_1e&&_1e!==ed.document&&_1e!==ed.editNode){tag=this._getTagName(_1e);if(tag==="li"){return this._outdentList(_1e);}else{if(this._isIndentableElement(tag)){return this._outdentElement(_1e);}}_1e=_1e.parentNode;}ed.document.execCommand("outdent",false,_1c);}else{var _1f=_1d.startContainer;var end=_1d.endContainer;while(_1f&&_1f.nodeType===3){_1f=_1f.parentNode;}while(end&&end.nodeType===3){end=end.parentNode;}end=end.nextSibling;var _20=_1f;while(_20&&_20!==end){if(_20.nodeType===1){tag=this._getTagName(_20);if(tag==="li"){this._outdentList(_20);}else{if(this._isIndentableElement(tag)){this._outdentElement(_20);}}}_20=_20.nextSibling;}}}return null;},_indentList:function(_21){var ed=this.editor;var _22,li;var _23=_21.parentNode;var _24=_21.previousSibling;while(_24&&_24.nodeType!==1){_24=_24.previousSibling;}var _25=null;var tg=this._getTagName(_23);if(tg==="ol"){_25="ol";}else{if(tg==="ul"){_25="ul";}}if(_25){if(_24&&_24.tagName.toLowerCase()=="li"){var _26;if(_24.childNodes){var i;for(i=0;i<_24.childNodes.length;i++){var n=_24.childNodes[i];if(n.nodeType===3){if(_4.trim(n.nodeValue)){if(_26){break;}}}else{if(n.nodeType===1&&!_26){if(_25===n.tagName.toLowerCase()){_26=n;}}else{break;}}}}if(_26){_26.appendChild(_21);}else{_22=ed.document.createElement(_25);_4.style(_22,{paddingTop:"0px",paddingBottom:"0px"});li=ed.document.createElement("li");_4.style(li,{listStyleImage:"none",listStyleType:"none"});_24.appendChild(_22);_22.appendChild(_21);}_4.withGlobal(ed.window,"selectElementChildren",_5._editor.selection,[_21]);_4.withGlobal(ed.window,"collapse",_5._editor.selection,[true]);}}},_outdentList:function(_27){var ed=this.editor;var _28=_27.parentNode;var _29=null;var tg=_28.tagName?_28.tagName.toLowerCase():"";var li;if(tg==="ol"){_29="ol";}else{if(tg==="ul"){_29="ul";}}var _2a=_28.parentNode;var _2b=this._getTagName(_2a);if(_2b==="li"||_2b==="ol"||_2b==="ul"){if(_2b==="ol"||_2b==="ul"){var _2c=_28.previousSibling;while(_2c&&(_2c.nodeType!==1||(_2c.nodeType===1&&this._getTagName(_2c)!=="li"))){_2c=_2c.previousSibling;}if(_2c){_2c.appendChild(_28);_2a=_2c;}else{li=_27;var _2d=_27;while(li.previousSibling){li=li.previousSibling;if(li.nodeType===1&&this._getTagName(li)==="li"){_2d=li;}}if(_2d!==_27){_4.place(_2d,_28,"before");_2d.appendChild(_28);_2a=_2d;}else{li=ed.document.createElement("li");_4.place(li,_28,"before");li.appendChild(_28);_2a=li;}_4.style(_28,{paddingTop:"0px",paddingBottom:"0px"});}}var _2e=_27.previousSibling;while(_2e&&_2e.nodeType!==1){_2e=_2e.previousSibling;}var _2f=_27.nextSibling;while(_2f&&_2f.nodeType!==1){_2f=_2f.nextSibling;}if(!_2e){_4.place(_27,_2a,"after");_27.appendChild(_28);}else{if(!_2f){_4.place(_27,_2a,"after");}else{var _30=ed.document.createElement(_29);_4.style(_30,{paddingTop:"0px",paddingBottom:"0px"});_27.appendChild(_30);while(_27.nextSibling){_30.appendChild(_27.nextSibling);}_4.place(_27,_2a,"after");}}if(_28&&this._isEmpty(_28)){_28.parentNode.removeChild(_28);}if(_2a&&this._isEmpty(_2a)){_2a.parentNode.removeChild(_2a);}_4.withGlobal(ed.window,"selectElementChildren",_5._editor.selection,[_27]);_4.withGlobal(ed.window,"collapse",_5._editor.selection,[true]);}else{ed.document.execCommand("outdent",false,null);}},_isEmpty:function(_31){if(_31.childNodes){var _32=true;var i;for(i=0;i<_31.childNodes.length;i++){var n=_31.childNodes[i];if(n.nodeType===1){if(this._getTagName(n)==="p"){if(!_4.trim(n.innerHTML)){continue;}}_32=false;break;}else{if(this._isTextElement(n)){var nv=_4.trim(n.nodeValue);if(nv&&nv!=="&nbsp;"&&nv!=="Â "){_32=false;break;}}else{_32=false;break;}}}return _32;}else{return true;}},_isIndentableElement:function(tag){switch(tag){case "p":case "div":case "h1":case "h2":case "h3":case "center":case "table":case "ul":case "ol":return true;default:return false;}},_convertIndent:function(_33){var _34=12;_33=_33+"";_33=_33.toLowerCase();var _35=(_33.indexOf("px")>0)?"px":(_33.indexOf("em")>0)?"em":"px";_33=_33.replace(/(px;?|em;?)/gi,"");if(_35==="px"){if(this.indentUnits==="em"){_33=Math.ceil(_33/_34);}}else{if(this.indentUnits==="px"){_33=_33*_34;}}return _33;},_isLtr:function(){var _36=this.editor.document.body;return _4.withGlobal(this.editor.window,function(){var cs=_4.getComputedStyle(_36);return cs?cs.direction=="ltr":true;});},_isInlineFormat:function(tag){switch(tag){case "a":case "b":case "strong":case "s":case "strike":case "i":case "u":case "em":case "sup":case "sub":case "span":case "font":case "big":case "cite":case "q":case "img":case "small":return true;default:return false;}},_getTagName:function(_37){var tag="";if(_37&&_37.nodeType===1){tag=_37.tagName?_37.tagName.toLowerCase():"";}return tag;},_isRootInline:function(_38){var ed=this.editor;if(this._isTextElement(_38)&&_38.parentNode===ed.editNode){return true;}else{if(_38.nodeType===1&&this._isInlineFormat(_38)&&_38.parentNode===ed.editNode){return true;}else{if(this._isTextElement(_38)&&this._isInlineFormat(this._getTagName(_38.parentNode))){_38=_38.parentNode;while(_38&&_38!==ed.editNode&&this._isInlineFormat(this._getTagName(_38))){_38=_38.parentNode;}if(_38===ed.editNode){return true;}}}}return false;},_isTextElement:function(_39){if(_39&&_39.nodeType===3||_39.nodeType===4){return true;}return false;}});_4.subscribe(_5._scopeName+".Editor.getPlugin",null,function(o){if(o.plugin){return;}var _3a=o.args.name.toLowerCase();if(_3a==="normalizeindentoutdent"){o.plugin=new _6.editor.plugins.NormalizeIndentOutdent({indentBy:("indentBy" in o.args)?(o.args.indentBy>0?o.args.indentBy:40):40,indentUnits:("indentUnits" in o.args)?(o.args.indentUnits.toLowerCase()=="em"?"em":"px"):"px"});}});}}};});