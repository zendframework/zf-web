<h2>ZF-3753: Locale is ignored when using addTranslation [TMX-Adapter]</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2008-07-24T23:14:39.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2008-07-24T23:43:31.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul>        <li>1.5.3 (28/Jul/08)</li>
    </ul></dd>

    <dt>Reporter:</dt>
    <dd>
                Alessandro Diaz (lis)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Thomas Weidner (thomas)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Translate</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>Hi,</p>

<p>I've found a very strange bug in Zend_Translate when using tmx files.</p>

<p>I'm creating a new Zend_Translate object and set a locale i get from the session before dispatching. During the dispatch process the controller adds a new language file (I have one language file for common words, and one for each controller) with addTranslation.</p>

<p>After changing the locale in a new request the language does not change in certain browsers. When using FF 3.0 everything works fine, but the Internet Explorer still shows the old language. I've found one installation of FF where the languages did not change, too, so it seems to depend on the settings of the browser.</p>

<p>I've fixed this bug by specifying the locale when invoking the addTranslation method on the Translator. When i die() before the addTranslation() (or comment that line out) everything is properly translated and changing the language works.</p>

<p>so, a short summary:</p>

<pre class="highlight"><code>
$translate = new Zend_Translate('tmx', 'commons.tmx');
$translate-&gt;setLocale('someLocale');
$translate-&gt;addTranslation(' another.tmx');
</code></pre>

<p>does not work, properly, whereas</p>

<pre class="highlight"><code>
$translate-&gt;addTranslation('another.tmx', 'someLocale'); 
</code></pre>

<p>works as expected.</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Thomas Weidner (thomas) on 2008-07-24T23:42:37.000+0000</p> 
        <div class="body">
            <p>You should be able to find this "non"-bug yourself.</p>

<p>First: TMX includes the language within the translation file. It is also possible to have multiple languages within one TMX file.</p>

<p>Second: Your code differs in one emminent point. You set the locale in your first example on the file "commons.tmx", "another.tmx" is not available at the time you set your locale. Whereas you set the locale  in your second example on the file "another.tmx". So I would expect that "another.tmx" includes other languages than "commons.tmx".</p>

<p>Related to your initial problem, I would expect that your browsers are configured differently (one "en" and the other "ru" for example). When you do not set a locale yourself it will detect the one from the browser. You can read all about this behaviour within the manual. Therefor we have written it. :-)</p>

<p>And as you gave no detailed data we can only expect what's going on in your environment and not give detailed help.</p>

<p>So the conclusio is: This is not a bug and you should always set what you want to be returned.</p>

        </div>
    </div>
    </div>

