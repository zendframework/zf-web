<h2>ZF-4327: http client socket adapter for rest client fails for virtual host</h2>

<dl class="metadata">
    <dt>Issue Type:</dt>
    <dd>Bug</dd>

    <dt>Created:</dt>
    <dd>2008-09-18T13:39:05.000+0000</dd>

    <dt>Last Updated:</dt>
    <dd>2008-10-12T01:55:51.000+0000</dd>

    <dt>Status:</dt>
    <dd>Resolved</dd>

    <dt>Fix version(s):</dt>
    <dd><ul></ul></dd>

    <dt>Reporter:</dt>
    <dd>
                michael depetrillo (klassicd)
            </dd>

    <dt>Assignee:</dt>
    <dd>
                Shahar Evron (shahar)
            </dd>

    <dt>Tags:</dt>
    <dd><ul>        <li>Zend_Http_Client</li>
            <li>Zend_Rest_Client</li>
        </ul></dd>

    <dt>Related issues:</dt>
    <dd><ul>
    </ul></dd>

    <dt>Attachments:</dt>
    <dd><ul>
    </ul></dd>
</dl>

<div class="description">
    <h3>Description</h3>

    <div class="body">
        <p>I have been using Zend_Rest_Client to interact with a Zend_Rest_Server on another domain.</p>

<p>I recently moved the rest server to the same machine as the rest client.  They now share the same IP address and are setup as apache virtual hosts.</p>

<p>Ever since the move, the rest client returns a 404 error.  I examined the uri, headers and body being sent via the socket adapter (Zend_Http_Client_Adapter_Socket) and everything looks great.  But the response from my server is a 404.  I can successfully take the uri from the socket request and load it in a browser and see XML results.</p>

<p>I checked my server logs and it appears the client request is being picked up by the default virtual host for my primary IP address.   The socket adapter is requesting an accurate hostname and path but apache is interpreting as a request for the primary IP address.</p>

<p>I am unfamiliar with sockets and do not understand why this would happen.</p>

<p>I am behind a firewall and both sites do share the same IP address in apache.  Could these be my problem?</p>

    </div>
</div>

<div class="comments">
    <h3>Comments</h3>

    <div class="comment">
        <p class="metadata">Posted by Shahar Evron (shahar) on 2008-10-11T04:47:52.000+0000</p> 
        <div class="body">
            <p>There should be no reason why Zend_Http_Client should not properly work with virtual hosts - it works all the time.</p>

<p>It would help if you could come up with some minimal reproduction script, and perhaps a dump of the HTTP traffic sent form Zend_Http_Client (I assume you have this because you say the headers look good). Also, some more info on your code / configuration would help.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by michael depetrillo (klassicd) on 2008-10-11T19:45:14.000+0000</p> 
        <div class="body">
            <p>I had to add my domain to /etc/hosts because I am behind a firewall.  This is not a bug.</p>

        </div>
    </div>
        <div class="comment">
        <p class="metadata">Posted by Shahar Evron (shahar) on 2008-10-12T01:55:51.000+0000</p> 
        <div class="body">
            <p>Not a bug then, closing.</p>

        </div>
    </div>
    </div>

